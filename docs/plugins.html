<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Alfonso Garcia-Caro">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <link href='https://fonts.googleapis.com/css?family=Josefin+Sans:400,300,600,700' rel='stylesheet' type='text/css'>
    <link href="//tpetricek.github.io/Fable/content/custom.css" rel='stylesheet' type='text/css'>
    <script src="//tpetricek.github.io/Fable/content/tips.js"></script>
    <link rel="stylesheet" type="text/css" href="//tpetricek.github.io/Fable/content/snippets.css" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <script language="javascript" type="text/javascript">
      function init() {
          websocket = new WebSocket("ws://"+window.location.host+"/websocket");
          websocket.onmessage = function(evt) { location.reload(); };
      }
      window.addEventListener("load", init, false);
    </script>
    
  <title>Fable architecture - F# |> BABEL</title>
  <meta name="description" content="Extending Fable via plugins">

</head>
<body>

  <div class="fb-navbar">
  <div class="container">
  <nav class="navbar navbar-default">
    <div class="navbar-wrapper">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="//tpetricek.github.io/Fable">Fable</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class=""><a href="//tpetricek.github.io/Fable">home</a></li>
          <li class=""><a href="//tpetricek.github.io/Fable/samples.html">samples</a></li>
          <li class=""><a href="//tpetricek.github.io/Fable/docs.html">docs</a></li>
          <li><a href="https://github.com/fsprojects/Fable">source</a></li>
        </ul>
      </div>
    </div>
  </nav>
  </div>
  </div>

  <div class="fb-content-wrapper">
  
<div class="fb-heading">
<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <h1>Fable architecture</h1>
      <p>Extending Fable via plugins</p>
    </div>
  </div>
</div>
</div>

<div class="container fb-content">
  <div class="row">
    <div class="col-md-1 col-lg-2"></div>
    <div class="col-sm-12 col-md-10 col-lg-8">
      <p>Is it very easy to add features to Fable using plugins. The best example is the plugin
to transform <a href="/src/plugins/Fable.Plugins.NUnit.fsx">NUnit tests into Mocha</a>. In order to understand the plugin
system we'll review briefly how Fable works.</p>
<h2><a name="Overview-of-Fable-s-Architecture" class="anchor" href="#Overview-of-Fable-s-Architecture">Overview of Fable's Architecture</a></h2>
<p>Thanks to the <a href="http://fsharp.github.io/FSharp.Compiler.Service/">F# compiler</a>
and <a href="http://babeljs.io">Babel</a>, the work of Fable is very simple: transform
the AST generated by the F# compiler into one understandable by Babel.
This way, it's not necessary to deal directly with F# or JavaScript code.
Moreover, several tasks can be delegated to Babel, like compiling from ES2015 to ES5
or using different module systems according to the target environment.</p>
<blockquote>
<p>Note: Babel itself is composed of plugins and the <a href="http://wiki.ecmascript.org/doku.php?id=strawman:do_expressions">do-expressions</a>
plugin in particular greatly simplifies the compilation to JS from an expression-based language like F#.</p>
</blockquote>
<p>In between these two ASTs, Fable sneaks its own one. The reason for that
is to have something more manageable than the AST provided by the F# compiler
for internal transformation and optimizations. Plugins will mostly work against
this intermediate AST.</p>
<p>During the AST transformation process, several hooks are available for plugins.
The most important one is the call replacement, that is, when Fable tries to
replace a call to an external source, like the F# core library or .NET BCL.
We are going to learn how to create a plugin to replace some of these calls.</p>
<h2><a name="Creating-your-own-plugin" class="anchor" href="#Creating-your-own-plugin">Creating your own plugin</a></h2>
<p>Fable's goal is to support most of the F# core library and some of the most
used classes in .NET BCL, like <code>DateTime</code> or <code>Regex</code>. At the moment, it doesn't
support <code>System.Random</code> so let's write a plugin to fix the situation in case
we need it for our projects.</p>
<p>The simplest way to create a plugin is just to use a F# script file and that's
what we'll be doing here. Create a file named <code>Fable.Plugins.Random.fsx</code> and
put a reference to <code>Fable.exe</code> as follows (fix the path according to where
you place the plugin):</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">namespace</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Plugins</span>

<span class="prep">#r</span> <span class="s">&quot;../../build/fable/bin/Fable.exe&quot;</span>

<span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">AST</span>
<span class="k">open</span> <span class="i">Fable</span><span class="o">.</span><span class="i">FSharp2Fable</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>We opened a couple of namespaces to have access to
the functions and types we'll be using from Fable.</p>
</blockquote>
<p>Now we just need to expose a type with a parameterless constructor
implementing one of the <code>IPlugin</code> interfaces in Fable. These interfaces expose
one or several methods returning an option. When performing a transformation,
if there's a hook available, Fable will try to look for a plugin to deal with
the transformation. If there's no plugin or all plugins return <code>None</code> it will
take care of the transformation itself.</p>
<p>In most cases we'll want to implement <code>IReplacePlugin</code> to replace external calls.
We don't have to write too much boilerplate for that:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">RandomPlugin</span>() <span class="o">=</span>
    <span class="k">interface</span> <span class="i">IReplacePlugin</span> <span class="k">with</span>
        <span class="k">member</span> <span class="i">x</span><span class="o">.</span><span class="i">TryReplace</span> <span class="i">com</span> (<span class="i">info</span><span class="o">:</span> <span class="i">Fable</span><span class="o">.</span><span class="i">ApplyInfo</span>) <span class="o">=</span>
            <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">None</span>
</code></pre></td>
</tr>
</table>
<p>Right now this plugin won't do anything as it always return <code>None</code> but we
can have a look at the signature of the method we need to implement to
understand what's going on. Every time Fable encounters an external call,
it will call this method and pass a couple of arguments: the first one
contains the compiler options and we don't need to worry about it for now.
The second one is more interesting and contains a lot of information about
the call we need to replace. <code>ApplyInfo</code> has the following definition:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span class="i">ApplyInfo</span> <span class="o">=</span> {
        <span class="i">methodName</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">string</span>
        <span class="i">ownerFullName</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="i">string</span>
        <span class="i">callee</span><span class="o">:</span> <span class="i">Expr</span> <span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="i">option</span>
        <span class="i">args</span><span class="o">:</span> <span class="i">Expr</span> <span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="i">list</span>
        <span class="i">returnType</span><span class="o">:</span> <span class="i">Type</span>
        <span class="i">range</span><span class="o">:</span> <span class="i">SourceLocation</span> <span onmouseout="hideTip(event, 'fs3', 6)" onmouseover="showTip(event, 'fs3', 6)" class="i">option</span>
        <span class="i">decorators</span><span class="o">:</span> <span class="i">Decorator</span> <span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="i">list</span>
        <span class="i">calleeTypeArgs</span><span class="o">:</span> <span class="i">Type</span> <span onmouseout="hideTip(event, 'fs4', 8)" onmouseover="showTip(event, 'fs4', 8)" class="i">list</span>
        <span class="i">methodTypeArgs</span><span class="o">:</span> <span class="i">Type</span> <span onmouseout="hideTip(event, 'fs4', 9)" onmouseover="showTip(event, 'fs4', 9)" class="i">list</span>
    }
</code></pre></td>
</tr>
</table>
<p>We're going to focus on the first four fields: <code>ownerFullName</code> and <code>methodName</code>
make it possible to identify the method. The owner's (the class or module owning
the method) name corresponds to name displayed on the code and it's important to note
that method name for replacements will always have <strong>a lower-case first letter</strong>.
There's a couple of reasons for that, one is that many of these calls will be
diverted to Fable's core library, where all methods start with lower-case to
follow JavaScript standards.</p>
<p>The next two fields expose the instance object (which maybe <code>None</code> if the method
is static) and the arguments, already transformed into Fable expressions.</p>
<p>With this information, let's identify calls to <code>System.Random</code>. This time we'll
only try to replace two methods: the constructor and <code>Next</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">member</span> <span class="i">x</span><span class="o">.</span><span class="i">TryReplace</span> <span class="i">com</span> (<span class="i">info</span><span class="o">:</span> <span class="i">Fable</span><span class="o">.</span><span class="i">ApplyInfo</span>) <span class="o">=</span>
    <span class="k">match</span> <span class="i">info</span><span class="o">.</span><span class="i">ownerFullName</span> <span class="k">with</span>
    | <span class="s">&quot;System.Random&quot;</span> <span class="k">-&gt;</span>
        <span class="k">match</span> <span class="i">info</span><span class="o">.</span><span class="i">methodName</span> <span class="k">with</span>
        | <span class="s">&quot;.ctor&quot;</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs5', 10)" onmouseover="showTip(event, 'fs5', 10)" class="i">failwith</span> <span class="s">&quot;TODO&quot;</span>
        | <span class="s">&quot;next&quot;</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs5', 11)" onmouseover="showTip(event, 'fs5', 11)" class="i">failwith</span> <span class="s">&quot;TODO&quot;</span>
        | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs1', 12)" onmouseover="showTip(event, 'fs1', 12)" class="i">None</span>
    | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs1', 13)" onmouseover="showTip(event, 'fs1', 13)" class="i">None</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>As you can see, we identify constructors with ".ctor" and we must use lower-case
for the first letter.</p>
</blockquote>
<p>Before implementing the constructor, let's find out how we can create random
numbers in JavaScript. We'll check <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random">Mozilla Developer Network</a>
for that. Unlike .NET, with JS <code>Math.random()</code> we don't need to create an instance
to make random numbers and we always get floats between 0 and 1. If we want integers
in a specific range (excluding the upper limit), the same page gives us a way to do it:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">Math</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 14)" onmouseover="showTip(event, 'fs6', 14)" class="i">floor</span>(<span class="i">Math</span><span class="o">.</span><span class="i">random</span>() <span class="o">*</span> (<span onmouseout="hideTip(event, 'fs7', 15)" onmouseover="showTip(event, 'fs7', 15)" class="i">max</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs8', 16)" onmouseover="showTip(event, 'fs8', 16)" class="i">min</span>)) <span class="o">+</span> <span onmouseout="hideTip(event, 'fs8', 17)" onmouseover="showTip(event, 'fs8', 17)" class="f">min</span>;
</code></pre></td>
</tr>
</table>
<p>To be compatible with .NET code, even if we don't actually need a constructor,
we have to fake one. We'll do that by just returning an empty object.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">| <span class="s">&quot;.ctor&quot;</span> <span class="k">-&gt;</span>
    <span class="k">let</span> <span class="i">o</span> <span class="o">=</span> <span class="i">Fable</span><span class="o">.</span><span class="i">ObjExpr</span> ([], [], <span onmouseout="hideTip(event, 'fs1', 18)" onmouseover="showTip(event, 'fs1', 18)" class="i">None</span>, <span class="i">info</span><span class="o">.</span><span class="i">range</span>)
    <span class="i">Fable</span><span class="o">.</span><span class="i">Wrapped</span> (<span class="i">o</span>, <span class="i">info</span><span class="o">.</span><span class="i">returnType</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs9', 19)" onmouseover="showTip(event, 'fs9', 19)" class="i">Some</span>
</code></pre></td>
</tr>
</table>
<p>First we create an empty object expression using one of the union cases of
<code>Fable.Expr</code>. Though not strictly necessary in this case, it's important to get
used to add the <code>range</code> information to the syntax elements we create so source maps
can be generated correctly allowing us to debug the F# source.</p>
<p>Then we wrap the object just to attach the type (this is important because
in some optimizations Fable may decide to remove empty untyped objects). And finally
we return <code>Some</code> to indicate we've taken care of the call replacement.</p>
<p>Now we need to deal with "next". According to .NET documentation, <code>Random.Next</code>
has three overloads so we need to check the arguments and use default values
for the lower and upper limits of the range if they're not provided.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">| <span class="s">&quot;next&quot;</span> <span class="k">-&gt;</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 20)" onmouseover="showTip(event, 'fs8', 20)" class="i">min</span>, <span onmouseout="hideTip(event, 'fs7', 21)" onmouseover="showTip(event, 'fs7', 21)" class="i">max</span> <span class="o">=</span>
        <span class="k">match</span> <span class="i">info</span><span class="o">.</span><span class="i">args</span> <span class="k">with</span>
        | [] <span class="k">-&gt;</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Util</span><span class="o">.</span><span class="i">makeConst</span> <span class="n">0</span>, <span class="i">Fable</span><span class="o">.</span><span class="i">Util</span><span class="o">.</span><span class="i">makeConst</span> <span onmouseout="hideTip(event, 'fs10', 22)" onmouseover="showTip(event, 'fs10', 22)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 23)" onmouseover="showTip(event, 'fs11', 23)" class="i">Int32</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 24)" onmouseover="showTip(event, 'fs12', 24)" class="i">MaxValue</span>
        | [<span onmouseout="hideTip(event, 'fs7', 25)" onmouseover="showTip(event, 'fs7', 25)" class="i">max</span>] <span class="k">-&gt;</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Util</span><span class="o">.</span><span class="i">makeConst</span> <span class="n">0</span>, <span onmouseout="hideTip(event, 'fs7', 26)" onmouseover="showTip(event, 'fs7', 26)" class="i">max</span>
        | [<span onmouseout="hideTip(event, 'fs8', 27)" onmouseover="showTip(event, 'fs8', 27)" class="i">min</span>; <span onmouseout="hideTip(event, 'fs7', 28)" onmouseover="showTip(event, 'fs7', 28)" class="i">max</span>] <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs8', 29)" onmouseover="showTip(event, 'fs8', 29)" class="i">min</span>, <span onmouseout="hideTip(event, 'fs7', 30)" onmouseover="showTip(event, 'fs7', 30)" class="i">max</span>
        | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs5', 31)" onmouseover="showTip(event, 'fs5', 31)" class="i">failwith</span> <span class="s">&quot;Unexpected arg count for Random.Next&quot;</span>
</code></pre></td>
</tr>
</table>
<blockquote>
<p>The <code>makeConst</code> method builds a <code>Fable.Expr</code> from a numeric or string literal.</p>
</blockquote>
<p>We could translate the JS expression above using <code>Fable.Expr</code> elements but for
the sake of simplicity let's just use an <code>Emit</code> expression like we do with the
<code>EmitAttribute</code> and let Babel do the parsing work for us. This would be a way to do it:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">emitExpr</span> <span class="o">=</span>
    <span class="i">Fable</span><span class="o">.</span><span class="i">Emit</span>(<span class="s">&quot;Math.floor(Math.random() * ($1 - $0)) + $0&quot;</span>)
    <span class="o">|&gt;</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Value</span>
<span class="i">Fable</span><span class="o">.</span><span class="i">Apply</span>(<span class="i">emitExpr</span>, [<span onmouseout="hideTip(event, 'fs8', 32)" onmouseover="showTip(event, 'fs8', 32)" class="i">min</span>; <span onmouseout="hideTip(event, 'fs7', 33)" onmouseover="showTip(event, 'fs7', 33)" class="i">max</span>], <span class="i">Fable</span><span class="o">.</span><span class="i">ApplyMeth</span>, <span class="i">info</span><span class="o">.</span><span class="i">returnType</span>, <span class="i">info</span><span class="o">.</span><span class="i">range</span>)
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs9', 34)" onmouseover="showTip(event, 'fs9', 34)" class="i">Some</span>
</code></pre></td>
</tr>
</table>
<p>First we create the emit expression. Note the expression will be emitted inline
and we use <code>$0</code> and <code>$1</code> as placeholders for the arguments. Also note we don't
need to worry about wrapping the expression in parentheses, Bable will do it for
us if necessary.</p>
<p>Then we apply the expression to the arguments indicating the <code>range</code> and the <code>returnType</code>.</p>
<p>It would be also possible to save a few keystrokes using a helper method from
<code>Fable.Replacements</code> module.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="s">&quot;Math.floor(Math.random() * ($1 - $0)) + $0&quot;</span>
<span class="o">|&gt;</span> <span class="i">Fable</span><span class="o">.</span><span class="i">Replacements</span><span class="o">.</span><span class="i">Util</span><span class="o">.</span><span class="i">emit</span> <span class="i">info</span> <span class="o">&lt;|</span> [<span onmouseout="hideTip(event, 'fs8', 35)" onmouseover="showTip(event, 'fs8', 35)" class="i">min</span>; <span onmouseout="hideTip(event, 'fs7', 36)" onmouseover="showTip(event, 'fs7', 36)" class="i">max</span>]
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs9', 37)" onmouseover="showTip(event, 'fs9', 37)" class="i">Some</span>
</code></pre></td>
</tr>
</table>
<p>What remains is just putting everything together and compiling the plugin
(use <code>fsc</code> or <code>fsharpc</code> according to your platform):</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">fsc</span> <span class="i">src</span><span class="o">/</span><span class="i">plugins</span><span class="o">/</span><span class="i">Fable</span><span class="o">.</span><span class="i">Plugins</span><span class="o">.</span><span class="i">Random</span><span class="o">.</span><span class="i">fsx</span> <span class="o">--</span><span class="i">target</span><span class="o">:</span><span class="i">library</span> <span class="o">--</span><span class="i">out</span><span class="o">:</span><span class="i">build</span><span class="o">/</span><span class="i">plugins</span><span class="o">/</span><span class="i">Fable</span><span class="o">.</span><span class="i">Plugins</span><span class="o">.</span><span class="i">Random</span><span class="o">.</span><span class="i">dll</span>
</code></pre></td>
</tr>
</table>
<p>To test it, create a <code>Test.fsx</code> file in a <code>temp</code> folder and type the following:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="i">r</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 38)" onmouseover="showTip(event, 'fs10', 38)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 39)" onmouseover="showTip(event, 'fs13', 39)" class="i">Random</span>()

<span onmouseout="hideTip(event, 'fs14', 40)" onmouseover="showTip(event, 'fs14', 40)" class="i">printfn</span> <span class="s">&quot;%i&quot;</span> <span class="o">&lt;|</span> <span class="i">r</span><span class="o">.</span><span class="i">Next</span>()
<span onmouseout="hideTip(event, 'fs14', 41)" onmouseover="showTip(event, 'fs14', 41)" class="i">printfn</span> <span class="s">&quot;%i&quot;</span> <span class="o">&lt;|</span> <span class="i">r</span><span class="o">.</span><span class="i">Next</span>(<span class="n">10</span>)
<span onmouseout="hideTip(event, 'fs14', 42)" onmouseover="showTip(event, 'fs14', 42)" class="i">printfn</span> <span class="s">&quot;%i&quot;</span> <span class="o">&lt;|</span> <span class="i">r</span><span class="o">.</span><span class="i">Next</span>(<span class="n">40</span>, <span class="n">50</span>)
</code></pre></td>
</tr>
</table>
<p>In the same <code>temp</code> folder, create a <code>fableconfig.json</code> file with these options:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">{
    <span class="s">&quot;module&quot;</span><span class="o">:</span> <span class="s">&quot;commonjs&quot;</span>,
    <span class="s">&quot;plugins&quot;</span><span class="o">:</span> [<span class="s">&quot;build/plugins/Fable.Plugins.Random.dll&quot;</span>]
}
</code></pre></td>
</tr>
</table>
<p>Now, from the project root folder, compile and run the script with:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">fable</span> <span class="i">temp</span><span class="o">/</span><span class="i">Test</span><span class="o">.</span><span class="i">fsx</span>
<span class="i">node</span> <span class="i">temp</span><span class="o">/</span><span class="i">Test</span>
</code></pre></td>
</tr>
</table>
<p>Nice, isn't it? Now you have the capability to extend Fable to fit your own needs.
If you need more help to create replacements you can have a look at the <a href="/src/fable-fsharp/Replacements.fs">Fable.Replacements
module</a>. I'm looking forward to seeing the wonderful plugins you'll create!</p>


<div class="tip" id="fs1">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs2">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs3">type &#39;T option = Option&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.option&lt;_&gt;</div>
<div class="tip" id="fs4">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs5">val failwith : message:string -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.failwith</div>
<div class="tip" id="fs6">val floor : value:&#39;T -&gt; &#39;T (requires member Floor)<br /><br />Full name: Microsoft.FSharp.Core.Operators.floor</div>
<div class="tip" id="fs7">val max : e1:&#39;T -&gt; e2:&#39;T -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Core.Operators.max</div>
<div class="tip" id="fs8">val min : e1:&#39;T -&gt; e2:&#39;T -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Core.Operators.min</div>
<div class="tip" id="fs9">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs10">namespace System</div>
<div class="tip" id="fs11">type Int32 =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;member CompareTo : value:obj -&gt; int + 1 overload<br />&#160;&#160;&#160;&#160;member Equals : obj:obj -&gt; bool + 1 overload<br />&#160;&#160;&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;&#160;&#160;member GetTypeCode : unit -&gt; TypeCode<br />&#160;&#160;&#160;&#160;member ToString : unit -&gt; string + 3 overloads<br />&#160;&#160;&#160;&#160;static val MaxValue : int<br />&#160;&#160;&#160;&#160;static val MinValue : int<br />&#160;&#160;&#160;&#160;static member Parse : s:string -&gt; int + 3 overloads<br />&#160;&#160;&#160;&#160;static member TryParse : s:string * result:int -&gt; bool + 1 overload<br />&#160;&#160;end<br /><br />Full name: System.Int32</div>
<div class="tip" id="fs12">field int.MaxValue = 2147483647</div>
<div class="tip" id="fs13">Multiple items<br />type Random =<br />&#160;&#160;new : unit -&gt; Random + 1 overload<br />&#160;&#160;member Next : unit -&gt; int + 2 overloads<br />&#160;&#160;member NextBytes : buffer:byte[] -&gt; unit<br />&#160;&#160;member NextDouble : unit -&gt; float<br /><br />Full name: System.Random<br /><br />--------------------<br />System.Random() : unit<br />System.Random(Seed: int) : unit</div>
<div class="tip" id="fs14">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>

    </div>
    <div class="col-md-1 col-lg-2"></div>
  </div>
</div>

  </div>

  <a class="gh-forkme" href="https://github.com/fsprojects/Fable"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
</body>
</html>
