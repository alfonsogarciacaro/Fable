<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Alfonso Garcia-Caro">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <link href='https://fonts.googleapis.com/css?family=Josefin+Sans:400,300,600,700' rel='stylesheet' type='text/css'>
    <link href="/content/custom.css" rel='stylesheet' type='text/css'>
    <script src="/content/tips.js"></script>
    <link rel="stylesheet" type="text/css" href="/content/snippets.css" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <script language="javascript" type="text/javascript">
      function init() {
          websocket = new WebSocket("ws://"+window.location.host+"/websocket");
          websocket.onmessage = function(evt) { location.reload(); };
      }
      window.addEventListener("load", init, false);
    </script>
    
  <title>Pacman game - F# |> BABEL</title>
  <script src="../scripts/core.min.js"></script>
  <script src="../scripts/require.js"></script>
  <meta name="description" content="Pacman finds himself in a grid filled with monsters...">

</head>
<body>

  <div class="fb-navbar">
  <div class="container">
  <nav class="navbar navbar-default">
    <div class="navbar-wrapper">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Fable</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class=""><a href="/">home</a></li>
          <li class="active"><a href="/samples.html">samples</a></li>
          <li class=""><a href="/docs.html">docs</a></li>
          <li><a href="https://github.com/fsprojects/Fable">source</a></li>
        </ul>
      </div>
    </div>
  </nav>
  </div>
  </div>

  <div class="fb-content-wrapper">
  
<div class="fb-heading">
<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <h1>Pacman game</h1>
      <p>Pacman finds himself in a grid filled with monsters...</p>
    </div>
  </div>
</div>
</div>

<div class="container fb-content">
  <div class="row">
    <div class="col-md-1 col-lg-2"></div>
    <div class="col-sm-12 col-md-10 col-lg-8">
      <p><p> Pacman finds himself in a grid filled with monsters... This is probably the most complex sample here.
It involves rendering the maze, AI for the ghosts, user interaction and even playing sound effects.
The game has some brief commentary, but if you want to learn Fable, look at the above examples
first. The <a href="https://github.com/fsprojects/Fable/blob/master/samples/browser/pacman/pacman.fsx">raw source code is on GitHub</a>
as usual!</p>
<p>To play the game, click anywhere to start it and then use the <code>Z</code> and <code>X</code> keys for moving left and right
and the <code>Q</code> and <code>A</code> keys for moving up and down. Make sure to turn on your volume too :-).</p></p>
    </div>
    <div class="col-md-1 col-lg-2"></div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <div style="height:300px; width:300px; margin:20px auto 20px auto; position:relative;">
        
    <div style="text-align:center">
        <canvas style="margin-left:auto;margin-right:auto; width:300px;height:300px;" id="canvas" width="300" height="300"></canvas>
    </div>
  
      </div>
      <script>
        requirejs.config({
          baseUrl: '.',
          paths: { 'fable-core': '../scripts/fable-core.min' }
        });
        requirejs(["pacman"]);
      </script>
    </div>
  </div>

  <div class="row">
    <div class="col-md-1 col-lg-2"></div>
    <div class="col-sm-12 col-md-10 col-lg-8">
      <p>This is a full blown Pacman game. If you're looking for an introduction to Fable
then visit other tutorials, in particular the <a href="../mario/index.html">Mario game</a> which
is much simpler.</p>
<h2><a name="Implementing-the-maze" class="anchor" href="#Implementing-the-maze">Implementing the maze</a></h2>
<h3><a name="Loading-maze-and-graphics" class="anchor" href="#Loading-maze-and-graphics">Loading maze and graphics</a></h3>
<p>Some of the graphics, maze structure and walls are defined as embedded strings or
arrays in the following section, so that the game is stand-alone and easily portable.</p>
<p>The following block embeds the ghosts and other parts of graphics as Base64 encoded strings.
This way, we can load them without making additional server requests:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 32)" onmouseover="showTip(event, 'fs16', 32)" class="i">cyand</span> <span class="o">=</span> <span id="fst17" onmouseout="hideTip(event, 'fs17', 33)" onmouseover="showTip(event, 'fs17', 33, document.getElementById('fst17'))" class="omitted">"data:image/png;base64,iVBOR..."</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 34)" onmouseover="showTip(event, 'fs18', 34)" class="i">oranged</span> <span class="o">=</span> <span id="fst19" onmouseout="hideTip(event, 'fs19', 35)" onmouseover="showTip(event, 'fs19', 35, document.getElementById('fst19'))" class="omitted">"data:image/png;base64,iVBOR..."</span>
<span id="fst20" onmouseout="hideTip(event, 'fs20', 36)" onmouseover="showTip(event, 'fs20', 36, document.getElementById('fst20'))" class="omitted">(Other images omitted)</span>

<span class="c">// Create image using the specified data</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 37)" onmouseover="showTip(event, 'fs21', 37)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs22', 38)" onmouseover="showTip(event, 'fs22', 38)" class="i">data</span> <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 39)" onmouseover="showTip(event, 'fs23', 39)" class="i">img</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 40)" onmouseover="showTip(event, 'fs24', 40)" class="i">document</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 41)" onmouseover="showTip(event, 'fs25', 41)" class="f">createElement_img</span>()
  <span onmouseout="hideTip(event, 'fs23', 42)" onmouseover="showTip(event, 'fs23', 42)" class="i">img</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 43)" onmouseover="showTip(event, 'fs26', 43)" class="i">src</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs22', 44)" onmouseover="showTip(event, 'fs22', 44)" class="i">data</span>
  <span onmouseout="hideTip(event, 'fs23', 45)" onmouseover="showTip(event, 'fs23', 45)" class="i">img</span>
</code></pre></td>
</tr>
</table>
<p>The second part defines the maze, tile bits and blank block. The maze is defined as one big string
using ASCII-art encoding. Where <code>/7LJ</code> represent corners (upper-left, upper-right, lower-left and lower-right),
<code>!|-_</code> represent walls (left, right, top, bottom)<code>and</code>o.` represent two kinds of pills in the maze.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Define the structure of the maze using ASCII</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs27', 46)" onmouseover="showTip(event, 'fs27', 46)" class="i">maze</span> <span class="o">=</span> 
  <span id="fst28" onmouseout="hideTip(event, 'fs28', 47)" onmouseover="showTip(event, 'fs28', 47, document.getElementById('fst28'))" class="omitted">"##|./__7./___7.|!./___7./__7.|##,"...</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 48)" onmouseover="showTip(event, 'fs29', 48)" class="i">tileBits</span> <span class="o">=</span> 
 [| [|<span class="n">0b00000000</span>;<span class="n">0b00000000</span>;<span class="n">0b00000000</span>;
      <span class="n">0b00000000</span>;<span class="n">0b00000011</span>;<span class="n">0b00000100</span>;
      <span class="n">0b00001000</span>;<span class="n">0b00001000</span>|] 
    <span id="fst30" onmouseout="hideTip(event, 'fs30', 49)" onmouseover="showTip(event, 'fs30', 49, document.getElementById('fst30'))" class="omitted">[|0b00000000;0b00000000;...</span> |]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 50)" onmouseover="showTip(event, 'fs31', 50)" class="i">blank</span> <span class="o">=</span> 
  [| <span class="n">0b00000000</span>;<span class="n">0b00000000</span>;<span class="n">0b00000000</span>;
     <span id="fst32" onmouseout="hideTip(event, 'fs32', 51)" onmouseover="showTip(event, 'fs32', 51, document.getElementById('fst32'))" class="omitted">0b00000000;0b00000000; ...</span>|]
</code></pre></td>
</tr>
</table>
<h3><a name="Checking-for-walls" class="anchor" href="#Checking-for-walls">Checking for walls</a></h3>
<p>The following functions parse the maze representation and check various properties of the maze.
Those are used for rendering, but also for checking whether Pacman can go in a given direction.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Characters _|!/7LJ represent different walls</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 52)" onmouseover="showTip(event, 'fs33', 52)" class="f">isWall</span> (<span onmouseout="hideTip(event, 'fs34', 53)" onmouseover="showTip(event, 'fs34', 53)" class="i">c</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs35', 54)" onmouseover="showTip(event, 'fs35', 54)" class="t">char</span>) <span class="o">=</span> 
  <span class="s">&quot;_|!/7LJ-&quot;</span><span class="o">.</span><span class="f">IndexOf</span>(<span onmouseout="hideTip(event, 'fs34', 55)" onmouseover="showTip(event, 'fs34', 55)" class="i">c</span>) <span class="o">&lt;&gt;</span> <span class="o">-</span><span class="n">1</span>

<span class="c">/// Returns &#39; &#39; for positions outside of range</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 56)" onmouseover="showTip(event, 'fs36', 56)" class="f">tileAt</span> (<span onmouseout="hideTip(event, 'fs37', 57)" onmouseover="showTip(event, 'fs37', 57)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 58)" onmouseover="showTip(event, 'fs38', 58)" class="i">y</span>) <span class="o">=</span> 
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs37', 59)" onmouseover="showTip(event, 'fs37', 59)" class="i">x</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">||</span> <span onmouseout="hideTip(event, 'fs37', 60)" onmouseover="showTip(event, 'fs37', 60)" class="i">x</span> <span class="o">&gt;</span> <span class="n">30</span> <span class="k">then</span> <span class="s">&#39; &#39;</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs27', 61)" onmouseover="showTip(event, 'fs27', 61)" class="i">maze</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs38', 62)" onmouseover="showTip(event, 'fs38', 62)" class="i">y</span>]<span class="o">.</span>[<span onmouseout="hideTip(event, 'fs37', 63)" onmouseover="showTip(event, 'fs37', 63)" class="i">x</span>]

<span class="c">/// Is the maze tile at x,y a wall?</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs39', 64)" onmouseover="showTip(event, 'fs39', 64)" class="f">isWallAt</span> (<span onmouseout="hideTip(event, 'fs37', 65)" onmouseover="showTip(event, 'fs37', 65)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 66)" onmouseover="showTip(event, 'fs38', 66)" class="i">y</span>) <span class="o">=</span> 
  <span onmouseout="hideTip(event, 'fs36', 67)" onmouseover="showTip(event, 'fs36', 67)" class="f">tileAt</span>(<span onmouseout="hideTip(event, 'fs37', 68)" onmouseover="showTip(event, 'fs37', 68)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 69)" onmouseover="showTip(event, 'fs38', 69)" class="i">y</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs33', 70)" onmouseover="showTip(event, 'fs33', 70)" class="f">isWall</span>

<span class="c">// Is Pacman at a point where it can turn?</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs40', 71)" onmouseover="showTip(event, 'fs40', 71)" class="f">verticallyAligned</span> (<span onmouseout="hideTip(event, 'fs37', 72)" onmouseover="showTip(event, 'fs37', 72)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs41', 73)" onmouseover="showTip(event, 'fs41', 73)" class="i">y</span>) <span class="o">=</span>  (<span onmouseout="hideTip(event, 'fs37', 74)" onmouseover="showTip(event, 'fs37', 74)" class="i">x</span> <span class="o">%</span> <span class="n">8</span>) <span class="o">=</span> <span class="n">5</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs42', 75)" onmouseover="showTip(event, 'fs42', 75)" class="f">horizontallyAligned</span> (<span onmouseout="hideTip(event, 'fs43', 76)" onmouseover="showTip(event, 'fs43', 76)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 77)" onmouseover="showTip(event, 'fs38', 77)" class="i">y</span>) <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs38', 78)" onmouseover="showTip(event, 'fs38', 78)" class="i">y</span> <span class="o">%</span> <span class="n">8</span>) <span class="o">=</span> <span class="n">5</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 79)" onmouseover="showTip(event, 'fs44', 79)" class="f">isAligned</span> <span onmouseout="hideTip(event, 'fs45', 80)" onmouseover="showTip(event, 'fs45', 80)" class="i">n</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs45', 81)" onmouseover="showTip(event, 'fs45', 81)" class="i">n</span> <span class="o">%</span> <span class="n">8</span>) <span class="o">=</span> <span class="n">5</span>

<span class="c">// Check whether Pacman can go in given direction</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 82)" onmouseover="showTip(event, 'fs46', 82)" class="f">noWall</span> (<span onmouseout="hideTip(event, 'fs37', 83)" onmouseover="showTip(event, 'fs37', 83)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 84)" onmouseover="showTip(event, 'fs38', 84)" class="i">y</span>) (<span onmouseout="hideTip(event, 'fs47', 85)" onmouseover="showTip(event, 'fs47', 85)" class="i">ex</span>,<span onmouseout="hideTip(event, 'fs48', 86)" onmouseover="showTip(event, 'fs48', 86)" class="i">ey</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs49', 87)" onmouseover="showTip(event, 'fs49', 87)" class="i">bx</span>, <span onmouseout="hideTip(event, 'fs50', 88)" onmouseover="showTip(event, 'fs50', 88)" class="i">by</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs37', 89)" onmouseover="showTip(event, 'fs37', 89)" class="i">x</span><span class="o">+</span><span class="n">6</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs47', 90)" onmouseover="showTip(event, 'fs47', 90)" class="i">ex</span>) <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">3</span>, (<span onmouseout="hideTip(event, 'fs38', 91)" onmouseover="showTip(event, 'fs38', 91)" class="i">y</span><span class="o">+</span><span class="n">6</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs48', 92)" onmouseover="showTip(event, 'fs48', 92)" class="i">ey</span>) <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">3</span>
  <span onmouseout="hideTip(event, 'fs39', 93)" onmouseover="showTip(event, 'fs39', 93)" class="f">isWallAt</span> (<span onmouseout="hideTip(event, 'fs49', 94)" onmouseover="showTip(event, 'fs49', 94)" class="i">bx</span>,<span onmouseout="hideTip(event, 'fs50', 95)" onmouseover="showTip(event, 'fs50', 95)" class="i">by</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs51', 96)" onmouseover="showTip(event, 'fs51', 96)" class="f">not</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs52', 97)" onmouseover="showTip(event, 'fs52', 97)" class="f">canGoUp</span> (<span onmouseout="hideTip(event, 'fs37', 98)" onmouseover="showTip(event, 'fs37', 98)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 99)" onmouseover="showTip(event, 'fs38', 99)" class="i">y</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs44', 100)" onmouseover="showTip(event, 'fs44', 100)" class="f">isAligned</span> <span onmouseout="hideTip(event, 'fs37', 101)" onmouseover="showTip(event, 'fs37', 101)" class="i">x</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs46', 102)" onmouseover="showTip(event, 'fs46', 102)" class="f">noWall</span> (<span onmouseout="hideTip(event, 'fs37', 103)" onmouseover="showTip(event, 'fs37', 103)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 104)" onmouseover="showTip(event, 'fs38', 104)" class="i">y</span>) (<span class="n">0</span>,<span class="o">-</span><span class="n">4</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs53', 105)" onmouseover="showTip(event, 'fs53', 105)" class="f">canGoDown</span> (<span onmouseout="hideTip(event, 'fs37', 106)" onmouseover="showTip(event, 'fs37', 106)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 107)" onmouseover="showTip(event, 'fs38', 107)" class="i">y</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs44', 108)" onmouseover="showTip(event, 'fs44', 108)" class="f">isAligned</span> <span onmouseout="hideTip(event, 'fs37', 109)" onmouseover="showTip(event, 'fs37', 109)" class="i">x</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs46', 110)" onmouseover="showTip(event, 'fs46', 110)" class="f">noWall</span> (<span onmouseout="hideTip(event, 'fs37', 111)" onmouseover="showTip(event, 'fs37', 111)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 112)" onmouseover="showTip(event, 'fs38', 112)" class="i">y</span>) (<span class="n">0</span>,<span class="n">5</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs54', 113)" onmouseover="showTip(event, 'fs54', 113)" class="f">canGoLeft</span> (<span onmouseout="hideTip(event, 'fs37', 114)" onmouseover="showTip(event, 'fs37', 114)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 115)" onmouseover="showTip(event, 'fs38', 115)" class="i">y</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs44', 116)" onmouseover="showTip(event, 'fs44', 116)" class="f">isAligned</span> <span onmouseout="hideTip(event, 'fs38', 117)" onmouseover="showTip(event, 'fs38', 117)" class="i">y</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs46', 118)" onmouseover="showTip(event, 'fs46', 118)" class="f">noWall</span> (<span onmouseout="hideTip(event, 'fs37', 119)" onmouseover="showTip(event, 'fs37', 119)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 120)" onmouseover="showTip(event, 'fs38', 120)" class="i">y</span>) (<span class="o">-</span><span class="n">4</span>,<span class="n">0</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs55', 121)" onmouseover="showTip(event, 'fs55', 121)" class="f">canGoRight</span> (<span onmouseout="hideTip(event, 'fs37', 122)" onmouseover="showTip(event, 'fs37', 122)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 123)" onmouseover="showTip(event, 'fs38', 123)" class="i">y</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs44', 124)" onmouseover="showTip(event, 'fs44', 124)" class="f">isAligned</span> <span onmouseout="hideTip(event, 'fs38', 125)" onmouseover="showTip(event, 'fs38', 125)" class="i">y</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs46', 126)" onmouseover="showTip(event, 'fs46', 126)" class="f">noWall</span> (<span onmouseout="hideTip(event, 'fs37', 127)" onmouseover="showTip(event, 'fs37', 127)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 128)" onmouseover="showTip(event, 'fs38', 128)" class="i">y</span>) (<span class="n">5</span>,<span class="n">0</span>)
</code></pre></td>
</tr>
</table>
<h3><a name="Background-rendering" class="anchor" href="#Background-rendering">Background rendering</a></h3>
<p>To render the background, we first fill the background
and then iterate over the string lines that represent the maze and we draw images of
walls specified in the <code>tileBits</code> value earlier (or use <code>blank</code> tile for all other characters).</p>
<p>The following is used to map from tile characters to the <code>tileBits</code> values and to draw individual lines:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Mapping from Maze walls to tileBits</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs56', 129)" onmouseover="showTip(event, 'fs56', 129)" class="i">tileColors</span> <span class="o">=</span> <span class="s">&quot;BBBBBBBBBYY&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs57', 130)" onmouseover="showTip(event, 'fs57', 130)" class="i">tileChars</span> <span class="o">=</span>  <span class="s">&quot;/_7|!L-J=.o&quot;</span>

<span class="c">/// Returns tile for a given Maze character</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs58', 131)" onmouseover="showTip(event, 'fs58', 131)" class="f">toTile</span> (<span onmouseout="hideTip(event, 'fs34', 132)" onmouseover="showTip(event, 'fs34', 132)" class="i">c</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs35', 133)" onmouseover="showTip(event, 'fs35', 133)" class="t">char</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs59', 134)" onmouseover="showTip(event, 'fs59', 134)" class="i">i</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs57', 135)" onmouseover="showTip(event, 'fs57', 135)" class="i">tileChars</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 136)" onmouseover="showTip(event, 'fs60', 136)" class="f">IndexOf</span>(<span onmouseout="hideTip(event, 'fs34', 137)" onmouseover="showTip(event, 'fs34', 137)" class="i">c</span>)
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs59', 138)" onmouseover="showTip(event, 'fs59', 138)" class="i">i</span> <span class="o">=</span> <span class="o">-</span><span class="n">1</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs31', 139)" onmouseover="showTip(event, 'fs31', 139)" class="i">blank</span>, <span class="s">&#39;B&#39;</span>
  <span class="k">else</span> <span onmouseout="hideTip(event, 'fs29', 140)" onmouseover="showTip(event, 'fs29', 140)" class="i">tileBits</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs59', 141)" onmouseover="showTip(event, 'fs59', 141)" class="i">i</span>], <span onmouseout="hideTip(event, 'fs56', 142)" onmouseover="showTip(event, 'fs56', 142)" class="i">tileColors</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs59', 143)" onmouseover="showTip(event, 'fs59', 143)" class="i">i</span>]

<span class="c">/// Draw the lines specified by a wall tile</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs61', 144)" onmouseover="showTip(event, 'fs61', 144)" class="f">draw</span> <span onmouseout="hideTip(event, 'fs62', 145)" onmouseover="showTip(event, 'fs62', 145)" class="f">f</span> (<span onmouseout="hideTip(event, 'fs63', 146)" onmouseover="showTip(event, 'fs63', 146)" class="i">lines</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs64', 147)" onmouseover="showTip(event, 'fs64', 147)" class="t">int</span>[]) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs65', 148)" onmouseover="showTip(event, 'fs65', 148)" class="i">width</span> <span class="o">=</span> <span class="n">8</span>
  <span onmouseout="hideTip(event, 'fs63', 149)" onmouseover="showTip(event, 'fs63', 149)" class="i">lines</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 150)" onmouseover="showTip(event, 'fs66', 150)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 151)" onmouseover="showTip(event, 'fs67', 151)" class="f">iteri</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs38', 152)" onmouseover="showTip(event, 'fs38', 152)" class="i">y</span> <span onmouseout="hideTip(event, 'fs68', 153)" onmouseover="showTip(event, 'fs68', 153)" class="i">line</span> <span class="k">-&gt;</span>
    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs37', 154)" onmouseover="showTip(event, 'fs37', 154)" class="i">x</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span onmouseout="hideTip(event, 'fs65', 155)" onmouseover="showTip(event, 'fs65', 155)" class="i">width</span><span class="o">-</span><span class="n">1</span> <span class="k">do</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs69', 156)" onmouseover="showTip(event, 'fs69', 156)" class="i">bit</span> <span class="o">=</span> (<span class="n">1</span> <span class="o">&lt;&lt;&lt;</span> (<span onmouseout="hideTip(event, 'fs65', 157)" onmouseover="showTip(event, 'fs65', 157)" class="i">width</span> <span class="o">-</span> <span class="n">1</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs37', 158)" onmouseover="showTip(event, 'fs37', 158)" class="i">x</span>))
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs70', 159)" onmouseover="showTip(event, 'fs70', 159)" class="i">pattern</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs68', 160)" onmouseover="showTip(event, 'fs68', 160)" class="i">line</span> <span class="o">&amp;&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs69', 161)" onmouseover="showTip(event, 'fs69', 161)" class="i">bit</span>
      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs70', 162)" onmouseover="showTip(event, 'fs70', 162)" class="i">pattern</span> <span class="o">&lt;&gt;</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs62', 163)" onmouseover="showTip(event, 'fs62', 163)" class="f">f</span> (<span onmouseout="hideTip(event, 'fs37', 164)" onmouseover="showTip(event, 'fs37', 164)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 165)" onmouseover="showTip(event, 'fs38', 165)" class="i">y</span>) )

<span class="c">/// Creates a brush for rendering the given RGBA color</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs71', 166)" onmouseover="showTip(event, 'fs71', 166)" class="f">createBrush</span> (<span onmouseout="hideTip(event, 'fs72', 167)" onmouseover="showTip(event, 'fs72', 167)" class="i">context</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs73', 168)" onmouseover="showTip(event, 'fs73', 168)" class="t">CanvasRenderingContext2D</span>) (<span onmouseout="hideTip(event, 'fs74', 169)" onmouseover="showTip(event, 'fs74', 169)" class="i">r</span>,<span onmouseout="hideTip(event, 'fs75', 170)" onmouseover="showTip(event, 'fs75', 170)" class="i">g</span>,<span onmouseout="hideTip(event, 'fs76', 171)" onmouseover="showTip(event, 'fs76', 171)" class="i">b</span>,<span onmouseout="hideTip(event, 'fs77', 172)" onmouseover="showTip(event, 'fs77', 172)" class="i">a</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs78', 173)" onmouseover="showTip(event, 'fs78', 173)" class="i">id</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs72', 174)" onmouseover="showTip(event, 'fs72', 174)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs79', 175)" onmouseover="showTip(event, 'fs79', 175)" class="f">createImageData</span>(<span onmouseout="hideTip(event, 'fs80', 176)" onmouseover="showTip(event, 'fs80', 176)" class="t">U2</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs81', 177)" onmouseover="showTip(event, 'fs81', 177)" class="p">Case1</span> <span class="n">1.0</span>, <span class="n">1.0</span>)
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs82', 178)" onmouseover="showTip(event, 'fs82', 178)" class="i">d</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs78', 179)" onmouseover="showTip(event, 'fs78', 179)" class="i">id</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs83', 180)" onmouseover="showTip(event, 'fs83', 180)" class="i">data</span>
  <span onmouseout="hideTip(event, 'fs82', 181)" onmouseover="showTip(event, 'fs82', 181)" class="i">d</span><span class="o">.</span>[<span class="n">0.</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs14', 182)" onmouseover="showTip(event, 'fs14', 182)" class="f">float</span> <span onmouseout="hideTip(event, 'fs74', 183)" onmouseover="showTip(event, 'fs74', 183)" class="i">r</span>; <span onmouseout="hideTip(event, 'fs82', 184)" onmouseover="showTip(event, 'fs82', 184)" class="i">d</span><span class="o">.</span>[<span class="n">1.</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs14', 185)" onmouseover="showTip(event, 'fs14', 185)" class="f">float</span> <span onmouseout="hideTip(event, 'fs75', 186)" onmouseover="showTip(event, 'fs75', 186)" class="i">g</span>
  <span onmouseout="hideTip(event, 'fs82', 187)" onmouseover="showTip(event, 'fs82', 187)" class="i">d</span><span class="o">.</span>[<span class="n">2.</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs14', 188)" onmouseover="showTip(event, 'fs14', 188)" class="f">float</span> <span onmouseout="hideTip(event, 'fs76', 189)" onmouseover="showTip(event, 'fs76', 189)" class="i">b</span>; <span onmouseout="hideTip(event, 'fs82', 190)" onmouseover="showTip(event, 'fs82', 190)" class="i">d</span><span class="o">.</span>[<span class="n">3.</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs14', 191)" onmouseover="showTip(event, 'fs14', 191)" class="f">float</span> <span onmouseout="hideTip(event, 'fs77', 192)" onmouseover="showTip(event, 'fs77', 192)" class="i">a</span>
  <span onmouseout="hideTip(event, 'fs78', 193)" onmouseover="showTip(event, 'fs78', 193)" class="i">id</span>
</code></pre></td>
</tr>
</table>
<p>The main function for rendering background just fills the canvas with a black color and
then iterates over the Maze tiles and renders individual walls:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs84', 194)" onmouseover="showTip(event, 'fs84', 194)" class="f">createBackground</span> () <span class="o">=</span>
  <span class="c">// Fill background with black</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 195)" onmouseover="showTip(event, 'fs85', 195)" class="i">background</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 196)" onmouseover="showTip(event, 'fs24', 196)" class="i">document</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs86', 197)" onmouseover="showTip(event, 'fs86', 197)" class="f">createElement_canvas</span>()
  <span onmouseout="hideTip(event, 'fs85', 198)" onmouseover="showTip(event, 'fs85', 198)" class="i">background</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs87', 199)" onmouseover="showTip(event, 'fs87', 199)" class="i">width</span> <span class="o">&lt;-</span> <span class="n">256.</span>
  <span onmouseout="hideTip(event, 'fs85', 200)" onmouseover="showTip(event, 'fs85', 200)" class="i">background</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs88', 201)" onmouseover="showTip(event, 'fs88', 201)" class="i">height</span> <span class="o">&lt;-</span> <span class="n">256.</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 202)" onmouseover="showTip(event, 'fs72', 202)" class="i">context</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs85', 203)" onmouseover="showTip(event, 'fs85', 203)" class="i">background</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 204)" onmouseover="showTip(event, 'fs89', 204)" class="f">getContext_2d</span>()
  <span onmouseout="hideTip(event, 'fs72', 205)" onmouseover="showTip(event, 'fs72', 205)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 206)" onmouseover="showTip(event, 'fs90', 206)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs91', 207)" onmouseover="showTip(event, 'fs91', 207)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 208)" onmouseover="showTip(event, 'fs92', 208)" class="p">Case1</span> <span class="s">&quot;rgb(0,0,0)&quot;</span>
  <span onmouseout="hideTip(event, 'fs72', 209)" onmouseover="showTip(event, 'fs72', 209)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 210)" onmouseover="showTip(event, 'fs93', 210)" class="f">fillRect</span> (<span class="n">0.</span>, <span class="n">0.</span> , <span class="n">256.</span>, <span class="n">256.</span>);

  <span class="c">// Render individual tiles of the maze</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs94', 211)" onmouseover="showTip(event, 'fs94', 211)" class="i">blue</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs71', 212)" onmouseover="showTip(event, 'fs71', 212)" class="f">createBrush</span> <span onmouseout="hideTip(event, 'fs72', 213)" onmouseover="showTip(event, 'fs72', 213)" class="i">context</span> (<span class="n">63</span>,<span class="n">63</span>,<span class="n">255</span>,<span class="n">255</span>)
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs95', 214)" onmouseover="showTip(event, 'fs95', 214)" class="i">yellow</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs71', 215)" onmouseover="showTip(event, 'fs71', 215)" class="f">createBrush</span> <span onmouseout="hideTip(event, 'fs72', 216)" onmouseover="showTip(event, 'fs72', 216)" class="i">context</span> (<span class="n">255</span>,<span class="n">255</span>,<span class="n">0</span>,<span class="n">255</span>)
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs96', 217)" onmouseover="showTip(event, 'fs96', 217)" class="i">lines</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs27', 218)" onmouseover="showTip(event, 'fs27', 218)" class="i">maze</span>
  <span class="k">for</span> <span onmouseout="hideTip(event, 'fs38', 219)" onmouseover="showTip(event, 'fs38', 219)" class="i">y</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span onmouseout="hideTip(event, 'fs96', 220)" onmouseover="showTip(event, 'fs96', 220)" class="i">lines</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 221)" onmouseover="showTip(event, 'fs97', 221)" class="i">Length</span><span class="o">-</span><span class="n">1</span> <span class="k">do</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs98', 222)" onmouseover="showTip(event, 'fs98', 222)" class="i">line</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs96', 223)" onmouseover="showTip(event, 'fs96', 223)" class="i">lines</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs38', 224)" onmouseover="showTip(event, 'fs38', 224)" class="i">y</span>]
    <span class="k">for</span> <span onmouseout="hideTip(event, 'fs37', 225)" onmouseover="showTip(event, 'fs37', 225)" class="i">x</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span onmouseout="hideTip(event, 'fs98', 226)" onmouseover="showTip(event, 'fs98', 226)" class="i">line</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs99', 227)" onmouseover="showTip(event, 'fs99', 227)" class="i">Length</span><span class="o">-</span><span class="n">1</span> <span class="k">do</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 228)" onmouseover="showTip(event, 'fs34', 228)" class="i">c</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs98', 229)" onmouseover="showTip(event, 'fs98', 229)" class="i">line</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs37', 230)" onmouseover="showTip(event, 'fs37', 230)" class="i">x</span>]
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs100', 231)" onmouseover="showTip(event, 'fs100', 231)" class="i">tile</span>, <span onmouseout="hideTip(event, 'fs101', 232)" onmouseover="showTip(event, 'fs101', 232)" class="i">color</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs58', 233)" onmouseover="showTip(event, 'fs58', 233)" class="f">toTile</span> <span onmouseout="hideTip(event, 'fs34', 234)" onmouseover="showTip(event, 'fs34', 234)" class="i">c</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs102', 235)" onmouseover="showTip(event, 'fs102', 235)" class="i">brush</span> <span class="o">=</span> <span class="k">match</span> <span onmouseout="hideTip(event, 'fs101', 236)" onmouseover="showTip(event, 'fs101', 236)" class="i">color</span> <span class="k">with</span> <span class="s">&#39;Y&#39;</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs95', 237)" onmouseover="showTip(event, 'fs95', 237)" class="i">yellow</span> | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs94', 238)" onmouseover="showTip(event, 'fs94', 238)" class="i">blue</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs62', 239)" onmouseover="showTip(event, 'fs62', 239)" class="f">f</span> (<span onmouseout="hideTip(event, 'fs103', 240)" onmouseover="showTip(event, 'fs103', 240)" class="i">x&#39;</span>,<span onmouseout="hideTip(event, 'fs104', 241)" onmouseover="showTip(event, 'fs104', 241)" class="i">y&#39;</span>) <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs72', 242)" onmouseover="showTip(event, 'fs72', 242)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs105', 243)" onmouseover="showTip(event, 'fs105', 243)" class="f">putImageData</span>
          (<span onmouseout="hideTip(event, 'fs102', 244)" onmouseover="showTip(event, 'fs102', 244)" class="i">brush</span>, <span onmouseout="hideTip(event, 'fs14', 245)" onmouseover="showTip(event, 'fs14', 245)" class="f">float</span> (<span onmouseout="hideTip(event, 'fs37', 246)" onmouseover="showTip(event, 'fs37', 246)" class="i">x</span><span class="o">*</span><span class="n">8</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs103', 247)" onmouseover="showTip(event, 'fs103', 247)" class="i">x&#39;</span>), <span onmouseout="hideTip(event, 'fs14', 248)" onmouseover="showTip(event, 'fs14', 248)" class="f">float</span> (<span onmouseout="hideTip(event, 'fs38', 249)" onmouseover="showTip(event, 'fs38', 249)" class="i">y</span><span class="o">*</span><span class="n">8</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs104', 250)" onmouseover="showTip(event, 'fs104', 250)" class="i">y&#39;</span>))
      <span onmouseout="hideTip(event, 'fs61', 251)" onmouseover="showTip(event, 'fs61', 251)" class="f">draw</span> <span onmouseout="hideTip(event, 'fs62', 252)" onmouseover="showTip(event, 'fs62', 252)" class="f">f</span> <span onmouseout="hideTip(event, 'fs100', 253)" onmouseover="showTip(event, 'fs100', 253)" class="i">tile</span>
  <span onmouseout="hideTip(event, 'fs85', 254)" onmouseover="showTip(event, 'fs85', 254)" class="i">background</span>

<span class="c">/// Clear whatever is rendered in the specified Maze cell</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs106', 255)" onmouseover="showTip(event, 'fs106', 255)" class="f">clearCell</span> (<span onmouseout="hideTip(event, 'fs85', 256)" onmouseover="showTip(event, 'fs85', 256)" class="i">background</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs107', 257)" onmouseover="showTip(event, 'fs107', 257)" class="t">HTMLCanvasElement</span>) (<span onmouseout="hideTip(event, 'fs37', 258)" onmouseover="showTip(event, 'fs37', 258)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 259)" onmouseover="showTip(event, 'fs38', 259)" class="i">y</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 260)" onmouseover="showTip(event, 'fs72', 260)" class="i">context</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs85', 261)" onmouseover="showTip(event, 'fs85', 261)" class="i">background</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 262)" onmouseover="showTip(event, 'fs89', 262)" class="f">getContext_2d</span>()
  <span onmouseout="hideTip(event, 'fs72', 263)" onmouseover="showTip(event, 'fs72', 263)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 264)" onmouseover="showTip(event, 'fs90', 264)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs91', 265)" onmouseover="showTip(event, 'fs91', 265)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 266)" onmouseover="showTip(event, 'fs92', 266)" class="p">Case1</span> <span class="s">&quot;rgb(0,0,0)&quot;</span>
  <span onmouseout="hideTip(event, 'fs72', 267)" onmouseover="showTip(event, 'fs72', 267)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 268)" onmouseover="showTip(event, 'fs93', 268)" class="f">fillRect</span> (<span onmouseout="hideTip(event, 'fs14', 269)" onmouseover="showTip(event, 'fs14', 269)" class="f">float</span> (<span onmouseout="hideTip(event, 'fs37', 270)" onmouseover="showTip(event, 'fs37', 270)" class="i">x</span><span class="o">*</span><span class="n">8</span>), <span onmouseout="hideTip(event, 'fs14', 271)" onmouseover="showTip(event, 'fs14', 271)" class="f">float</span> (<span onmouseout="hideTip(event, 'fs38', 272)" onmouseover="showTip(event, 'fs38', 272)" class="i">y</span><span class="o">*</span><span class="n">8</span>), <span class="n">8.</span>, <span class="n">8.</span>);
</code></pre></td>
</tr>
</table>
<h2><a name="Creating-smart-ghosts" class="anchor" href="#Creating-smart-ghosts">Creating smart ghosts</a></h2>
<h3><a name="Creating-ghosts" class="anchor" href="#Creating-ghosts">Creating ghosts</a></h3>
<p>Ghosts are represented by a simple F# class type that contains the image of the ghost,
current X, Y positions and a velocity in both directions. In Pacman, ghosts are mutable
and expose <code>Move</code> and <code>Reset</code> methods that change their properties.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Wrap around the sides of the Maze</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs108', 273)" onmouseover="showTip(event, 'fs108', 273)" class="f">wrap</span> (<span onmouseout="hideTip(event, 'fs37', 274)" onmouseover="showTip(event, 'fs37', 274)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 275)" onmouseover="showTip(event, 'fs38', 275)" class="i">y</span>) (<span onmouseout="hideTip(event, 'fs109', 276)" onmouseover="showTip(event, 'fs109', 276)" class="i">dx</span>,<span onmouseout="hideTip(event, 'fs110', 277)" onmouseover="showTip(event, 'fs110', 277)" class="i">dy</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 278)" onmouseover="showTip(event, 'fs37', 278)" class="i">x</span> <span class="o">=</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs109', 279)" onmouseover="showTip(event, 'fs109', 279)" class="i">dx</span> <span class="o">=</span> <span class="o">-</span><span class="n">1</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs37', 280)" onmouseover="showTip(event, 'fs37', 280)" class="i">x</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span class="n">30</span> <span class="o">*</span> <span class="n">8</span>
    <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs109', 281)" onmouseover="showTip(event, 'fs109', 281)" class="i">dx</span> <span class="o">=</span> <span class="n">1</span>  <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs37', 282)" onmouseover="showTip(event, 'fs37', 282)" class="i">x</span> <span class="o">=</span> <span class="n">30</span> <span class="o">*</span><span class="n">8</span> <span class="k">then</span> <span class="n">0</span>
    <span class="k">else</span> <span onmouseout="hideTip(event, 'fs37', 283)" onmouseover="showTip(event, 'fs37', 283)" class="i">x</span>
  <span onmouseout="hideTip(event, 'fs37', 284)" onmouseover="showTip(event, 'fs37', 284)" class="i">x</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs109', 285)" onmouseover="showTip(event, 'fs109', 285)" class="i">dx</span>, <span onmouseout="hideTip(event, 'fs38', 286)" onmouseover="showTip(event, 'fs38', 286)" class="i">y</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs110', 287)" onmouseover="showTip(event, 'fs110', 287)" class="i">dy</span>

<span class="c">/// Mutable representation of a ghost</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs111', 288)" onmouseover="showTip(event, 'fs111', 288)" class="t">Ghost</span>(<span onmouseout="hideTip(event, 'fs112', 289)" onmouseover="showTip(event, 'fs112', 289)" class="i">image</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs113', 290)" onmouseover="showTip(event, 'fs113', 290)" class="t">HTMLImageElement</span>,<span onmouseout="hideTip(event, 'fs37', 291)" onmouseover="showTip(event, 'fs37', 291)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 292)" onmouseover="showTip(event, 'fs38', 292)" class="i">y</span>,<span onmouseout="hideTip(event, 'fs114', 293)" onmouseover="showTip(event, 'fs114', 293)" class="i">v</span>) <span class="o">=</span>
  <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs115', 294)" onmouseover="showTip(event, 'fs115', 294)" class="v">x&#39;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs37', 295)" onmouseover="showTip(event, 'fs37', 295)" class="i">x</span>
  <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs116', 296)" onmouseover="showTip(event, 'fs116', 296)" class="v">y&#39;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs38', 297)" onmouseover="showTip(event, 'fs38', 297)" class="i">y</span>
  <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs117', 298)" onmouseover="showTip(event, 'fs117', 298)" class="v">v&#39;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs114', 299)" onmouseover="showTip(event, 'fs114', 299)" class="i">v</span>
  <span class="k">member</span> <span class="k">val</span> <span onmouseout="hideTip(event, 'fs118', 300)" onmouseover="showTip(event, 'fs118', 300)" class="i">Image</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs112', 301)" onmouseover="showTip(event, 'fs112', 301)" class="i">image</span>
  <span class="k">member</span> <span class="k">val</span> <span class="v">IsReturning</span> <span class="o">=</span> <span class="k">false</span> <span class="k">with</span> <span class="i">get</span>, <span onmouseout="hideTip(event, 'fs119', 302)" onmouseover="showTip(event, 'fs119', 302)" class="i">set</span>
  <span class="k">member</span> <span class="i">__</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs120', 303)" onmouseover="showTip(event, 'fs120', 303)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs115', 304)" onmouseover="showTip(event, 'fs115', 304)" class="v">x&#39;</span>
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs121', 305)" onmouseover="showTip(event, 'fs121', 305)" class="i">__</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs122', 306)" onmouseover="showTip(event, 'fs122', 306)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs116', 307)" onmouseover="showTip(event, 'fs116', 307)" class="v">y&#39;</span>
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs121', 308)" onmouseover="showTip(event, 'fs121', 308)" class="i">__</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs123', 309)" onmouseover="showTip(event, 'fs123', 309)" class="i">V</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs117', 310)" onmouseover="showTip(event, 'fs117', 310)" class="v">v&#39;</span>
  <span class="c">/// Move back to initial location</span>
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs124', 311)" onmouseover="showTip(event, 'fs124', 311)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs125', 312)" onmouseover="showTip(event, 'fs125', 312)" class="f">Reset</span>() <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs115', 313)" onmouseover="showTip(event, 'fs115', 313)" class="v">x&#39;</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs37', 314)" onmouseover="showTip(event, 'fs37', 314)" class="i">x</span>
    <span onmouseout="hideTip(event, 'fs116', 315)" onmouseover="showTip(event, 'fs116', 315)" class="v">y&#39;</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs38', 316)" onmouseover="showTip(event, 'fs38', 316)" class="i">y</span>
  <span class="c">/// Move in the current direction</span>
  <span class="k">member</span> <span onmouseout="hideTip(event, 'fs124', 317)" onmouseover="showTip(event, 'fs124', 317)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs126', 318)" onmouseover="showTip(event, 'fs126', 318)" class="f">Move</span>(<span onmouseout="hideTip(event, 'fs114', 319)" onmouseover="showTip(event, 'fs114', 319)" class="i">v</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs117', 320)" onmouseover="showTip(event, 'fs117', 320)" class="v">v&#39;</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs114', 321)" onmouseover="showTip(event, 'fs114', 321)" class="i">v</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs109', 322)" onmouseover="showTip(event, 'fs109', 322)" class="i">dx</span>,<span onmouseout="hideTip(event, 'fs110', 323)" onmouseover="showTip(event, 'fs110', 323)" class="i">dy</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs114', 324)" onmouseover="showTip(event, 'fs114', 324)" class="i">v</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 325)" onmouseover="showTip(event, 'fs37', 325)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 326)" onmouseover="showTip(event, 'fs38', 326)" class="i">y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs108', 327)" onmouseover="showTip(event, 'fs108', 327)" class="f">wrap</span> (<span onmouseout="hideTip(event, 'fs115', 328)" onmouseover="showTip(event, 'fs115', 328)" class="v">x&#39;</span>,<span onmouseout="hideTip(event, 'fs116', 329)" onmouseover="showTip(event, 'fs116', 329)" class="v">y&#39;</span>) (<span onmouseout="hideTip(event, 'fs109', 330)" onmouseover="showTip(event, 'fs109', 330)" class="i">dx</span>,<span onmouseout="hideTip(event, 'fs110', 331)" onmouseover="showTip(event, 'fs110', 331)" class="i">dy</span>)
    <span onmouseout="hideTip(event, 'fs115', 332)" onmouseover="showTip(event, 'fs115', 332)" class="v">x&#39;</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs37', 333)" onmouseover="showTip(event, 'fs37', 333)" class="i">x</span>
    <span onmouseout="hideTip(event, 'fs116', 334)" onmouseover="showTip(event, 'fs116', 334)" class="v">y&#39;</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs38', 335)" onmouseover="showTip(event, 'fs38', 335)" class="i">y</span>
</code></pre></td>
</tr>
</table>
<p>At the beginning, we have red, cyan, pink and orange ghosts
in the middle of the maze:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs127', 336)" onmouseover="showTip(event, 'fs127', 336)" class="f">createGhosts</span> <span onmouseout="hideTip(event, 'fs128', 337)" onmouseover="showTip(event, 'fs128', 337)" class="i">context</span> <span class="o">=</span>
  [| <span onmouseout="hideTip(event, 'fs129', 338)" onmouseover="showTip(event, 'fs129', 338)" class="i">redd</span>, (<span class="n">16</span>, <span class="n">11</span>), (<span class="n">1</span>,<span class="n">0</span>)
     <span onmouseout="hideTip(event, 'fs16', 339)" onmouseover="showTip(event, 'fs16', 339)" class="i">cyand</span>, (<span class="n">14</span>, <span class="n">15</span>), (<span class="n">1</span>,<span class="n">0</span>)
     <span onmouseout="hideTip(event, 'fs130', 340)" onmouseover="showTip(event, 'fs130', 340)" class="i">pinkd</span>, (<span class="n">16</span>, <span class="n">13</span>), (<span class="n">0</span>,<span class="o">-</span><span class="n">1</span>)
     <span onmouseout="hideTip(event, 'fs18', 341)" onmouseover="showTip(event, 'fs18', 341)" class="i">oranged</span>, (<span class="n">18</span>, <span class="n">15</span>), (<span class="o">-</span><span class="n">1</span>,<span class="n">0</span>) |]
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 342)" onmouseover="showTip(event, 'fs66', 342)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs131', 343)" onmouseover="showTip(event, 'fs131', 343)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs22', 344)" onmouseover="showTip(event, 'fs22', 344)" class="i">data</span>,(<span onmouseout="hideTip(event, 'fs37', 345)" onmouseover="showTip(event, 'fs37', 345)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 346)" onmouseover="showTip(event, 'fs38', 346)" class="i">y</span>),<span onmouseout="hideTip(event, 'fs114', 347)" onmouseover="showTip(event, 'fs114', 347)" class="i">v</span>) <span class="k">-&gt;</span>
    <span onmouseout="hideTip(event, 'fs111', 348)" onmouseover="showTip(event, 'fs111', 348)" class="t">Ghost</span>(<span onmouseout="hideTip(event, 'fs21', 349)" onmouseover="showTip(event, 'fs21', 349)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs22', 350)" onmouseover="showTip(event, 'fs22', 350)" class="i">data</span>, (<span onmouseout="hideTip(event, 'fs37', 351)" onmouseover="showTip(event, 'fs37', 351)" class="i">x</span><span class="o">*</span><span class="n">8</span>)<span class="o">-</span><span class="n">7</span>, (<span onmouseout="hideTip(event, 'fs38', 352)" onmouseover="showTip(event, 'fs38', 352)" class="i">y</span><span class="o">*</span><span class="n">8</span>)<span class="o">-</span><span class="n">3</span>, <span onmouseout="hideTip(event, 'fs114', 353)" onmouseover="showTip(event, 'fs114', 353)" class="i">v</span>) )
</code></pre></td>
</tr>
</table>
<h3><a name="Generating-Ghost-movement" class="anchor" href="#Generating-Ghost-movement">Generating Ghost movement</a></h3>
<p>For generating Ghost movements, we need an implementation of the <a href="https://en.wikipedia.org/wiki/Flood_fill">Flood fill algorithm</a>,
which we use to generate the shortest path home when Ghosts are returning. The <code>fillValue</code> function does this, by starting
at a specified location (which can be one of the directions in which ghosts can go).</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Recursive flood fill function</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs132', 354)" onmouseover="showTip(event, 'fs132', 354)" class="f">flood</span> <span onmouseout="hideTip(event, 'fs133', 355)" onmouseover="showTip(event, 'fs133', 355)" class="f">canFill</span> <span onmouseout="hideTip(event, 'fs134', 356)" onmouseover="showTip(event, 'fs134', 356)" class="f">fill</span> (<span onmouseout="hideTip(event, 'fs37', 357)" onmouseover="showTip(event, 'fs37', 357)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 358)" onmouseover="showTip(event, 'fs38', 358)" class="i">y</span>) <span class="o">=</span>
  <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs135', 359)" onmouseover="showTip(event, 'fs135', 359)" class="f">f</span> <span onmouseout="hideTip(event, 'fs45', 360)" onmouseover="showTip(event, 'fs45', 360)" class="i">n</span> <span class="o">=</span> <span class="k">function</span>
    | [] <span class="k">-&gt;</span> ()
    | <span onmouseout="hideTip(event, 'fs136', 361)" onmouseover="showTip(event, 'fs136', 361)" class="i">ps</span> <span class="k">-&gt;</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs136', 362)" onmouseover="showTip(event, 'fs136', 362)" class="i">ps</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs136', 363)" onmouseover="showTip(event, 'fs136', 363)" class="i">ps</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs137', 364)" onmouseover="showTip(event, 'fs137', 364)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs138', 365)" onmouseover="showTip(event, 'fs138', 365)" class="f">filter</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs37', 366)" onmouseover="showTip(event, 'fs37', 366)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 367)" onmouseover="showTip(event, 'fs38', 367)" class="i">y</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs133', 368)" onmouseover="showTip(event, 'fs133', 368)" class="f">canFill</span> (<span onmouseout="hideTip(event, 'fs37', 369)" onmouseover="showTip(event, 'fs37', 369)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 370)" onmouseover="showTip(event, 'fs38', 370)" class="i">y</span>))
        <span onmouseout="hideTip(event, 'fs136', 371)" onmouseover="showTip(event, 'fs136', 371)" class="i">ps</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs137', 372)" onmouseover="showTip(event, 'fs137', 372)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs139', 373)" onmouseover="showTip(event, 'fs139', 373)" class="f">iter</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs37', 374)" onmouseover="showTip(event, 'fs37', 374)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 375)" onmouseover="showTip(event, 'fs38', 375)" class="i">y</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs134', 376)" onmouseover="showTip(event, 'fs134', 376)" class="f">fill</span> (<span onmouseout="hideTip(event, 'fs37', 377)" onmouseover="showTip(event, 'fs37', 377)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 378)" onmouseover="showTip(event, 'fs38', 378)" class="i">y</span>,<span onmouseout="hideTip(event, 'fs45', 379)" onmouseover="showTip(event, 'fs45', 379)" class="i">n</span>))
        <span onmouseout="hideTip(event, 'fs136', 380)" onmouseover="showTip(event, 'fs136', 380)" class="i">ps</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs137', 381)" onmouseover="showTip(event, 'fs137', 381)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs140', 382)" onmouseover="showTip(event, 'fs140', 382)" class="f">collect</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs37', 383)" onmouseover="showTip(event, 'fs37', 383)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 384)" onmouseover="showTip(event, 'fs38', 384)" class="i">y</span>) <span class="k">-&gt;</span>
            [(<span onmouseout="hideTip(event, 'fs37', 385)" onmouseover="showTip(event, 'fs37', 385)" class="i">x</span><span class="o">-</span><span class="n">1</span>,<span onmouseout="hideTip(event, 'fs38', 386)" onmouseover="showTip(event, 'fs38', 386)" class="i">y</span>);(<span onmouseout="hideTip(event, 'fs37', 387)" onmouseover="showTip(event, 'fs37', 387)" class="i">x</span><span class="o">+</span><span class="n">1</span>,<span onmouseout="hideTip(event, 'fs38', 388)" onmouseover="showTip(event, 'fs38', 388)" class="i">y</span>);(<span onmouseout="hideTip(event, 'fs37', 389)" onmouseover="showTip(event, 'fs37', 389)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 390)" onmouseover="showTip(event, 'fs38', 390)" class="i">y</span><span class="o">-</span><span class="n">1</span>);(<span onmouseout="hideTip(event, 'fs37', 391)" onmouseover="showTip(event, 'fs37', 391)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 392)" onmouseover="showTip(event, 'fs38', 392)" class="i">y</span><span class="o">+</span><span class="n">1</span>)]) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs135', 393)" onmouseover="showTip(event, 'fs135', 393)" class="f">f</span> (<span onmouseout="hideTip(event, 'fs45', 394)" onmouseover="showTip(event, 'fs45', 394)" class="i">n</span><span class="o">+</span><span class="n">1</span>)
  <span onmouseout="hideTip(event, 'fs135', 395)" onmouseover="showTip(event, 'fs135', 395)" class="f">f</span> <span class="n">0</span> [(<span onmouseout="hideTip(event, 'fs37', 396)" onmouseover="showTip(event, 'fs37', 396)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 397)" onmouseover="showTip(event, 'fs38', 397)" class="i">y</span>)]

<span class="c">/// Possible routes that take the ghost home</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs141', 398)" onmouseover="showTip(event, 'fs141', 398)" class="i">route_home</span> <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs142', 399)" onmouseover="showTip(event, 'fs142', 399)" class="i">numbers</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs27', 400)" onmouseover="showTip(event, 'fs27', 400)" class="i">maze</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 401)" onmouseover="showTip(event, 'fs66', 401)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs131', 402)" onmouseover="showTip(event, 'fs131', 402)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs98', 403)" onmouseover="showTip(event, 'fs98', 403)" class="i">line</span> <span class="k">-&gt;</span>
      <span onmouseout="hideTip(event, 'fs98', 404)" onmouseover="showTip(event, 'fs98', 404)" class="i">line</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs143', 405)" onmouseover="showTip(event, 'fs143', 405)" class="f">ToCharArray</span>()
      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 406)" onmouseover="showTip(event, 'fs66', 406)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs131', 407)" onmouseover="showTip(event, 'fs131', 407)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs34', 408)" onmouseover="showTip(event, 'fs34', 408)" class="i">c</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs33', 409)" onmouseover="showTip(event, 'fs33', 409)" class="f">isWall</span> <span onmouseout="hideTip(event, 'fs34', 410)" onmouseover="showTip(event, 'fs34', 410)" class="i">c</span> <span class="k">then</span> <span class="n">999</span> <span class="k">else</span> <span class="o">-</span><span class="n">1</span>) )
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs133', 411)" onmouseover="showTip(event, 'fs133', 411)" class="f">canFill</span> (<span onmouseout="hideTip(event, 'fs37', 412)" onmouseover="showTip(event, 'fs37', 412)" class="i">x</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs64', 413)" onmouseover="showTip(event, 'fs64', 413)" class="t">int</span>,<span onmouseout="hideTip(event, 'fs38', 414)" onmouseover="showTip(event, 'fs38', 414)" class="i">y</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs64', 415)" onmouseover="showTip(event, 'fs64', 415)" class="t">int</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs38', 416)" onmouseover="showTip(event, 'fs38', 416)" class="i">y</span><span class="o">&gt;</span><span class="o">=</span><span class="n">0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs38', 417)" onmouseover="showTip(event, 'fs38', 417)" class="i">y</span> <span class="o">&lt;</span> (<span onmouseout="hideTip(event, 'fs142', 418)" onmouseover="showTip(event, 'fs142', 418)" class="i">numbers</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 419)" onmouseover="showTip(event, 'fs97', 419)" class="i">Length</span><span class="o">-</span><span class="n">1</span>) <span class="o">&amp;&amp;</span>
    <span onmouseout="hideTip(event, 'fs37', 420)" onmouseover="showTip(event, 'fs37', 420)" class="i">x</span><span class="o">&gt;</span><span class="o">=</span><span class="n">0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs37', 421)" onmouseover="showTip(event, 'fs37', 421)" class="i">x</span> <span class="o">&lt;</span> (<span onmouseout="hideTip(event, 'fs142', 422)" onmouseover="showTip(event, 'fs142', 422)" class="i">numbers</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs38', 423)" onmouseover="showTip(event, 'fs38', 423)" class="i">y</span>]<span class="o">.</span><span class="i">Length</span><span class="o">-</span><span class="n">1</span>) <span class="o">&amp;&amp;</span>
    <span onmouseout="hideTip(event, 'fs142', 424)" onmouseover="showTip(event, 'fs142', 424)" class="i">numbers</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs38', 425)" onmouseover="showTip(event, 'fs38', 425)" class="i">y</span>]<span class="o">.</span>[<span onmouseout="hideTip(event, 'fs37', 426)" onmouseover="showTip(event, 'fs37', 426)" class="i">x</span>] <span class="o">=</span> <span class="o">-</span><span class="n">1</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs134', 427)" onmouseover="showTip(event, 'fs134', 427)" class="f">fill</span> (<span onmouseout="hideTip(event, 'fs37', 428)" onmouseover="showTip(event, 'fs37', 428)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 429)" onmouseover="showTip(event, 'fs38', 429)" class="i">y</span>,<span onmouseout="hideTip(event, 'fs45', 430)" onmouseover="showTip(event, 'fs45', 430)" class="i">n</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs142', 431)" onmouseover="showTip(event, 'fs142', 431)" class="i">numbers</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs38', 432)" onmouseover="showTip(event, 'fs38', 432)" class="i">y</span>]<span class="o">.</span>[<span onmouseout="hideTip(event, 'fs37', 433)" onmouseover="showTip(event, 'fs37', 433)" class="i">x</span>] <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs45', 434)" onmouseover="showTip(event, 'fs45', 434)" class="i">n</span>
  <span onmouseout="hideTip(event, 'fs132', 435)" onmouseover="showTip(event, 'fs132', 435)" class="f">flood</span> <span onmouseout="hideTip(event, 'fs133', 436)" onmouseover="showTip(event, 'fs133', 436)" class="f">canFill</span> <span onmouseout="hideTip(event, 'fs134', 437)" onmouseover="showTip(event, 'fs134', 437)" class="f">fill</span> (<span class="n">16</span>,<span class="n">15</span>)
  <span onmouseout="hideTip(event, 'fs142', 438)" onmouseover="showTip(event, 'fs142', 438)" class="i">numbers</span>

<span class="c">/// Find the shortest way home from specified location </span>
<span class="c">/// (adjusted by offset in which ghosts start)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs144', 439)" onmouseover="showTip(event, 'fs144', 439)" class="f">fillValue</span> (<span onmouseout="hideTip(event, 'fs37', 440)" onmouseover="showTip(event, 'fs37', 440)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 441)" onmouseover="showTip(event, 'fs38', 441)" class="i">y</span>) (<span onmouseout="hideTip(event, 'fs47', 442)" onmouseover="showTip(event, 'fs47', 442)" class="i">ex</span>,<span onmouseout="hideTip(event, 'fs48', 443)" onmouseover="showTip(event, 'fs48', 443)" class="i">ey</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs49', 444)" onmouseover="showTip(event, 'fs49', 444)" class="i">bx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 445)" onmouseover="showTip(event, 'fs64', 445)" class="f">int</span> (<span onmouseout="hideTip(event, 'fs145', 446)" onmouseover="showTip(event, 'fs145', 446)" class="f">floor</span>(<span onmouseout="hideTip(event, 'fs14', 447)" onmouseover="showTip(event, 'fs14', 447)" class="f">float</span> ((<span onmouseout="hideTip(event, 'fs37', 448)" onmouseover="showTip(event, 'fs37', 448)" class="i">x</span><span class="o">+</span><span class="n">6</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs47', 449)" onmouseover="showTip(event, 'fs47', 449)" class="i">ex</span>)<span class="o">/</span><span class="n">8</span>)))
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs50', 450)" onmouseover="showTip(event, 'fs50', 450)" class="i">by</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 451)" onmouseover="showTip(event, 'fs64', 451)" class="f">int</span> (<span onmouseout="hideTip(event, 'fs145', 452)" onmouseover="showTip(event, 'fs145', 452)" class="f">floor</span>(<span onmouseout="hideTip(event, 'fs14', 453)" onmouseover="showTip(event, 'fs14', 453)" class="f">float</span> ((<span onmouseout="hideTip(event, 'fs38', 454)" onmouseover="showTip(event, 'fs38', 454)" class="i">y</span><span class="o">+</span><span class="n">6</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs48', 455)" onmouseover="showTip(event, 'fs48', 455)" class="i">ey</span>)<span class="o">/</span><span class="n">8</span>)))
  <span onmouseout="hideTip(event, 'fs141', 456)" onmouseover="showTip(event, 'fs141', 456)" class="i">route_home</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs50', 457)" onmouseover="showTip(event, 'fs50', 457)" class="i">by</span>]<span class="o">.</span>[<span onmouseout="hideTip(event, 'fs49', 458)" onmouseover="showTip(event, 'fs49', 458)" class="i">bx</span>]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs146', 459)" onmouseover="showTip(event, 'fs146', 459)" class="f">fillUp</span> (<span onmouseout="hideTip(event, 'fs37', 460)" onmouseover="showTip(event, 'fs37', 460)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 461)" onmouseover="showTip(event, 'fs38', 461)" class="i">y</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs144', 462)" onmouseover="showTip(event, 'fs144', 462)" class="f">fillValue</span> (<span onmouseout="hideTip(event, 'fs37', 463)" onmouseover="showTip(event, 'fs37', 463)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 464)" onmouseover="showTip(event, 'fs38', 464)" class="i">y</span>) (<span class="n">0</span>,<span class="o">-</span><span class="n">4</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs147', 465)" onmouseover="showTip(event, 'fs147', 465)" class="f">fillDown</span> (<span onmouseout="hideTip(event, 'fs37', 466)" onmouseover="showTip(event, 'fs37', 466)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 467)" onmouseover="showTip(event, 'fs38', 467)" class="i">y</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs144', 468)" onmouseover="showTip(event, 'fs144', 468)" class="f">fillValue</span> (<span onmouseout="hideTip(event, 'fs37', 469)" onmouseover="showTip(event, 'fs37', 469)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 470)" onmouseover="showTip(event, 'fs38', 470)" class="i">y</span>) (<span class="n">0</span>,<span class="n">5</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs148', 471)" onmouseover="showTip(event, 'fs148', 471)" class="f">fillLeft</span> (<span onmouseout="hideTip(event, 'fs37', 472)" onmouseover="showTip(event, 'fs37', 472)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 473)" onmouseover="showTip(event, 'fs38', 473)" class="i">y</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs144', 474)" onmouseover="showTip(event, 'fs144', 474)" class="f">fillValue</span> (<span onmouseout="hideTip(event, 'fs37', 475)" onmouseover="showTip(event, 'fs37', 475)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 476)" onmouseover="showTip(event, 'fs38', 476)" class="i">y</span>) (<span class="o">-</span><span class="n">4</span>,<span class="n">0</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs149', 477)" onmouseover="showTip(event, 'fs149', 477)" class="f">fillRight</span> (<span onmouseout="hideTip(event, 'fs37', 478)" onmouseover="showTip(event, 'fs37', 478)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 479)" onmouseover="showTip(event, 'fs38', 479)" class="i">y</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs144', 480)" onmouseover="showTip(event, 'fs144', 480)" class="f">fillValue</span> (<span onmouseout="hideTip(event, 'fs37', 481)" onmouseover="showTip(event, 'fs37', 481)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 482)" onmouseover="showTip(event, 'fs38', 482)" class="i">y</span>) (<span class="n">5</span>,<span class="n">0</span>)
</code></pre></td>
</tr>
</table>
<p>When choosing a direction, ghosts that are returning will go in the direction
that leads them home. Other ghosts generate a list of possible directions (the <code>directions</code> array)
and then filter those that are in the direction of Pacman and choose one of the options. If they
are stuck and cannot go in any way, they stay where they are.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs150', 483)" onmouseover="showTip(event, 'fs150', 483)" class="f">chooseDirection</span> (<span onmouseout="hideTip(event, 'fs124', 484)" onmouseover="showTip(event, 'fs124', 484)" class="i">ghost</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs111', 485)" onmouseover="showTip(event, 'fs111', 485)" class="t">Ghost</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 486)" onmouseover="showTip(event, 'fs37', 486)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 487)" onmouseover="showTip(event, 'fs38', 487)" class="i">y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs124', 488)" onmouseover="showTip(event, 'fs124', 488)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs151', 489)" onmouseover="showTip(event, 'fs151', 489)" class="i">X</span>, <span onmouseout="hideTip(event, 'fs124', 490)" onmouseover="showTip(event, 'fs124', 490)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs152', 491)" onmouseover="showTip(event, 'fs152', 491)" class="i">Y</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs109', 492)" onmouseover="showTip(event, 'fs109', 492)" class="i">dx</span>,<span onmouseout="hideTip(event, 'fs110', 493)" onmouseover="showTip(event, 'fs110', 493)" class="i">dy</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs124', 494)" onmouseover="showTip(event, 'fs124', 494)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs153', 495)" onmouseover="showTip(event, 'fs153', 495)" class="i">V</span>
  <span class="c">// Are we facing towards the given point?</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs154', 496)" onmouseover="showTip(event, 'fs154', 496)" class="f">isBackwards</span> (<span onmouseout="hideTip(event, 'fs77', 497)" onmouseover="showTip(event, 'fs77', 497)" class="i">a</span>,<span onmouseout="hideTip(event, 'fs76', 498)" onmouseover="showTip(event, 'fs76', 498)" class="i">b</span>) <span class="o">=</span>
    (<span onmouseout="hideTip(event, 'fs77', 499)" onmouseover="showTip(event, 'fs77', 499)" class="i">a</span> <span class="o">&lt;&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs77', 500)" onmouseover="showTip(event, 'fs77', 500)" class="i">a</span> <span class="o">=</span> <span class="o">-</span><span onmouseout="hideTip(event, 'fs109', 501)" onmouseover="showTip(event, 'fs109', 501)" class="i">dx</span>) <span class="o">||</span> (<span onmouseout="hideTip(event, 'fs76', 502)" onmouseover="showTip(event, 'fs76', 502)" class="i">b</span> <span class="o">&lt;&gt;</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs76', 503)" onmouseover="showTip(event, 'fs76', 503)" class="i">b</span> <span class="o">=</span> <span class="o">-</span><span onmouseout="hideTip(event, 'fs110', 504)" onmouseover="showTip(event, 'fs110', 504)" class="i">dy</span>)
  <span class="c">// Generate array with possible directions</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs155', 505)" onmouseover="showTip(event, 'fs155', 505)" class="i">directions</span> <span class="o">=</span>
    [|<span class="k">if</span> <span onmouseout="hideTip(event, 'fs54', 506)" onmouseover="showTip(event, 'fs54', 506)" class="f">canGoLeft</span>(<span onmouseout="hideTip(event, 'fs37', 507)" onmouseover="showTip(event, 'fs37', 507)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 508)" onmouseover="showTip(event, 'fs38', 508)" class="i">y</span>) <span class="k">then</span> <span class="k">yield</span> (<span class="o">-</span><span class="n">1</span>,<span class="n">0</span>), <span onmouseout="hideTip(event, 'fs148', 509)" onmouseover="showTip(event, 'fs148', 509)" class="f">fillLeft</span>(<span onmouseout="hideTip(event, 'fs37', 510)" onmouseover="showTip(event, 'fs37', 510)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 511)" onmouseover="showTip(event, 'fs38', 511)" class="i">y</span>)
      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs53', 512)" onmouseover="showTip(event, 'fs53', 512)" class="f">canGoDown</span>(<span onmouseout="hideTip(event, 'fs37', 513)" onmouseover="showTip(event, 'fs37', 513)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 514)" onmouseover="showTip(event, 'fs38', 514)" class="i">y</span>) <span class="k">then</span> <span class="k">yield</span> (<span class="n">0</span>,<span class="n">1</span>), <span onmouseout="hideTip(event, 'fs147', 515)" onmouseover="showTip(event, 'fs147', 515)" class="f">fillDown</span>(<span onmouseout="hideTip(event, 'fs37', 516)" onmouseover="showTip(event, 'fs37', 516)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 517)" onmouseover="showTip(event, 'fs38', 517)" class="i">y</span>)
      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs55', 518)" onmouseover="showTip(event, 'fs55', 518)" class="f">canGoRight</span>(<span onmouseout="hideTip(event, 'fs37', 519)" onmouseover="showTip(event, 'fs37', 519)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 520)" onmouseover="showTip(event, 'fs38', 520)" class="i">y</span>) <span class="k">then</span> <span class="k">yield</span> (<span class="n">1</span>,<span class="n">0</span>), <span onmouseout="hideTip(event, 'fs149', 521)" onmouseover="showTip(event, 'fs149', 521)" class="f">fillRight</span>(<span onmouseout="hideTip(event, 'fs37', 522)" onmouseover="showTip(event, 'fs37', 522)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 523)" onmouseover="showTip(event, 'fs38', 523)" class="i">y</span>)
      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs52', 524)" onmouseover="showTip(event, 'fs52', 524)" class="f">canGoUp</span>(<span onmouseout="hideTip(event, 'fs37', 525)" onmouseover="showTip(event, 'fs37', 525)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 526)" onmouseover="showTip(event, 'fs38', 526)" class="i">y</span>) <span class="k">then</span> <span class="k">yield</span> (<span class="n">0</span>,<span class="o">-</span><span class="n">1</span>), <span onmouseout="hideTip(event, 'fs146', 527)" onmouseover="showTip(event, 'fs146', 527)" class="f">fillUp</span>(<span onmouseout="hideTip(event, 'fs37', 528)" onmouseover="showTip(event, 'fs37', 528)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 529)" onmouseover="showTip(event, 'fs38', 529)" class="i">y</span>) |]

  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs124', 530)" onmouseover="showTip(event, 'fs124', 530)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs156', 531)" onmouseover="showTip(event, 'fs156', 531)" class="i">IsReturning</span> <span class="k">then</span>
    <span class="c">// Returning ghosts find the shortest way home</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs157', 532)" onmouseover="showTip(event, 'fs157', 532)" class="i">xs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs155', 533)" onmouseover="showTip(event, 'fs155', 533)" class="i">directions</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 534)" onmouseover="showTip(event, 'fs66', 534)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs158', 535)" onmouseover="showTip(event, 'fs158', 535)" class="f">sortBy</span> <span onmouseout="hideTip(event, 'fs159', 536)" onmouseover="showTip(event, 'fs159', 536)" class="f">snd</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs114', 537)" onmouseover="showTip(event, 'fs114', 537)" class="i">v</span>, <span onmouseout="hideTip(event, 'fs45', 538)" onmouseover="showTip(event, 'fs45', 538)" class="i">n</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs157', 539)" onmouseover="showTip(event, 'fs157', 539)" class="i">xs</span><span class="o">.</span>[<span class="n">0</span>]
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs45', 540)" onmouseover="showTip(event, 'fs45', 540)" class="i">n</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs124', 541)" onmouseover="showTip(event, 'fs124', 541)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs156', 542)" onmouseover="showTip(event, 'fs156', 542)" class="i">IsReturning</span> <span class="o">&lt;-</span> <span class="k">false</span>
    <span onmouseout="hideTip(event, 'fs114', 543)" onmouseover="showTip(event, 'fs114', 543)" class="i">v</span>
  <span class="k">else</span>
    <span class="c">// Other ghosts pick one direction twoards Pacman</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs160', 544)" onmouseover="showTip(event, 'fs160', 544)" class="i">xs</span> <span class="o">=</span> 
      <span onmouseout="hideTip(event, 'fs155', 545)" onmouseover="showTip(event, 'fs155', 545)" class="i">directions</span>
      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 546)" onmouseover="showTip(event, 'fs66', 546)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs131', 547)" onmouseover="showTip(event, 'fs131', 547)" class="f">map</span> <span onmouseout="hideTip(event, 'fs161', 548)" onmouseover="showTip(event, 'fs161', 548)" class="f">fst</span>
      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 549)" onmouseover="showTip(event, 'fs66', 549)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs162', 550)" onmouseover="showTip(event, 'fs162', 550)" class="f">filter</span> (<span onmouseout="hideTip(event, 'fs51', 551)" onmouseover="showTip(event, 'fs51', 551)" class="f">not</span> <span class="o">&lt;&lt;</span> <span onmouseout="hideTip(event, 'fs154', 552)" onmouseover="showTip(event, 'fs154', 552)" class="f">isBackwards</span>)
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs160', 553)" onmouseover="showTip(event, 'fs160', 553)" class="i">xs</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 554)" onmouseover="showTip(event, 'fs97', 554)" class="i">Length</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span class="n">0</span>, <span class="n">0</span>
    <span class="k">else</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs163', 555)" onmouseover="showTip(event, 'fs163', 555)" class="i">i</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 556)" onmouseover="showTip(event, 'fs13', 556)" class="f">random</span>() <span class="o">*</span> <span onmouseout="hideTip(event, 'fs14', 557)" onmouseover="showTip(event, 'fs14', 557)" class="f">float</span> <span onmouseout="hideTip(event, 'fs160', 558)" onmouseover="showTip(event, 'fs160', 558)" class="i">xs</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 559)" onmouseover="showTip(event, 'fs97', 559)" class="i">Length</span>
      <span onmouseout="hideTip(event, 'fs160', 560)" onmouseover="showTip(event, 'fs160', 560)" class="i">xs</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs64', 561)" onmouseover="showTip(event, 'fs64', 561)" class="f">int</span> (<span onmouseout="hideTip(event, 'fs145', 562)" onmouseover="showTip(event, 'fs145', 562)" class="f">floor</span> <span onmouseout="hideTip(event, 'fs163', 563)" onmouseover="showTip(event, 'fs163', 563)" class="i">i</span>)]
</code></pre></td>
</tr>
</table>
<h2><a name="Input-and-output-helpers" class="anchor" href="#Input-and-output-helpers">Input and output helpers</a></h2>
<h3><a name="Keyboard-input" class="anchor" href="#Keyboard-input">Keyboard input</a></h3>
<p>The <code>Keyboard</code> module records the keys that are currently pressed in a set and
registers <code>window</code> event handlers using the DOM interoperability layer.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">module</span> <span class="t">Keyboard</span> <span class="o">=</span>
  <span class="c">/// Set of currently pressed keys</span>
  <span class="k">let</span> <span class="k">mutable</span> <span onmouseout="hideTip(event, 'fs164', 564)" onmouseover="showTip(event, 'fs164', 564)" class="v">keysPressed</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs165', 565)" onmouseover="showTip(event, 'fs165', 565)" class="t">Set</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs166', 566)" onmouseover="showTip(event, 'fs166', 566)" class="i">empty</span>
  <span class="c">/// Update the keys as requested</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs167', 567)" onmouseover="showTip(event, 'fs167', 567)" class="f">reset</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs164', 568)" onmouseover="showTip(event, 'fs164', 568)" class="v">keysPressed</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs165', 569)" onmouseover="showTip(event, 'fs165', 569)" class="t">Set</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs166', 570)" onmouseover="showTip(event, 'fs166', 570)" class="i">empty</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs168', 571)" onmouseover="showTip(event, 'fs168', 571)" class="f">isPressed</span> <span onmouseout="hideTip(event, 'fs169', 572)" onmouseover="showTip(event, 'fs169', 572)" class="i">keyCode</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs165', 573)" onmouseover="showTip(event, 'fs165', 573)" class="t">Set</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs170', 574)" onmouseover="showTip(event, 'fs170', 574)" class="f">contains</span> <span onmouseout="hideTip(event, 'fs169', 575)" onmouseover="showTip(event, 'fs169', 575)" class="i">keyCode</span> <span onmouseout="hideTip(event, 'fs164', 576)" onmouseover="showTip(event, 'fs164', 576)" class="v">keysPressed</span>
  <span class="c">/// Triggered when key is pressed/released</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs171', 577)" onmouseover="showTip(event, 'fs171', 577)" class="f">update</span> (<span onmouseout="hideTip(event, 'fs172', 578)" onmouseover="showTip(event, 'fs172', 578)" class="i">e</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs173', 579)" onmouseover="showTip(event, 'fs173', 579)" class="t">KeyboardEvent</span>, <span onmouseout="hideTip(event, 'fs174', 580)" onmouseover="showTip(event, 'fs174', 580)" class="i">pressed</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs169', 581)" onmouseover="showTip(event, 'fs169', 581)" class="i">keyCode</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 582)" onmouseover="showTip(event, 'fs64', 582)" class="f">int</span> <span onmouseout="hideTip(event, 'fs172', 583)" onmouseover="showTip(event, 'fs172', 583)" class="i">e</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs175', 584)" onmouseover="showTip(event, 'fs175', 584)" class="i">keyCode</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs176', 585)" onmouseover="showTip(event, 'fs176', 585)" class="f">op</span> <span class="o">=</span>  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs174', 586)" onmouseover="showTip(event, 'fs174', 586)" class="i">pressed</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs165', 587)" onmouseover="showTip(event, 'fs165', 587)" class="t">Set</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs177', 588)" onmouseover="showTip(event, 'fs177', 588)" class="f">add</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs165', 589)" onmouseover="showTip(event, 'fs165', 589)" class="t">Set</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs178', 590)" onmouseover="showTip(event, 'fs178', 590)" class="f">remove</span>
    <span onmouseout="hideTip(event, 'fs164', 591)" onmouseover="showTip(event, 'fs164', 591)" class="v">keysPressed</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs176', 592)" onmouseover="showTip(event, 'fs176', 592)" class="f">op</span> <span onmouseout="hideTip(event, 'fs169', 593)" onmouseover="showTip(event, 'fs169', 593)" class="i">keyCode</span> <span onmouseout="hideTip(event, 'fs164', 594)" onmouseover="showTip(event, 'fs164', 594)" class="v">keysPressed</span>
    <span class="k">null</span>
  <span class="c">/// Register DOM event handlers</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs179', 595)" onmouseover="showTip(event, 'fs179', 595)" class="f">init</span> () <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs180', 596)" onmouseover="showTip(event, 'fs180', 596)" class="i">window</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs181', 597)" onmouseover="showTip(event, 'fs181', 597)" class="f">addEventListener_keydown</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs172', 598)" onmouseover="showTip(event, 'fs172', 598)" class="i">e</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs171', 599)" onmouseover="showTip(event, 'fs171', 599)" class="f">update</span>(<span onmouseout="hideTip(event, 'fs172', 600)" onmouseover="showTip(event, 'fs172', 600)" class="i">e</span>, <span class="k">true</span>))
    <span onmouseout="hideTip(event, 'fs180', 601)" onmouseover="showTip(event, 'fs180', 601)" class="i">window</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs182', 602)" onmouseover="showTip(event, 'fs182', 602)" class="f">addEventListener_keyup</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs172', 603)" onmouseover="showTip(event, 'fs172', 603)" class="i">e</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs171', 604)" onmouseover="showTip(event, 'fs171', 604)" class="f">update</span>(<span onmouseout="hideTip(event, 'fs172', 605)" onmouseover="showTip(event, 'fs172', 605)" class="i">e</span>, <span class="k">false</span>))
</code></pre></td>
</tr>
</table>
<h3><a name="Choosing-Pacman-image" class="anchor" href="#Choosing-Pacman-image">Choosing Pacman image</a></h3>
<p>The <code>Pacman</code> module is a helper that exposes the <code>imageAt</code> function. The function
returns the pacman image for the specified X and Y location, taking into account the
direction in which Pacman is going. It keeps a mutable state with current step of Pacman's
mouth.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">module</span> <span class="t">Pacman</span> <span class="o">=</span>
  <span class="c">// Load the different Pacman images </span>
  <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs183', 606)" onmouseover="showTip(event, 'fs183', 606)" class="i">pu1</span>, <span onmouseout="hideTip(event, 'fs184', 607)" onmouseover="showTip(event, 'fs184', 607)" class="i">pu2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 608)" onmouseover="showTip(event, 'fs21', 608)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs185', 609)" onmouseover="showTip(event, 'fs185', 609)" class="i">pu1</span>, <span onmouseout="hideTip(event, 'fs21', 610)" onmouseover="showTip(event, 'fs21', 610)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs184', 611)" onmouseover="showTip(event, 'fs184', 611)" class="i">pu2</span>
  <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs186', 612)" onmouseover="showTip(event, 'fs186', 612)" class="i">pd1</span>, <span onmouseout="hideTip(event, 'fs187', 613)" onmouseover="showTip(event, 'fs187', 613)" class="i">pd2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 614)" onmouseover="showTip(event, 'fs21', 614)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs188', 615)" onmouseover="showTip(event, 'fs188', 615)" class="i">pd1</span>, <span onmouseout="hideTip(event, 'fs21', 616)" onmouseover="showTip(event, 'fs21', 616)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs187', 617)" onmouseover="showTip(event, 'fs187', 617)" class="i">pd2</span>
  <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs189', 618)" onmouseover="showTip(event, 'fs189', 618)" class="i">pl1</span>, <span onmouseout="hideTip(event, 'fs190', 619)" onmouseover="showTip(event, 'fs190', 619)" class="i">pl2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 620)" onmouseover="showTip(event, 'fs21', 620)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs191', 621)" onmouseover="showTip(event, 'fs191', 621)" class="i">pl1</span>, <span onmouseout="hideTip(event, 'fs21', 622)" onmouseover="showTip(event, 'fs21', 622)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs190', 623)" onmouseover="showTip(event, 'fs190', 623)" class="i">pl2</span>
  <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs192', 624)" onmouseover="showTip(event, 'fs192', 624)" class="i">pr1</span>, <span onmouseout="hideTip(event, 'fs193', 625)" onmouseover="showTip(event, 'fs193', 625)" class="i">pr2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 626)" onmouseover="showTip(event, 'fs21', 626)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs194', 627)" onmouseover="showTip(event, 'fs194', 627)" class="i">pr1</span>, <span onmouseout="hideTip(event, 'fs21', 628)" onmouseover="showTip(event, 'fs21', 628)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs193', 629)" onmouseover="showTip(event, 'fs193', 629)" class="i">pr2</span>
  
  <span class="c">// Represent Pacman&#39;s mouth state</span>
  <span class="k">let</span> <span class="k">private</span> <span onmouseout="hideTip(event, 'fs195', 630)" onmouseover="showTip(event, 'fs195', 630)" class="v">lastp</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs196', 631)" onmouseover="showTip(event, 'fs196', 631)" class="f">ref</span> <span onmouseout="hideTip(event, 'fs192', 632)" onmouseover="showTip(event, 'fs192', 632)" class="i">pr1</span>

  <span class="c">// Return imge for the given X, Y and V</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs197', 633)" onmouseover="showTip(event, 'fs197', 633)" class="f">imageAt</span>(<span onmouseout="hideTip(event, 'fs198', 634)" onmouseover="showTip(event, 'fs198', 634)" class="v">x</span>,<span onmouseout="hideTip(event, 'fs199', 635)" onmouseover="showTip(event, 'fs199', 635)" class="v">y</span>,<span onmouseout="hideTip(event, 'fs200', 636)" onmouseover="showTip(event, 'fs200', 636)" class="v">v</span>) <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs201', 637)" onmouseover="showTip(event, 'fs201', 637)" class="i">p1</span>, <span onmouseout="hideTip(event, 'fs202', 638)" onmouseover="showTip(event, 'fs202', 638)" class="i">p2</span> <span class="o">=</span>
      <span class="k">match</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs200', 639)" onmouseover="showTip(event, 'fs200', 639)" class="v">v</span> <span class="k">with</span>
      | <span class="o">-</span><span class="n">1</span>,  <span class="n">0</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs189', 640)" onmouseover="showTip(event, 'fs189', 640)" class="i">pl1</span>, <span onmouseout="hideTip(event, 'fs190', 641)" onmouseover="showTip(event, 'fs190', 641)" class="i">pl2</span>
      |  <span class="n">1</span>,  <span class="n">0</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs192', 642)" onmouseover="showTip(event, 'fs192', 642)" class="i">pr1</span>, <span onmouseout="hideTip(event, 'fs193', 643)" onmouseover="showTip(event, 'fs193', 643)" class="i">pr2</span>
      |  <span class="n">0</span>, <span class="o">-</span><span class="n">1</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs183', 644)" onmouseover="showTip(event, 'fs183', 644)" class="i">pu1</span>, <span onmouseout="hideTip(event, 'fs184', 645)" onmouseover="showTip(event, 'fs184', 645)" class="i">pu2</span>
      |  <span class="n">0</span>,  <span class="n">1</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs186', 646)" onmouseover="showTip(event, 'fs186', 646)" class="i">pd1</span>, <span onmouseout="hideTip(event, 'fs187', 647)" onmouseover="showTip(event, 'fs187', 647)" class="i">pd2</span>
      |  _,  _ <span class="k">-&gt;</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs195', 648)" onmouseover="showTip(event, 'fs195', 648)" class="v">lastp</span>, <span class="o">!</span><span onmouseout="hideTip(event, 'fs195', 649)" onmouseover="showTip(event, 'fs195', 649)" class="v">lastp</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs103', 650)" onmouseover="showTip(event, 'fs103', 650)" class="i">x&#39;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 651)" onmouseover="showTip(event, 'fs64', 651)" class="f">int</span> (<span onmouseout="hideTip(event, 'fs145', 652)" onmouseover="showTip(event, 'fs145', 652)" class="f">floor</span>(<span onmouseout="hideTip(event, 'fs14', 653)" onmouseover="showTip(event, 'fs14', 653)" class="f">float</span> (<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 654)" onmouseover="showTip(event, 'fs198', 654)" class="v">x</span><span class="o">/</span><span class="n">6</span>)))
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs104', 655)" onmouseover="showTip(event, 'fs104', 655)" class="i">y&#39;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 656)" onmouseover="showTip(event, 'fs64', 656)" class="f">int</span> (<span onmouseout="hideTip(event, 'fs145', 657)" onmouseover="showTip(event, 'fs145', 657)" class="f">floor</span>(<span onmouseout="hideTip(event, 'fs14', 658)" onmouseover="showTip(event, 'fs14', 658)" class="f">float</span> (<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 659)" onmouseover="showTip(event, 'fs199', 659)" class="v">y</span><span class="o">/</span><span class="n">6</span>)))
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs203', 660)" onmouseover="showTip(event, 'fs203', 660)" class="i">p</span> <span class="o">=</span> <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs103', 661)" onmouseover="showTip(event, 'fs103', 661)" class="i">x&#39;</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs104', 662)" onmouseover="showTip(event, 'fs104', 662)" class="i">y&#39;</span>) <span class="o">%</span> <span class="n">2</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs201', 663)" onmouseover="showTip(event, 'fs201', 663)" class="i">p1</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs202', 664)" onmouseover="showTip(event, 'fs202', 664)" class="i">p2</span>
    <span onmouseout="hideTip(event, 'fs195', 665)" onmouseover="showTip(event, 'fs195', 665)" class="v">lastp</span> <span class="o">:=</span> <span onmouseout="hideTip(event, 'fs203', 666)" onmouseover="showTip(event, 'fs203', 666)" class="i">p</span>
    <span onmouseout="hideTip(event, 'fs203', 667)" onmouseover="showTip(event, 'fs203', 667)" class="i">p</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Sounds-and-dots" class="anchor" href="#Sounds-and-dots">Sounds and dots</a></h3>
<p>We need two more helpers - the <code>sound</code> function plays an audio file. This uses JavaScript native
<code>Audio</code> object, which we access via the <code>Emit</code> attribute. The other helper is <code>countDots</code> which
counts dots in the maze:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Uses Fable&#39;s Emit to call JavaScript directly</span>
[&lt;<span onmouseout="hideTip(event, 'fs12', 668)" onmouseover="showTip(event, 'fs12', 668)" class="t">Emit</span>(<span class="s">&quot;(new Audio($0)).play();&quot;</span>)&gt;]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs204', 669)" onmouseover="showTip(event, 'fs204', 669)" class="f">sound</span>(<span onmouseout="hideTip(event, 'fs205', 670)" onmouseover="showTip(event, 'fs205', 670)" class="i">file</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs206', 671)" onmouseover="showTip(event, 'fs206', 671)" class="t">string</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs207', 672)" onmouseover="showTip(event, 'fs207', 672)" class="t">unit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 673)" onmouseover="showTip(event, 'fs15', 673)" class="f">failwith</span> <span class="s">&quot;never&quot;</span>

<span class="c">/// Count number of dots in the maze</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs208', 674)" onmouseover="showTip(event, 'fs208', 674)" class="f">countDots</span> () <span class="o">=</span>
  <span onmouseout="hideTip(event, 'fs27', 675)" onmouseover="showTip(event, 'fs27', 675)" class="i">maze</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 676)" onmouseover="showTip(event, 'fs66', 676)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs209', 677)" onmouseover="showTip(event, 'fs209', 677)" class="f">sumBy</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs98', 678)" onmouseover="showTip(event, 'fs98', 678)" class="i">line</span> <span class="k">-&gt;</span>
    <span onmouseout="hideTip(event, 'fs98', 679)" onmouseover="showTip(event, 'fs98', 679)" class="i">line</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs143', 680)" onmouseover="showTip(event, 'fs143', 680)" class="f">ToCharArray</span>()
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 681)" onmouseover="showTip(event, 'fs66', 681)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs209', 682)" onmouseover="showTip(event, 'fs209', 682)" class="f">sumBy</span> (<span class="k">function</span> <span class="s">&#39;.&#39;</span> <span class="k">-&gt;</span> <span class="n">1</span> | <span class="s">&#39;o&#39;</span> <span class="k">-&gt;</span> <span class="n">1</span> | _ <span class="k">-&gt;</span> <span class="n">0</span>))
</code></pre></td>
</tr>
</table>
<h2><a name="The-game-play-function" class="anchor" href="#The-game-play-function">The game play function</a></h2>
<p>Most of the Pacman game logic is wrapped in the top-level <code>playLevel</code> function. This takes two functions - that are called
when the game completes - and then it iniializes the world state and runs in a loop until the end of the game.
The following outlines the structure of the function:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs210', 683)" onmouseover="showTip(event, 'fs210', 683)" class="f">playLevel</span> (<span onmouseout="hideTip(event, 'fs211', 684)" onmouseover="showTip(event, 'fs211', 684)" class="f">onLevelCompleted</span>, <span onmouseout="hideTip(event, 'fs212', 685)" onmouseover="showTip(event, 'fs212', 685)" class="f">onGameOver</span>) <span class="o">=</span>
  <span class="c">// (Create canvas, background and ghosts)</span>
  <span class="c">// (Define the Pacman state)</span>
  <span class="c">// (Move ghosts and Pacman)</span>
  <span class="c">// (Detect pills and collisiions)</span>
  <span class="c">// (Rendering everything in the game)</span>
  <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs213', 686)" onmouseover="showTip(event, 'fs213', 686)" class="f">update</span> () <span class="o">=</span>
    <span class="i">logic</span> ()
    <span class="i">render</span> ()
    <span class="k">if</span> <span class="o">!</span><span class="i">dotsLeft</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs211', 687)" onmouseover="showTip(event, 'fs211', 687)" class="f">onLevelCompleted</span>()
    <span class="k">elif</span> <span class="o">!</span><span class="i">energy</span> <span class="o">&lt;=</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs212', 688)" onmouseover="showTip(event, 'fs212', 688)" class="f">onGameOver</span>()
    <span class="k">else</span> <span class="i">window</span><span class="o">.</span><span class="i">setTimeout</span>(<span onmouseout="hideTip(event, 'fs213', 689)" onmouseover="showTip(event, 'fs213', 689)" class="i">update</span>, <span class="n">1000.</span> <span class="o">/</span> <span class="n">60.</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs214', 690)" onmouseover="showTip(event, 'fs214', 690)" class="f">ignore</span>

  <span onmouseout="hideTip(event, 'fs213', 691)" onmouseover="showTip(event, 'fs213', 691)" class="f">update</span>()
</code></pre></td>
</tr>
</table>
<p>After defining all the helpers, the <code>update</code> function runs in a loop (via a timer) until there are no dots
left or until the Pacman is out of energy and then it calls one of the continuations.</p>
<p>In the following 5 sections, we'll look at the 5 blocks of code that define the body of the function.</p>
<h3><a name="Create-canvas-background-and-ghosts" class="anchor" href="#Create-canvas-background-and-ghosts">Create canvas, background and ghosts</a></h3>
<p>In the first part, the function finds the <code>&lt;canvas&gt;</code> element, paints it with black background and
creates other graphical elements - namely the game background, ghosts and eyes:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="c">// Fill the canvas element</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs216', 695)" onmouseover="showTip(event, 'fs216', 695)" class="i">canvas</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 696)" onmouseover="showTip(event, 'fs24', 696)" class="i">document</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs217', 697)" onmouseover="showTip(event, 'fs217', 697)" class="f">getElementsByTagName_canvas</span>()<span class="o">.</span>[<span class="n">0.</span>]
  <span onmouseout="hideTip(event, 'fs216', 698)" onmouseover="showTip(event, 'fs216', 698)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs87', 699)" onmouseover="showTip(event, 'fs87', 699)" class="i">width</span> <span class="o">&lt;-</span> <span class="n">256.</span>
  <span onmouseout="hideTip(event, 'fs216', 700)" onmouseover="showTip(event, 'fs216', 700)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs88', 701)" onmouseover="showTip(event, 'fs88', 701)" class="i">height</span> <span class="o">&lt;-</span> <span class="n">256.</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 702)" onmouseover="showTip(event, 'fs72', 702)" class="i">context</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs216', 703)" onmouseover="showTip(event, 'fs216', 703)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 704)" onmouseover="showTip(event, 'fs89', 704)" class="f">getContext_2d</span>()
  <span onmouseout="hideTip(event, 'fs72', 705)" onmouseover="showTip(event, 'fs72', 705)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 706)" onmouseover="showTip(event, 'fs90', 706)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs91', 707)" onmouseover="showTip(event, 'fs91', 707)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 708)" onmouseover="showTip(event, 'fs92', 708)" class="p">Case1</span> <span class="s">&quot;rgb(0,0,0)&quot;</span>
  <span onmouseout="hideTip(event, 'fs72', 709)" onmouseover="showTip(event, 'fs72', 709)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 710)" onmouseover="showTip(event, 'fs93', 710)" class="f">fillRect</span> (<span class="n">0.</span>, <span class="n">0.</span> , <span class="n">256.</span>, <span class="n">256.</span>);
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs218', 711)" onmouseover="showTip(event, 'fs218', 711)" class="i">bonusImages</span> <span class="o">=</span>
    [| <span onmouseout="hideTip(event, 'fs21', 712)" onmouseover="showTip(event, 'fs21', 712)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs219', 713)" onmouseover="showTip(event, 'fs219', 713)" class="i">_200</span>; <span onmouseout="hideTip(event, 'fs21', 714)" onmouseover="showTip(event, 'fs21', 714)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs220', 715)" onmouseover="showTip(event, 'fs220', 715)" class="i">_400</span>;
       <span onmouseout="hideTip(event, 'fs21', 716)" onmouseover="showTip(event, 'fs21', 716)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs221', 717)" onmouseover="showTip(event, 'fs221', 717)" class="i">_800</span>; <span onmouseout="hideTip(event, 'fs21', 718)" onmouseover="showTip(event, 'fs21', 718)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs222', 719)" onmouseover="showTip(event, 'fs222', 719)" class="i">_1600</span> |]
  
  <span class="c">// Load images for rendering</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 720)" onmouseover="showTip(event, 'fs85', 720)" class="i">background</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs84', 721)" onmouseover="showTip(event, 'fs84', 721)" class="f">createBackground</span>()
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs223', 722)" onmouseover="showTip(event, 'fs223', 722)" class="i">ghosts</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs127', 723)" onmouseover="showTip(event, 'fs127', 723)" class="f">createGhosts</span>(<span onmouseout="hideTip(event, 'fs72', 724)" onmouseover="showTip(event, 'fs72', 724)" class="i">context</span>)
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs224', 725)" onmouseover="showTip(event, 'fs224', 725)" class="i">blue</span>,<span onmouseout="hideTip(event, 'fs225', 726)" onmouseover="showTip(event, 'fs225', 726)" class="i">eyed</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 727)" onmouseover="showTip(event, 'fs21', 727)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs226', 728)" onmouseover="showTip(event, 'fs226', 728)" class="i">blue</span>, <span onmouseout="hideTip(event, 'fs21', 729)" onmouseover="showTip(event, 'fs21', 729)" class="f">createImage</span> <span onmouseout="hideTip(event, 'fs225', 730)" onmouseover="showTip(event, 'fs225', 730)" class="i">eyed</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Define-the-Pacman-state" class="anchor" href="#Define-the-Pacman-state">Define the Pacman state</a></h3>
<p>Next, we define the game state. Pacman game uses mutable state, so the following uses
F# reference cells; <code>ref 0</code> creates a mutable cell containing 0. Later, we will access
the value by writing <code>!score</code> and mutate it by writing <code>score := !score + 1</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs227', 731)" onmouseover="showTip(event, 'fs227', 731)" class="i">pills</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs27', 732)" onmouseover="showTip(event, 'fs27', 732)" class="i">maze</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 733)" onmouseover="showTip(event, 'fs66', 733)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs131', 734)" onmouseover="showTip(event, 'fs131', 734)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs98', 735)" onmouseover="showTip(event, 'fs98', 735)" class="i">line</span> <span class="k">-&gt;</span>
    <span onmouseout="hideTip(event, 'fs98', 736)" onmouseover="showTip(event, 'fs98', 736)" class="i">line</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs143', 737)" onmouseover="showTip(event, 'fs143', 737)" class="f">ToCharArray</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 738)" onmouseover="showTip(event, 'fs66', 738)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs131', 739)" onmouseover="showTip(event, 'fs131', 739)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs34', 740)" onmouseover="showTip(event, 'fs34', 740)" class="i">c</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs34', 741)" onmouseover="showTip(event, 'fs34', 741)" class="i">c</span>))
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs228', 742)" onmouseover="showTip(event, 'fs228', 742)" class="v">dotsLeft</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs196', 743)" onmouseover="showTip(event, 'fs196', 743)" class="f">ref</span> (<span onmouseout="hideTip(event, 'fs208', 744)" onmouseover="showTip(event, 'fs208', 744)" class="f">countDots</span>())
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs229', 745)" onmouseover="showTip(event, 'fs229', 745)" class="v">score</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs196', 746)" onmouseover="showTip(event, 'fs196', 746)" class="f">ref</span> <span class="n">0</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs230', 747)" onmouseover="showTip(event, 'fs230', 747)" class="v">bonus</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs196', 748)" onmouseover="showTip(event, 'fs196', 748)" class="f">ref</span> <span class="n">0</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs231', 749)" onmouseover="showTip(event, 'fs231', 749)" class="v">bonuses</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs196', 750)" onmouseover="showTip(event, 'fs196', 750)" class="f">ref</span> []
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs232', 751)" onmouseover="showTip(event, 'fs232', 751)" class="v">energy</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs196', 752)" onmouseover="showTip(event, 'fs196', 752)" class="f">ref</span> <span class="n">128</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs233', 753)" onmouseover="showTip(event, 'fs233', 753)" class="v">flashCountdown</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs196', 754)" onmouseover="showTip(event, 'fs196', 754)" class="f">ref</span> <span class="n">0</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs234', 755)" onmouseover="showTip(event, 'fs234', 755)" class="v">powerCountdown</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs196', 756)" onmouseover="showTip(event, 'fs196', 756)" class="f">ref</span> <span class="n">0</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs198', 757)" onmouseover="showTip(event, 'fs198', 757)" class="v">x</span>, <span onmouseout="hideTip(event, 'fs199', 758)" onmouseover="showTip(event, 'fs199', 758)" class="v">y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs196', 759)" onmouseover="showTip(event, 'fs196', 759)" class="f">ref</span> (<span class="n">16</span> <span class="o">*</span> <span class="n">8</span> <span class="o">-</span> <span class="n">7</span>), <span onmouseout="hideTip(event, 'fs196', 760)" onmouseover="showTip(event, 'fs196', 760)" class="f">ref</span> (<span class="n">23</span> <span class="o">*</span> <span class="n">8</span> <span class="o">-</span> <span class="n">3</span>)
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs200', 761)" onmouseover="showTip(event, 'fs200', 761)" class="v">v</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs196', 762)" onmouseover="showTip(event, 'fs196', 762)" class="f">ref</span> (<span class="n">0</span>,<span class="n">0</span>)
</code></pre></td>
</tr>
</table>
<h3><a name="Move-ghosts-and-Pacman" class="anchor" href="#Move-ghosts-and-Pacman">Move ghosts and Pacman</a></h3>
<p>At each step of the game, we need to update the positions of ghosts and the Pacman. This is handled
in <code>moveGhosts</code> and <code>movePacman</code>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs235', 763)" onmouseover="showTip(event, 'fs235', 763)" class="f">moveGhosts</span> () <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs223', 764)" onmouseover="showTip(event, 'fs223', 764)" class="i">ghosts</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 765)" onmouseover="showTip(event, 'fs66', 765)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs236', 766)" onmouseover="showTip(event, 'fs236', 766)" class="f">iter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs124', 767)" onmouseover="showTip(event, 'fs124', 767)" class="i">ghost</span> <span class="k">-&gt;</span>
      <span onmouseout="hideTip(event, 'fs124', 768)" onmouseover="showTip(event, 'fs124', 768)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs237', 769)" onmouseover="showTip(event, 'fs237', 769)" class="f">Move</span>(<span onmouseout="hideTip(event, 'fs150', 770)" onmouseover="showTip(event, 'fs150', 770)" class="f">chooseDirection</span> <span onmouseout="hideTip(event, 'fs124', 771)" onmouseover="showTip(event, 'fs124', 771)" class="i">ghost</span>) )

  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs238', 772)" onmouseover="showTip(event, 'fs238', 772)" class="f">movePacman</span> () <span class="o">=</span>
    <span class="c">// In which directions should pacman go?</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs239', 773)" onmouseover="showTip(event, 'fs239', 773)" class="i">inputs</span> <span class="o">=</span>
       [| <span class="k">if</span> <span onmouseout="hideTip(event, 'fs240', 774)" onmouseover="showTip(event, 'fs240', 774)" class="t">Keyboard</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs168', 775)" onmouseover="showTip(event, 'fs168', 775)" class="f">isPressed</span> <span class="n">81</span> <span class="c">(*q*)</span> <span class="k">then</span>
            <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs52', 776)" onmouseover="showTip(event, 'fs52', 776)" class="f">canGoUp</span> (<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 777)" onmouseover="showTip(event, 'fs198', 777)" class="v">x</span>,<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 778)" onmouseover="showTip(event, 'fs199', 778)" class="v">y</span>), (<span class="n">0</span>,<span class="o">-</span><span class="n">1</span>)
          <span class="k">if</span> <span onmouseout="hideTip(event, 'fs240', 779)" onmouseover="showTip(event, 'fs240', 779)" class="t">Keyboard</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs168', 780)" onmouseover="showTip(event, 'fs168', 780)" class="f">isPressed</span> <span class="n">65</span> <span class="c">(*a*)</span> <span class="k">then</span>
            <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs53', 781)" onmouseover="showTip(event, 'fs53', 781)" class="f">canGoDown</span> (<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 782)" onmouseover="showTip(event, 'fs198', 782)" class="v">x</span>,<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 783)" onmouseover="showTip(event, 'fs199', 783)" class="v">y</span>), (<span class="n">0</span>,<span class="n">1</span>)
          <span class="k">if</span> <span onmouseout="hideTip(event, 'fs240', 784)" onmouseover="showTip(event, 'fs240', 784)" class="t">Keyboard</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs168', 785)" onmouseover="showTip(event, 'fs168', 785)" class="f">isPressed</span> <span class="n">90</span> <span class="c">(*z*)</span> <span class="k">then</span>
            <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs54', 786)" onmouseover="showTip(event, 'fs54', 786)" class="f">canGoLeft</span> (<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 787)" onmouseover="showTip(event, 'fs198', 787)" class="v">x</span>,<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 788)" onmouseover="showTip(event, 'fs199', 788)" class="v">y</span>), (<span class="o">-</span><span class="n">1</span>,<span class="n">0</span>)
          <span class="k">if</span> <span onmouseout="hideTip(event, 'fs240', 789)" onmouseover="showTip(event, 'fs240', 789)" class="t">Keyboard</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs168', 790)" onmouseover="showTip(event, 'fs168', 790)" class="f">isPressed</span> <span class="n">88</span> <span class="c">(*x*)</span> <span class="k">then</span>
            <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs55', 791)" onmouseover="showTip(event, 'fs55', 791)" class="f">canGoRight</span> (<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 792)" onmouseover="showTip(event, 'fs198', 792)" class="v">x</span>,<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 793)" onmouseover="showTip(event, 'fs199', 793)" class="v">y</span>), (<span class="n">1</span>,<span class="n">0</span>) |]
    <span class="c">// Can we continue in the same direction?</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs241', 794)" onmouseover="showTip(event, 'fs241', 794)" class="i">canGoForward</span> <span class="o">=</span>
      <span class="k">match</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs200', 795)" onmouseover="showTip(event, 'fs200', 795)" class="v">v</span> <span class="k">with</span>
      | <span class="n">0</span>,<span class="o">-</span><span class="n">1</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs52', 796)" onmouseover="showTip(event, 'fs52', 796)" class="f">canGoUp</span>(<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 797)" onmouseover="showTip(event, 'fs198', 797)" class="v">x</span>,<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 798)" onmouseover="showTip(event, 'fs199', 798)" class="v">y</span>)
      | <span class="n">0</span>,<span class="n">1</span>  <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs53', 799)" onmouseover="showTip(event, 'fs53', 799)" class="f">canGoDown</span>(<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 800)" onmouseover="showTip(event, 'fs198', 800)" class="v">x</span>,<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 801)" onmouseover="showTip(event, 'fs199', 801)" class="v">y</span>)
      | <span class="o">-</span><span class="n">1</span>,<span class="n">0</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs54', 802)" onmouseover="showTip(event, 'fs54', 802)" class="f">canGoLeft</span>(<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 803)" onmouseover="showTip(event, 'fs198', 803)" class="v">x</span>,<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 804)" onmouseover="showTip(event, 'fs199', 804)" class="v">y</span>)
      | <span class="n">1</span>, <span class="n">0</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs55', 805)" onmouseover="showTip(event, 'fs55', 805)" class="f">canGoRight</span>(<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 806)" onmouseover="showTip(event, 'fs198', 806)" class="v">x</span>,<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 807)" onmouseover="showTip(event, 'fs199', 807)" class="v">y</span>)
      | _ <span class="k">-&gt;</span> <span class="k">false</span>
    <span class="c">// What new directions can we take?</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs242', 808)" onmouseover="showTip(event, 'fs242', 808)" class="i">availableDirections</span> <span class="o">=</span>
      <span onmouseout="hideTip(event, 'fs239', 809)" onmouseover="showTip(event, 'fs239', 809)" class="i">inputs</span>
      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 810)" onmouseover="showTip(event, 'fs66', 810)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs162', 811)" onmouseover="showTip(event, 'fs162', 811)" class="f">filter</span> <span onmouseout="hideTip(event, 'fs161', 812)" onmouseover="showTip(event, 'fs161', 812)" class="f">fst</span>
      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 813)" onmouseover="showTip(event, 'fs66', 813)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs131', 814)" onmouseover="showTip(event, 'fs131', 814)" class="f">map</span> <span onmouseout="hideTip(event, 'fs159', 815)" onmouseover="showTip(event, 'fs159', 815)" class="f">snd</span>
      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 816)" onmouseover="showTip(event, 'fs66', 816)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs158', 817)" onmouseover="showTip(event, 'fs158', 817)" class="f">sortBy</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs243', 818)" onmouseover="showTip(event, 'fs243', 818)" class="i">v&#39;</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs243', 819)" onmouseover="showTip(event, 'fs243', 819)" class="i">v&#39;</span> <span class="o">=</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs200', 820)" onmouseover="showTip(event, 'fs200', 820)" class="v">v</span>)
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs242', 821)" onmouseover="showTip(event, 'fs242', 821)" class="i">availableDirections</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 822)" onmouseover="showTip(event, 'fs97', 822)" class="i">Length</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span>
      <span class="c">// Choose the first one, prefers no change</span>
      <span onmouseout="hideTip(event, 'fs200', 823)" onmouseover="showTip(event, 'fs200', 823)" class="v">v</span> <span class="o">:=</span> <span onmouseout="hideTip(event, 'fs242', 824)" onmouseover="showTip(event, 'fs242', 824)" class="i">availableDirections</span><span class="o">.</span>[<span class="n">0</span>]
    <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs239', 825)" onmouseover="showTip(event, 'fs239', 825)" class="i">inputs</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 826)" onmouseover="showTip(event, 'fs97', 826)" class="i">Length</span> <span class="o">=</span> <span class="n">0</span> <span class="o">||</span> <span onmouseout="hideTip(event, 'fs51', 827)" onmouseover="showTip(event, 'fs51', 827)" class="f">not</span> <span onmouseout="hideTip(event, 'fs241', 828)" onmouseover="showTip(event, 'fs241', 828)" class="i">canGoForward</span> <span class="k">then</span>
      <span class="c">// There are no options - stop</span>
      <span onmouseout="hideTip(event, 'fs200', 829)" onmouseover="showTip(event, 'fs200', 829)" class="v">v</span> <span class="o">:=</span> <span class="n">0</span>,<span class="n">0</span>

    <span class="c">// Update X and Y accordingly</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs103', 830)" onmouseover="showTip(event, 'fs103', 830)" class="i">x&#39;</span>,<span onmouseout="hideTip(event, 'fs104', 831)" onmouseover="showTip(event, 'fs104', 831)" class="i">y&#39;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs108', 832)" onmouseover="showTip(event, 'fs108', 832)" class="f">wrap</span> (<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 833)" onmouseover="showTip(event, 'fs198', 833)" class="v">x</span>,<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 834)" onmouseover="showTip(event, 'fs199', 834)" class="v">y</span>) <span class="o">!</span><span onmouseout="hideTip(event, 'fs200', 835)" onmouseover="showTip(event, 'fs200', 835)" class="v">v</span>
    <span onmouseout="hideTip(event, 'fs198', 836)" onmouseover="showTip(event, 'fs198', 836)" class="v">x</span> <span class="o">:=</span> <span onmouseout="hideTip(event, 'fs103', 837)" onmouseover="showTip(event, 'fs103', 837)" class="i">x&#39;</span>
    <span onmouseout="hideTip(event, 'fs199', 838)" onmouseover="showTip(event, 'fs199', 838)" class="v">y</span> <span class="o">:=</span> <span onmouseout="hideTip(event, 'fs104', 839)" onmouseover="showTip(event, 'fs104', 839)" class="i">y&#39;</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Detect-pills-and-collisiions" class="anchor" href="#Detect-pills-and-collisiions">Detect pills and collisiions</a></h3>
<p>The most sophisticated part of the game logic is checking for various events. The following things can happen:</p>
<ul>
<li>Pacman eats a small or a large pill - in which case, we play a sound and (optionally) switch to the power mode</li>
<li>Pacman clashes with a ghost - in which case it either loses energy, or eats the ghost when in power mode</li>
</ul>
<p>The logic is captured by <code>eatPill</code>, <code>touchingGhosts</code> and <code>collisionDetection</code> functions:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="c">// Check if Pacman eats a pill at current cell</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs244', 840)" onmouseover="showTip(event, 'fs244', 840)" class="f">eatPills</span> () <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs245', 841)" onmouseover="showTip(event, 'fs245', 841)" class="i">tx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 842)" onmouseover="showTip(event, 'fs64', 842)" class="f">int</span> (<span onmouseout="hideTip(event, 'fs145', 843)" onmouseover="showTip(event, 'fs145', 843)" class="f">floor</span>(<span onmouseout="hideTip(event, 'fs14', 844)" onmouseover="showTip(event, 'fs14', 844)" class="f">float</span> ((<span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 845)" onmouseover="showTip(event, 'fs198', 845)" class="v">x</span><span class="o">+</span><span class="n">6</span>)<span class="o">/</span><span class="n">8</span>)))
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs246', 846)" onmouseover="showTip(event, 'fs246', 846)" class="i">ty</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 847)" onmouseover="showTip(event, 'fs64', 847)" class="f">int</span> (<span onmouseout="hideTip(event, 'fs145', 848)" onmouseover="showTip(event, 'fs145', 848)" class="f">floor</span>(<span onmouseout="hideTip(event, 'fs14', 849)" onmouseover="showTip(event, 'fs14', 849)" class="f">float</span> ((<span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 850)" onmouseover="showTip(event, 'fs199', 850)" class="v">y</span><span class="o">+</span><span class="n">6</span>)<span class="o">/</span><span class="n">8</span>)))
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 851)" onmouseover="showTip(event, 'fs34', 851)" class="i">c</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs227', 852)" onmouseover="showTip(event, 'fs227', 852)" class="i">pills</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs246', 853)" onmouseover="showTip(event, 'fs246', 853)" class="i">ty</span>]<span class="o">.</span>[<span onmouseout="hideTip(event, 'fs245', 854)" onmouseover="showTip(event, 'fs245', 854)" class="i">tx</span>]
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs34', 855)" onmouseover="showTip(event, 'fs34', 855)" class="i">c</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span> <span class="k">then</span>
      <span class="c">// Eating a small pill increments the score</span>
      <span onmouseout="hideTip(event, 'fs227', 856)" onmouseover="showTip(event, 'fs227', 856)" class="i">pills</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs246', 857)" onmouseover="showTip(event, 'fs246', 857)" class="i">ty</span>]<span class="o">.</span>[<span onmouseout="hideTip(event, 'fs245', 858)" onmouseover="showTip(event, 'fs245', 858)" class="i">tx</span>] <span class="o">&lt;-</span> <span class="s">&#39; &#39;</span>
      <span onmouseout="hideTip(event, 'fs106', 859)" onmouseover="showTip(event, 'fs106', 859)" class="f">clearCell</span> <span onmouseout="hideTip(event, 'fs85', 860)" onmouseover="showTip(event, 'fs85', 860)" class="i">background</span> (<span onmouseout="hideTip(event, 'fs245', 861)" onmouseover="showTip(event, 'fs245', 861)" class="i">tx</span>,<span onmouseout="hideTip(event, 'fs246', 862)" onmouseover="showTip(event, 'fs246', 862)" class="i">ty</span>)
      <span onmouseout="hideTip(event, 'fs229', 863)" onmouseover="showTip(event, 'fs229', 863)" class="v">score</span> <span class="o">:=</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs229', 864)" onmouseover="showTip(event, 'fs229', 864)" class="v">score</span> <span class="o">+</span> <span class="n">10</span>
      <span onmouseout="hideTip(event, 'fs7', 865)" onmouseover="showTip(event, 'fs7', 865)" class="f">decr</span> <span onmouseout="hideTip(event, 'fs228', 866)" onmouseover="showTip(event, 'fs228', 866)" class="v">dotsLeft</span>
      <span onmouseout="hideTip(event, 'fs204', 867)" onmouseover="showTip(event, 'fs204', 867)" class="f">sound</span>(<span class="s">&quot;./fx/Dot5.wav&quot;</span>)
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs34', 868)" onmouseover="showTip(event, 'fs34', 868)" class="i">c</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span> <span class="k">then</span>
      <span class="c">// Eating a large pill turns on the power mode</span>
      <span onmouseout="hideTip(event, 'fs227', 869)" onmouseover="showTip(event, 'fs227', 869)" class="i">pills</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs246', 870)" onmouseover="showTip(event, 'fs246', 870)" class="i">ty</span>]<span class="o">.</span>[<span onmouseout="hideTip(event, 'fs245', 871)" onmouseover="showTip(event, 'fs245', 871)" class="i">tx</span>] <span class="o">&lt;-</span> <span class="s">&#39; &#39;</span>
      <span onmouseout="hideTip(event, 'fs106', 872)" onmouseover="showTip(event, 'fs106', 872)" class="f">clearCell</span> <span onmouseout="hideTip(event, 'fs85', 873)" onmouseover="showTip(event, 'fs85', 873)" class="i">background</span> (<span onmouseout="hideTip(event, 'fs245', 874)" onmouseover="showTip(event, 'fs245', 874)" class="i">tx</span>,<span onmouseout="hideTip(event, 'fs246', 875)" onmouseover="showTip(event, 'fs246', 875)" class="i">ty</span>)
      <span onmouseout="hideTip(event, 'fs230', 876)" onmouseover="showTip(event, 'fs230', 876)" class="v">bonus</span> <span class="o">:=</span> <span class="n">0</span>
      <span onmouseout="hideTip(event, 'fs229', 877)" onmouseover="showTip(event, 'fs229', 877)" class="v">score</span> <span class="o">:=</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs229', 878)" onmouseover="showTip(event, 'fs229', 878)" class="v">score</span> <span class="o">+</span> <span class="n">50</span>
      <span onmouseout="hideTip(event, 'fs234', 879)" onmouseover="showTip(event, 'fs234', 879)" class="v">powerCountdown</span> <span class="o">:=</span> <span class="n">250</span>
      <span onmouseout="hideTip(event, 'fs7', 880)" onmouseover="showTip(event, 'fs7', 880)" class="f">decr</span> <span onmouseout="hideTip(event, 'fs228', 881)" onmouseover="showTip(event, 'fs228', 881)" class="v">dotsLeft</span>
      <span onmouseout="hideTip(event, 'fs204', 882)" onmouseover="showTip(event, 'fs204', 882)" class="f">sound</span>(<span class="s">&quot;./fx/Powerup.wav&quot;</span>)

  <span class="c">/// Are there any ghosts that collide with Pacman?</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs247', 883)" onmouseover="showTip(event, 'fs247', 883)" class="f">touchingGhosts</span> () <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs248', 884)" onmouseover="showTip(event, 'fs248', 884)" class="i">px</span>, <span onmouseout="hideTip(event, 'fs249', 885)" onmouseover="showTip(event, 'fs249', 885)" class="i">py</span> <span class="o">=</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 886)" onmouseover="showTip(event, 'fs198', 886)" class="v">x</span>, <span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 887)" onmouseover="showTip(event, 'fs199', 887)" class="v">y</span>
    <span onmouseout="hideTip(event, 'fs223', 888)" onmouseover="showTip(event, 'fs223', 888)" class="i">ghosts</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 889)" onmouseover="showTip(event, 'fs66', 889)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs162', 890)" onmouseover="showTip(event, 'fs162', 890)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs124', 891)" onmouseover="showTip(event, 'fs124', 891)" class="i">ghost</span> <span class="k">-&gt;</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 892)" onmouseover="showTip(event, 'fs37', 892)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 893)" onmouseover="showTip(event, 'fs38', 893)" class="i">y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs124', 894)" onmouseover="showTip(event, 'fs124', 894)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs151', 895)" onmouseover="showTip(event, 'fs151', 895)" class="i">X</span>, <span onmouseout="hideTip(event, 'fs124', 896)" onmouseover="showTip(event, 'fs124', 896)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs152', 897)" onmouseover="showTip(event, 'fs152', 897)" class="i">Y</span>
      ((<span onmouseout="hideTip(event, 'fs248', 898)" onmouseover="showTip(event, 'fs248', 898)" class="i">px</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs37', 899)" onmouseover="showTip(event, 'fs37', 899)" class="i">x</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs248', 900)" onmouseover="showTip(event, 'fs248', 900)" class="i">px</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs37', 901)" onmouseover="showTip(event, 'fs37', 901)" class="i">x</span> <span class="o">+</span> <span class="n">13</span>) <span class="o">||</span>
       (<span onmouseout="hideTip(event, 'fs37', 902)" onmouseover="showTip(event, 'fs37', 902)" class="i">x</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs248', 903)" onmouseover="showTip(event, 'fs248', 903)" class="i">px</span> <span class="o">+</span> <span class="n">13</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs37', 904)" onmouseover="showTip(event, 'fs37', 904)" class="i">x</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs248', 905)" onmouseover="showTip(event, 'fs248', 905)" class="i">px</span>)) <span class="o">&amp;&amp;</span>
      ((<span onmouseout="hideTip(event, 'fs249', 906)" onmouseover="showTip(event, 'fs249', 906)" class="i">py</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs38', 907)" onmouseover="showTip(event, 'fs38', 907)" class="i">y</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs249', 908)" onmouseover="showTip(event, 'fs249', 908)" class="i">py</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs38', 909)" onmouseover="showTip(event, 'fs38', 909)" class="i">y</span> <span class="o">+</span> <span class="n">13</span>) <span class="o">||</span>
       (<span onmouseout="hideTip(event, 'fs38', 910)" onmouseover="showTip(event, 'fs38', 910)" class="i">y</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs249', 911)" onmouseover="showTip(event, 'fs249', 911)" class="i">py</span> <span class="o">+</span> <span class="n">13</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs38', 912)" onmouseover="showTip(event, 'fs38', 912)" class="i">y</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs249', 913)" onmouseover="showTip(event, 'fs249', 913)" class="i">py</span>)) )
</code></pre></td>
</tr>
</table>
<p>The <code>collisionDetection</code> function implements the right response to collision with a ghost:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="c">/// Handle collision detections between Pacman and ghosts</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs250', 914)" onmouseover="showTip(event, 'fs250', 914)" class="f">collisionDetection</span> () <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs251', 915)" onmouseover="showTip(event, 'fs251', 915)" class="i">touched</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs247', 916)" onmouseover="showTip(event, 'fs247', 916)" class="f">touchingGhosts</span> ()
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs251', 917)" onmouseover="showTip(event, 'fs251', 917)" class="i">touched</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 918)" onmouseover="showTip(event, 'fs97', 918)" class="i">Length</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span>
      <span class="k">if</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs234', 919)" onmouseover="showTip(event, 'fs234', 919)" class="v">powerCountdown</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span>
        <span class="c">// Pacman is eating ghosts!</span>
        <span onmouseout="hideTip(event, 'fs251', 920)" onmouseover="showTip(event, 'fs251', 920)" class="i">touched</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 921)" onmouseover="showTip(event, 'fs66', 921)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs236', 922)" onmouseover="showTip(event, 'fs236', 922)" class="f">iter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs124', 923)" onmouseover="showTip(event, 'fs124', 923)" class="i">ghost</span> <span class="k">-&gt;</span>
          <span class="k">if</span> <span onmouseout="hideTip(event, 'fs51', 924)" onmouseover="showTip(event, 'fs51', 924)" class="f">not</span> <span onmouseout="hideTip(event, 'fs124', 925)" onmouseover="showTip(event, 'fs124', 925)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs156', 926)" onmouseover="showTip(event, 'fs156', 926)" class="i">IsReturning</span> <span class="k">then</span>
            <span onmouseout="hideTip(event, 'fs204', 927)" onmouseover="showTip(event, 'fs204', 927)" class="f">sound</span> <span class="s">&quot;./fx/EatGhost.wav&quot;</span>
            <span onmouseout="hideTip(event, 'fs124', 928)" onmouseover="showTip(event, 'fs124', 928)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs156', 929)" onmouseover="showTip(event, 'fs156', 929)" class="i">IsReturning</span> <span class="o">&lt;-</span> <span class="k">true</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs252', 930)" onmouseover="showTip(event, 'fs252', 930)" class="i">added</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 931)" onmouseover="showTip(event, 'fs64', 931)" class="f">int</span> (<span class="n">2.</span> <span class="o">**</span> (<span onmouseout="hideTip(event, 'fs14', 932)" onmouseover="showTip(event, 'fs14', 932)" class="f">float</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs230', 933)" onmouseover="showTip(event, 'fs230', 933)" class="v">bonus</span>))
            <span onmouseout="hideTip(event, 'fs229', 934)" onmouseover="showTip(event, 'fs229', 934)" class="v">score</span> <span class="o">:=</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs229', 935)" onmouseover="showTip(event, 'fs229', 935)" class="v">score</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs252', 936)" onmouseover="showTip(event, 'fs252', 936)" class="i">added</span> <span class="o">*</span> <span class="n">200</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs112', 937)" onmouseover="showTip(event, 'fs112', 937)" class="i">image</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs218', 938)" onmouseover="showTip(event, 'fs218', 938)" class="i">bonusImages</span><span class="o">.</span>[<span class="o">!</span><span onmouseout="hideTip(event, 'fs230', 939)" onmouseover="showTip(event, 'fs230', 939)" class="v">bonus</span>]
            <span onmouseout="hideTip(event, 'fs231', 940)" onmouseover="showTip(event, 'fs231', 940)" class="v">bonuses</span> <span class="o">:=</span> (<span class="n">100</span>, (<span onmouseout="hideTip(event, 'fs112', 941)" onmouseover="showTip(event, 'fs112', 941)" class="i">image</span>, <span onmouseout="hideTip(event, 'fs124', 942)" onmouseover="showTip(event, 'fs124', 942)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs151', 943)" onmouseover="showTip(event, 'fs151', 943)" class="i">X</span>, <span onmouseout="hideTip(event, 'fs124', 944)" onmouseover="showTip(event, 'fs124', 944)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs152', 945)" onmouseover="showTip(event, 'fs152', 945)" class="i">Y</span>)) <span class="o">::</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs231', 946)" onmouseover="showTip(event, 'fs231', 946)" class="v">bonuses</span>
            <span onmouseout="hideTip(event, 'fs230', 947)" onmouseover="showTip(event, 'fs230', 947)" class="v">bonus</span> <span class="o">:=</span>  <span onmouseout="hideTip(event, 'fs8', 948)" onmouseover="showTip(event, 'fs8', 948)" class="f">min</span> <span class="n">3</span> (<span class="o">!</span><span onmouseout="hideTip(event, 'fs230', 949)" onmouseover="showTip(event, 'fs230', 949)" class="v">bonus</span> <span class="o">+</span> <span class="n">1</span>) )
      <span class="k">else</span>
        <span class="c">// Pacman loses energy when hitting ghosts</span>
        <span onmouseout="hideTip(event, 'fs7', 950)" onmouseover="showTip(event, 'fs7', 950)" class="f">decr</span> <span onmouseout="hideTip(event, 'fs232', 951)" onmouseover="showTip(event, 'fs232', 951)" class="v">energy</span>
        <span class="k">if</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs233', 952)" onmouseover="showTip(event, 'fs233', 952)" class="v">flashCountdown</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs204', 953)" onmouseover="showTip(event, 'fs204', 953)" class="f">sound</span> <span class="s">&quot;./fx/Hurt.wav&quot;</span>
        <span onmouseout="hideTip(event, 'fs233', 954)" onmouseover="showTip(event, 'fs233', 954)" class="v">flashCountdown</span> <span class="o">:=</span> <span class="n">30</span>
    <span class="k">if</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs233', 955)" onmouseover="showTip(event, 'fs233', 955)" class="v">flashCountdown</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs7', 956)" onmouseover="showTip(event, 'fs7', 956)" class="f">decr</span> <span onmouseout="hideTip(event, 'fs233', 957)" onmouseover="showTip(event, 'fs233', 957)" class="v">flashCountdown</span>

  <span class="c">/// Updates bonus points </span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs253', 958)" onmouseover="showTip(event, 'fs253', 958)" class="f">updateBonus</span> () <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs254', 959)" onmouseover="showTip(event, 'fs254', 959)" class="i">removals</span>,<span onmouseout="hideTip(event, 'fs255', 960)" onmouseover="showTip(event, 'fs255', 960)" class="i">remainders</span> <span class="o">=</span>
      <span class="o">!</span><span onmouseout="hideTip(event, 'fs231', 961)" onmouseover="showTip(event, 'fs231', 961)" class="v">bonuses</span>
      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs137', 962)" onmouseover="showTip(event, 'fs137', 962)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs256', 963)" onmouseover="showTip(event, 'fs256', 963)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs257', 964)" onmouseover="showTip(event, 'fs257', 964)" class="i">count</span>,<span onmouseout="hideTip(event, 'fs258', 965)" onmouseover="showTip(event, 'fs258', 965)" class="i">x</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs257', 966)" onmouseover="showTip(event, 'fs257', 966)" class="i">count</span><span class="o">-</span><span class="n">1</span>,<span onmouseout="hideTip(event, 'fs258', 967)" onmouseover="showTip(event, 'fs258', 967)" class="i">x</span>)
      <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs137', 968)" onmouseover="showTip(event, 'fs137', 968)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs259', 969)" onmouseover="showTip(event, 'fs259', 969)" class="f">partition</span> (<span onmouseout="hideTip(event, 'fs161', 970)" onmouseover="showTip(event, 'fs161', 970)" class="f">fst</span> <span class="o">&gt;</span><span class="o">&gt;</span> (<span class="o">=</span>) <span class="n">0</span>)
    <span onmouseout="hideTip(event, 'fs231', 971)" onmouseover="showTip(event, 'fs231', 971)" class="v">bonuses</span> <span class="o">:=</span> <span onmouseout="hideTip(event, 'fs255', 972)" onmouseover="showTip(event, 'fs255', 972)" class="i">remainders</span>
</code></pre></td>
</tr>
</table>
<p>The logic is called from the following single <code>logic</code> function that includes all the checks:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs260', 973)" onmouseover="showTip(event, 'fs260', 973)" class="f">logic</span> () <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs235', 974)" onmouseover="showTip(event, 'fs235', 974)" class="f">moveGhosts</span>()
    <span onmouseout="hideTip(event, 'fs238', 975)" onmouseover="showTip(event, 'fs238', 975)" class="f">movePacman</span>()
    <span onmouseout="hideTip(event, 'fs244', 976)" onmouseover="showTip(event, 'fs244', 976)" class="f">eatPills</span> ()
    <span class="k">if</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs234', 977)" onmouseover="showTip(event, 'fs234', 977)" class="v">powerCountdown</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs7', 978)" onmouseover="showTip(event, 'fs7', 978)" class="f">decr</span> <span onmouseout="hideTip(event, 'fs234', 979)" onmouseover="showTip(event, 'fs234', 979)" class="v">powerCountdown</span>
    <span onmouseout="hideTip(event, 'fs250', 980)" onmouseover="showTip(event, 'fs250', 980)" class="f">collisionDetection</span>()
    <span onmouseout="hideTip(event, 'fs253', 981)" onmouseover="showTip(event, 'fs253', 981)" class="f">updateBonus</span> ()
</code></pre></td>
</tr>
</table>
<h3><a name="Rendering-everything-in-the-game" class="anchor" href="#Rendering-everything-in-the-game">Rendering everything in the game</a></h3>
<p>When rendering everything in the game, we first draw the background and then we render
individual components. Those include the score, remaining energy, pacman, ghosts and bonuses.
Each of those is handled by a single nested function that are put together in <code>render</code>.
We start with Pacman and remaining energy:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs261', 982)" onmouseover="showTip(event, 'fs261', 982)" class="f">renderPacman</span> () <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs203', 983)" onmouseover="showTip(event, 'fs203', 983)" class="i">p</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs262', 984)" onmouseover="showTip(event, 'fs262', 984)" class="t">Pacman</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs197', 985)" onmouseover="showTip(event, 'fs197', 985)" class="f">imageAt</span>(<span onmouseout="hideTip(event, 'fs198', 986)" onmouseover="showTip(event, 'fs198', 986)" class="v">x</span>,<span onmouseout="hideTip(event, 'fs199', 987)" onmouseover="showTip(event, 'fs199', 987)" class="v">y</span>,<span onmouseout="hideTip(event, 'fs200', 988)" onmouseover="showTip(event, 'fs200', 988)" class="v">v</span>)
    <span class="k">if</span> (<span class="o">!</span><span onmouseout="hideTip(event, 'fs233', 989)" onmouseover="showTip(event, 'fs233', 989)" class="v">flashCountdown</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">1</span>) <span class="o">%</span> <span class="n">2</span> <span class="o">=</span> <span class="n">0</span>
    <span class="k">then</span> <span onmouseout="hideTip(event, 'fs72', 990)" onmouseover="showTip(event, 'fs72', 990)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs263', 991)" onmouseover="showTip(event, 'fs263', 991)" class="f">drawImage</span>(<span onmouseout="hideTip(event, 'fs91', 992)" onmouseover="showTip(event, 'fs91', 992)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 993)" onmouseover="showTip(event, 'fs92', 993)" class="p">Case1</span> <span onmouseout="hideTip(event, 'fs203', 994)" onmouseover="showTip(event, 'fs203', 994)" class="i">p</span>, <span onmouseout="hideTip(event, 'fs14', 995)" onmouseover="showTip(event, 'fs14', 995)" class="f">float</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs198', 996)" onmouseover="showTip(event, 'fs198', 996)" class="v">x</span>, <span onmouseout="hideTip(event, 'fs14', 997)" onmouseover="showTip(event, 'fs14', 997)" class="f">float</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs199', 998)" onmouseover="showTip(event, 'fs199', 998)" class="v">y</span>)

  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs264', 999)" onmouseover="showTip(event, 'fs264', 999)" class="f">renderEnergy</span> () <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs72', 1000)" onmouseover="showTip(event, 'fs72', 1000)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 1001)" onmouseover="showTip(event, 'fs90', 1001)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs91', 1002)" onmouseover="showTip(event, 'fs91', 1002)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 1003)" onmouseover="showTip(event, 'fs92', 1003)" class="p">Case1</span> <span class="s">&quot;yellow&quot;</span>
    <span onmouseout="hideTip(event, 'fs72', 1004)" onmouseover="showTip(event, 'fs72', 1004)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 1005)" onmouseover="showTip(event, 'fs93', 1005)" class="f">fillRect</span>(<span class="n">120.</span>, <span class="n">250.</span>, <span onmouseout="hideTip(event, 'fs14', 1006)" onmouseover="showTip(event, 'fs14', 1006)" class="f">float</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs232', 1007)" onmouseover="showTip(event, 'fs232', 1007)" class="v">energy</span>, <span class="n">2.</span>)
</code></pre></td>
</tr>
</table>
<p>The next three functions render ghosts, current score and bonuses:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs265', 1008)" onmouseover="showTip(event, 'fs265', 1008)" class="f">renderGhosts</span> () <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs223', 1009)" onmouseover="showTip(event, 'fs223', 1009)" class="i">ghosts</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs66', 1010)" onmouseover="showTip(event, 'fs66', 1010)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs236', 1011)" onmouseover="showTip(event, 'fs236', 1011)" class="f">iter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs124', 1012)" onmouseover="showTip(event, 'fs124', 1012)" class="i">ghost</span> <span class="k">-&gt;</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs112', 1013)" onmouseover="showTip(event, 'fs112', 1013)" class="i">image</span> <span class="o">=</span>
        <span class="k">if</span> <span onmouseout="hideTip(event, 'fs124', 1014)" onmouseover="showTip(event, 'fs124', 1014)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs156', 1015)" onmouseover="showTip(event, 'fs156', 1015)" class="i">IsReturning</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs225', 1016)" onmouseover="showTip(event, 'fs225', 1016)" class="i">eyed</span>
        <span class="k">else</span>
          <span class="k">if</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs234', 1017)" onmouseover="showTip(event, 'fs234', 1017)" class="v">powerCountdown</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs124', 1018)" onmouseover="showTip(event, 'fs124', 1018)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs266', 1019)" onmouseover="showTip(event, 'fs266', 1019)" class="i">Image</span>
          <span class="k">elif</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs234', 1020)" onmouseover="showTip(event, 'fs234', 1020)" class="v">powerCountdown</span> <span class="o">&gt;</span> <span class="n">100</span> <span class="o">||</span>
                ((<span class="o">!</span><span onmouseout="hideTip(event, 'fs234', 1021)" onmouseover="showTip(event, 'fs234', 1021)" class="v">powerCountdown</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">3</span>) <span class="o">%</span> <span class="n">2</span>) <span class="o">&lt;&gt;</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs224', 1022)" onmouseover="showTip(event, 'fs224', 1022)" class="i">blue</span>
          <span class="k">else</span> <span onmouseout="hideTip(event, 'fs124', 1023)" onmouseover="showTip(event, 'fs124', 1023)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs266', 1024)" onmouseover="showTip(event, 'fs266', 1024)" class="i">Image</span>
      <span onmouseout="hideTip(event, 'fs72', 1025)" onmouseover="showTip(event, 'fs72', 1025)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs263', 1026)" onmouseover="showTip(event, 'fs263', 1026)" class="f">drawImage</span>(<span onmouseout="hideTip(event, 'fs91', 1027)" onmouseover="showTip(event, 'fs91', 1027)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 1028)" onmouseover="showTip(event, 'fs92', 1028)" class="p">Case1</span> <span onmouseout="hideTip(event, 'fs112', 1029)" onmouseover="showTip(event, 'fs112', 1029)" class="i">image</span>, <span onmouseout="hideTip(event, 'fs14', 1030)" onmouseover="showTip(event, 'fs14', 1030)" class="f">float</span> <span onmouseout="hideTip(event, 'fs124', 1031)" onmouseover="showTip(event, 'fs124', 1031)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs151', 1032)" onmouseover="showTip(event, 'fs151', 1032)" class="i">X</span>, <span onmouseout="hideTip(event, 'fs14', 1033)" onmouseover="showTip(event, 'fs14', 1033)" class="f">float</span> <span onmouseout="hideTip(event, 'fs124', 1034)" onmouseover="showTip(event, 'fs124', 1034)" class="i">ghost</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs152', 1035)" onmouseover="showTip(event, 'fs152', 1035)" class="i">Y</span>) )

  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs267', 1036)" onmouseover="showTip(event, 'fs267', 1036)" class="f">renderScore</span> () <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs72', 1037)" onmouseover="showTip(event, 'fs72', 1037)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 1038)" onmouseover="showTip(event, 'fs90', 1038)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs91', 1039)" onmouseover="showTip(event, 'fs91', 1039)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 1040)" onmouseover="showTip(event, 'fs92', 1040)" class="p">Case1</span> <span class="s">&quot;white&quot;</span>
    <span onmouseout="hideTip(event, 'fs72', 1041)" onmouseover="showTip(event, 'fs72', 1041)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs268', 1042)" onmouseover="showTip(event, 'fs268', 1042)" class="i">font</span> <span class="o">&lt;-</span> <span class="s">&quot;bold 8px&quot;</span>;
    <span onmouseout="hideTip(event, 'fs72', 1043)" onmouseover="showTip(event, 'fs72', 1043)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs269', 1044)" onmouseover="showTip(event, 'fs269', 1044)" class="f">fillText</span>(<span class="s">&quot;Score &quot;</span> <span class="o">+</span> (<span class="o">!</span><span onmouseout="hideTip(event, 'fs229', 1045)" onmouseover="showTip(event, 'fs229', 1045)" class="v">score</span>)<span class="o">.</span><span class="f">ToString</span>(), <span class="n">0.</span>, <span class="n">255.</span>)

  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs270', 1046)" onmouseover="showTip(event, 'fs270', 1046)" class="f">renderBonus</span> () <span class="o">=</span>
    <span class="o">!</span><span onmouseout="hideTip(event, 'fs231', 1047)" onmouseover="showTip(event, 'fs231', 1047)" class="v">bonuses</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs137', 1048)" onmouseover="showTip(event, 'fs137', 1048)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs139', 1049)" onmouseover="showTip(event, 'fs139', 1049)" class="f">iter</span> (<span class="k">fun</span> (_,(<span onmouseout="hideTip(event, 'fs112', 1050)" onmouseover="showTip(event, 'fs112', 1050)" class="i">image</span>,<span onmouseout="hideTip(event, 'fs37', 1051)" onmouseover="showTip(event, 'fs37', 1051)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs38', 1052)" onmouseover="showTip(event, 'fs38', 1052)" class="i">y</span>)) <span class="k">-&gt;</span>
      <span onmouseout="hideTip(event, 'fs72', 1053)" onmouseover="showTip(event, 'fs72', 1053)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs263', 1054)" onmouseover="showTip(event, 'fs263', 1054)" class="f">drawImage</span>(<span onmouseout="hideTip(event, 'fs91', 1055)" onmouseover="showTip(event, 'fs91', 1055)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 1056)" onmouseover="showTip(event, 'fs92', 1056)" class="p">Case1</span> <span class="i">image</span>, <span onmouseout="hideTip(event, 'fs14', 1057)" onmouseover="showTip(event, 'fs14', 1057)" class="f">float</span> <span onmouseout="hideTip(event, 'fs37', 1058)" onmouseover="showTip(event, 'fs37', 1058)" class="i">x</span>, <span onmouseout="hideTip(event, 'fs14', 1059)" onmouseover="showTip(event, 'fs14', 1059)" class="f">float</span> <span onmouseout="hideTip(event, 'fs38', 1060)" onmouseover="showTip(event, 'fs38', 1060)" class="i">y</span>))
</code></pre></td>
</tr>
</table>
<p>Finally, the <code>render</code> function puts everything together - note that this needs
to be done in the right order so that we do not accidentally draw dots over a Pacman!</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs271', 1061)" onmouseover="showTip(event, 'fs271', 1061)" class="f">render</span> () <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs72', 1062)" onmouseover="showTip(event, 'fs72', 1062)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs263', 1063)" onmouseover="showTip(event, 'fs263', 1063)" class="f">drawImage</span>(<span onmouseout="hideTip(event, 'fs91', 1064)" onmouseover="showTip(event, 'fs91', 1064)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs272', 1065)" onmouseover="showTip(event, 'fs272', 1065)" class="p">Case2</span> <span onmouseout="hideTip(event, 'fs85', 1066)" onmouseover="showTip(event, 'fs85', 1066)" class="i">background</span>, <span class="n">0.</span>, <span class="n">0.</span>)
    <span onmouseout="hideTip(event, 'fs267', 1067)" onmouseover="showTip(event, 'fs267', 1067)" class="f">renderScore</span> ()
    <span onmouseout="hideTip(event, 'fs264', 1068)" onmouseover="showTip(event, 'fs264', 1068)" class="f">renderEnergy</span> ()
    <span onmouseout="hideTip(event, 'fs261', 1069)" onmouseover="showTip(event, 'fs261', 1069)" class="f">renderPacman</span>()
    <span onmouseout="hideTip(event, 'fs265', 1070)" onmouseover="showTip(event, 'fs265', 1070)" class="f">renderGhosts</span> ()
    <span onmouseout="hideTip(event, 'fs270', 1071)" onmouseover="showTip(event, 'fs270', 1071)" class="f">renderBonus</span> ()
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">  <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs213', 1072)" onmouseover="showTip(event, 'fs213', 1072)" class="f">update</span> () <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs260', 1073)" onmouseover="showTip(event, 'fs260', 1073)" class="f">logic</span> ()
    <span onmouseout="hideTip(event, 'fs271', 1074)" onmouseover="showTip(event, 'fs271', 1074)" class="f">render</span> ()
    <span class="k">if</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs228', 1075)" onmouseover="showTip(event, 'fs228', 1075)" class="v">dotsLeft</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs211', 1076)" onmouseover="showTip(event, 'fs211', 1076)" class="f">onLevelCompleted</span>()
    <span class="k">elif</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs232', 1077)" onmouseover="showTip(event, 'fs232', 1077)" class="v">energy</span> <span class="o">&lt;=</span> <span class="n">0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs212', 1078)" onmouseover="showTip(event, 'fs212', 1078)" class="f">onGameOver</span>()
    <span class="k">else</span> <span onmouseout="hideTip(event, 'fs180', 1079)" onmouseover="showTip(event, 'fs180', 1079)" class="i">window</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs273', 1080)" onmouseover="showTip(event, 'fs273', 1080)" class="f">setTimeout</span>(<span onmouseout="hideTip(event, 'fs213', 1081)" onmouseover="showTip(event, 'fs213', 1081)" class="f">update</span>, <span class="n">1000.</span> <span class="o">/</span> <span class="n">60.</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs214', 1082)" onmouseover="showTip(event, 'fs214', 1082)" class="f">ignore</span>

  <span onmouseout="hideTip(event, 'fs213', 1083)" onmouseover="showTip(event, 'fs213', 1083)" class="f">update</span>()
</code></pre></td>
</tr>
</table>
<h2><a name="Game-entry-point" class="anchor" href="#Game-entry-point">Game entry point</a></h2>
<p>Now we have everything we need to start the game, so the last step is to define the
<code>levelCompleted</code> and <code>gameOver</code> functions (that are called when the game ends), render
the starting state of the game (with "CLICK TO START" text) and start the game!</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs274', 1084)" onmouseover="showTip(event, 'fs274', 1084)" class="f">game</span> () <span class="o">=</span>
  <span class="c">// Initialize keyboard and canvas</span>
  <span onmouseout="hideTip(event, 'fs240', 1085)" onmouseover="showTip(event, 'fs240', 1085)" class="t">Keyboard</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs167', 1086)" onmouseover="showTip(event, 'fs167', 1086)" class="f">reset</span>()
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs216', 1087)" onmouseover="showTip(event, 'fs216', 1087)" class="i">canvas</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 1088)" onmouseover="showTip(event, 'fs24', 1088)" class="i">document</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs217', 1089)" onmouseover="showTip(event, 'fs217', 1089)" class="f">getElementsByTagName_canvas</span>()<span class="o">.</span>[<span class="n">0.</span>]
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 1090)" onmouseover="showTip(event, 'fs72', 1090)" class="i">context</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs216', 1091)" onmouseover="showTip(event, 'fs216', 1091)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 1092)" onmouseover="showTip(event, 'fs89', 1092)" class="f">getContext_2d</span>()

  <span class="c">// A helper function to draw text</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs275', 1093)" onmouseover="showTip(event, 'fs275', 1093)" class="f">drawText</span>(<span onmouseout="hideTip(event, 'fs276', 1094)" onmouseover="showTip(event, 'fs276', 1094)" class="i">text</span>,<span onmouseout="hideTip(event, 'fs277', 1095)" onmouseover="showTip(event, 'fs277', 1095)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs278', 1096)" onmouseover="showTip(event, 'fs278', 1096)" class="i">y</span>) <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs72', 1097)" onmouseover="showTip(event, 'fs72', 1097)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 1098)" onmouseover="showTip(event, 'fs90', 1098)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs91', 1099)" onmouseover="showTip(event, 'fs91', 1099)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 1100)" onmouseover="showTip(event, 'fs92', 1100)" class="p">Case1</span> <span class="s">&quot;white&quot;</span>
    <span onmouseout="hideTip(event, 'fs72', 1101)" onmouseover="showTip(event, 'fs72', 1101)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs268', 1102)" onmouseover="showTip(event, 'fs268', 1102)" class="i">font</span> <span class="o">&lt;-</span> <span class="s">&quot;bold 8px&quot;</span>;
    <span onmouseout="hideTip(event, 'fs72', 1103)" onmouseover="showTip(event, 'fs72', 1103)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs269', 1104)" onmouseover="showTip(event, 'fs269', 1104)" class="f">fillText</span>(<span onmouseout="hideTip(event, 'fs276', 1105)" onmouseover="showTip(event, 'fs276', 1105)" class="i">text</span>, <span onmouseout="hideTip(event, 'fs277', 1106)" onmouseover="showTip(event, 'fs277', 1106)" class="i">x</span>, <span onmouseout="hideTip(event, 'fs278', 1107)" onmouseover="showTip(event, 'fs278', 1107)" class="i">y</span>)
  
  <span class="c">// Called when level is completed</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs279', 1108)" onmouseover="showTip(event, 'fs279', 1108)" class="f">levelCompleted</span> () <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs275', 1109)" onmouseover="showTip(event, 'fs275', 1109)" class="f">drawText</span>(<span class="s">&quot;COMPLETED&quot;</span>,<span class="n">96.</span>,<span class="n">96.</span>)
    <span onmouseout="hideTip(event, 'fs180', 1110)" onmouseover="showTip(event, 'fs180', 1110)" class="i">window</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs273', 1111)" onmouseover="showTip(event, 'fs273', 1111)" class="f">setTimeout</span>((<span class="k">fun</span> () <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs274', 1112)" onmouseover="showTip(event, 'fs274', 1112)" class="f">game</span>()),<span class="n">5000.</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs214', 1113)" onmouseover="showTip(event, 'fs214', 1113)" class="f">ignore</span>
  <span class="c">// Called when the game ends</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs280', 1114)" onmouseover="showTip(event, 'fs280', 1114)" class="f">gameOver</span> () <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs275', 1115)" onmouseover="showTip(event, 'fs275', 1115)" class="f">drawText</span>(<span class="s">&quot;GAME OVER&quot;</span>,<span class="n">96.</span>,<span class="n">96.</span>)
    <span onmouseout="hideTip(event, 'fs180', 1116)" onmouseover="showTip(event, 'fs180', 1116)" class="i">window</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs273', 1117)" onmouseover="showTip(event, 'fs273', 1117)" class="f">setTimeout</span>((<span class="k">fun</span> () <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs274', 1118)" onmouseover="showTip(event, 'fs274', 1118)" class="f">game</span>()),<span class="n">5000.</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs214', 1119)" onmouseover="showTip(event, 'fs214', 1119)" class="f">ignore</span>

  <span class="c">// Start a new game after click!</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs281', 1120)" onmouseover="showTip(event, 'fs281', 1120)" class="f">start</span> () <span class="o">=</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 1121)" onmouseover="showTip(event, 'fs85', 1121)" class="i">background</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs84', 1122)" onmouseover="showTip(event, 'fs84', 1122)" class="f">createBackground</span>()
    <span onmouseout="hideTip(event, 'fs72', 1123)" onmouseover="showTip(event, 'fs72', 1123)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs263', 1124)" onmouseover="showTip(event, 'fs263', 1124)" class="f">drawImage</span>(<span onmouseout="hideTip(event, 'fs91', 1125)" onmouseover="showTip(event, 'fs91', 1125)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs272', 1126)" onmouseover="showTip(event, 'fs272', 1126)" class="p">Case2</span> <span onmouseout="hideTip(event, 'fs85', 1127)" onmouseover="showTip(event, 'fs85', 1127)" class="i">background</span>, <span class="n">0.</span>, <span class="n">0.</span>)
    <span onmouseout="hideTip(event, 'fs72', 1128)" onmouseover="showTip(event, 'fs72', 1128)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 1129)" onmouseover="showTip(event, 'fs90', 1129)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs91', 1130)" onmouseover="showTip(event, 'fs91', 1130)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 1131)" onmouseover="showTip(event, 'fs92', 1131)" class="p">Case1</span> <span class="s">&quot;white&quot;</span>
    <span onmouseout="hideTip(event, 'fs72', 1132)" onmouseover="showTip(event, 'fs72', 1132)" class="i">context</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs268', 1133)" onmouseover="showTip(event, 'fs268', 1133)" class="i">font</span> <span class="o">&lt;-</span> <span class="s">&quot;bold 8px&quot;</span>;
    <span onmouseout="hideTip(event, 'fs275', 1134)" onmouseover="showTip(event, 'fs275', 1134)" class="f">drawText</span>(<span class="s">&quot;CLICK TO START&quot;</span>, <span class="n">88.</span>, <span class="n">96.</span>)
    <span onmouseout="hideTip(event, 'fs216', 1135)" onmouseover="showTip(event, 'fs216', 1135)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs282', 1136)" onmouseover="showTip(event, 'fs282', 1136)" class="i">onclick</span> <span class="o">&lt;-</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs283', 1137)" onmouseover="showTip(event, 'fs283', 1137)" class="i">e</span> <span class="k">-&gt;</span>
      <span onmouseout="hideTip(event, 'fs216', 1138)" onmouseover="showTip(event, 'fs216', 1138)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs282', 1139)" onmouseover="showTip(event, 'fs282', 1139)" class="i">onclick</span> <span class="o">&lt;-</span> <span class="k">null</span>
      <span onmouseout="hideTip(event, 'fs215', 1140)" onmouseover="showTip(event, 'fs215', 1140)" class="f">playLevel</span> (<span onmouseout="hideTip(event, 'fs279', 1141)" onmouseover="showTip(event, 'fs279', 1141)" class="f">levelCompleted</span>, <span onmouseout="hideTip(event, 'fs280', 1142)" onmouseover="showTip(event, 'fs280', 1142)" class="f">gameOver</span>)
      <span onmouseout="hideTip(event, 'fs284', 1143)" onmouseover="showTip(event, 'fs284', 1143)" class="f">box</span> <span class="k">true</span> )

  <span class="c">// Resize canvas and get ready for a game</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs216', 1144)" onmouseover="showTip(event, 'fs216', 1144)" class="i">canvas</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 1145)" onmouseover="showTip(event, 'fs24', 1145)" class="i">document</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs217', 1146)" onmouseover="showTip(event, 'fs217', 1146)" class="f">getElementsByTagName_canvas</span>()<span class="o">.</span>[<span class="n">0.</span>]
  <span onmouseout="hideTip(event, 'fs216', 1147)" onmouseover="showTip(event, 'fs216', 1147)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs87', 1148)" onmouseover="showTip(event, 'fs87', 1148)" class="i">width</span> <span class="o">&lt;-</span> <span class="n">256.</span>
  <span onmouseout="hideTip(event, 'fs216', 1149)" onmouseover="showTip(event, 'fs216', 1149)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs88', 1150)" onmouseover="showTip(event, 'fs88', 1150)" class="i">height</span> <span class="o">&lt;-</span> <span class="n">256.</span>
  <span onmouseout="hideTip(event, 'fs281', 1151)" onmouseover="showTip(event, 'fs281', 1151)" class="f">start</span>()

<span class="c">// At the beginnin, initialize keyboard &amp; start the first game.</span>
<span onmouseout="hideTip(event, 'fs240', 1152)" onmouseover="showTip(event, 'fs240', 1152)" class="t">Keyboard</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs179', 1153)" onmouseover="showTip(event, 'fs179', 1153)" class="f">init</span> ()
<span onmouseout="hideTip(event, 'fs274', 1154)" onmouseover="showTip(event, 'fs274', 1154)" class="f">game</span> ()
</code></pre></td>
</tr>
</table>


<div class="tip" id="fs1">namespace Fable</div>
<div class="tip" id="fs2">namespace Fable.Core</div>
<div class="tip" id="fs3">namespace Fable.Import</div>
<div class="tip" id="fs4">module Browser<br /><br />from Fable.Import</div>
<div class="tip" id="fs5">val incr : r:int ref -&gt; unit<br /><br />Full name: Pacman.incr</div>
<div class="tip" id="fs6">val r : int ref</div>
<div class="tip" id="fs7">val decr : r:int ref -&gt; unit<br /><br />Full name: Pacman.decr</div>
<div class="tip" id="fs8">val min : a:&#39;a -&gt; b:&#39;a -&gt; &#39;a (requires comparison)<br /><br />Full name: Pacman.min</div>
<div class="tip" id="fs9">val a : &#39;a (requires comparison)</div>
<div class="tip" id="fs10">val b : &#39;a (requires comparison)</div>
<div class="tip" id="fs11">val max : a:&#39;a -&gt; b:&#39;a -&gt; &#39;a (requires comparison)<br /><br />Full name: Pacman.max</div>
<div class="tip" id="fs12">Multiple items<br />type EmitAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : macro:string -&gt; EmitAttribute<br /><br />Full name: Fable.Core.EmitAttribute<br /><br />--------------------<br />new : macro:string -&gt; EmitAttribute</div>
<div class="tip" id="fs13">val random : unit -&gt; float<br /><br />Full name: Pacman.random</div>
<div class="tip" id="fs14">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = System.Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs15">val failwith : message:string -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.failwith</div>
<div class="tip" id="fs16">val cyand : string<br /><br />Full name: Pacman.cyand</div>
<div class="tip" id="fs17">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAiUlEQVQoU8WSURKAIAhE8Sh6Fc/tVfQoJdqiMDTVV4wfufAAmw3kxEHUz4pA1I8OJVjAKZZ6+XiC0ATTB/gW2mEFtlpHLqaktrQ6TxUQSRCAPX2AWPMLyM0VmPOcV8palxt6uoAMpDjfWJt+o6cr0DPDnfYjyL94NwIcYjXcR/FuYklcxrZ3OO0Ep4dJ/3dR5jcAAAAASUVORK5CYII=&quot;</div>
<div class="tip" id="fs18">val oranged : string<br /><br />Full name: Pacman.oranged</div>
<div class="tip" id="fs19">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAgklEQVQoU8WS0RGAIAxDZRRYhblZBUZBsBSaUk/9kj9CXlru4g7r1FxBdsFpGwoa2NwrYIFPEIeM6QS+hQQMYC70EjzuuOlt6gT5kRGGTf0Cx5qfwJYOYIw0L6W1bg+09Al2wAcCS8Y/WjqAZhluxD/B3ghZBO6n1sadzLLEbNSg8pzXIVLvbNvPwAAAAABJRU5ErkJggg==&quot;</div>
<div class="tip" id="fs20">let pinkd = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAj0lEQVQoU8WSsRWAIAxEZRQpXITGVZzIVWxYxAJHwRfwMInxqZV0XPIvgXeuM05eUuayG73TbULQwKWZGTTwCYIJphfwLcRhAW5DLfWrXFLrNLWBKAIBbOkFxJpfQDIXYAh1XoznumRo6Q0kwE8VTLN8o6UL0ArDnfYjSF/Mg4CEaA330sxD3ApHLvUdSdsBdgNkr9L8gxYAAAAASUVORK5CYII=&quot;<br />let redd = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAkklEQVQoU8WSvRWAIAyEZRQtXIRCV3EiVtGCRSx0FHxBD5MYn1pJl0u+/PDOVcZLY5e47PrJ6TIhaOBSzBoU8AlCE0zP4FuIwwJc25Bz9TyILbVOUwuIJAjAlp5BrPkFpOYC9H6fF+O5LjW09AIS0Az7jUuQN1q6AC0z3Gk/gvTF3AhwiNYQ52Ju4pI4fKljOG0DA3tp97vN6C8AAAAASUVORK5CYII=&quot;<br />let pu1 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAWElEQVQoU62SUQoAIAhD9f6HNiYYolYi9VfzuXIxDRYbI0LCTHsfe3ldi3BgRRUY9Rnku1Rupf4NgiPeVjVU7STckphBceSvrHHtNPI21HWz4NO3eUUAgwVpmjX/zwK8KQAAAABJRU5ErkJggg==&quot;<br />let pu2 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAW0lEQVQoU8WSwQoAIAhD9f8/2lIwdKRIl7o1e010THBESJiJXca76qnoDxFC3SD9LRpWkLnsLt4gdImtlLX/EK4iDapqr4VuI2+BauQjaOrmSz8xillDp5gQrS054jv/0fkNVAAAAABJRU5ErkJggg==&quot;<br />let pd1 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAXElEQVQoU62SUQoAIAhD9f6HNgyMWpMs6k/XU5mqwDMTw5yq6JwbAfucwR2qAFHAu75BN11Gt6+Qz54VpMJsMV3BaS9UR8txkUzfLC9DUY0BYbOPGfpyU3g2WdwAOvU1/9KZsT4AAAAASUVORK5CYII=&quot;<br />let pd2 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAU0lEQVQoU62SUQoAIAhD9f6HNgwUGw4s6q/pc6KqwDMTQ01VtGr56ZIZvKEJEAXc9Q26cUm3r5D3zgrywHeoG3ldJrZIRz6C0I1BoR83FTBCeHsLIlw7/wOkQycAAAAASUVORK5CYII=&quot;<br />let pl1 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAVUlEQVQoU62S2woAIAhD9f8/2jAwvGRMyDfF49iQKZUISZ4xE/vZaW7LHbwhBLADqjpSUjBAdglRDQa9hxfcQi+vf5RGnpDlkB4KlMgR0N6pBIH83gIPFCb/N+MLCwAAAABJRU5ErkJggg==&quot;<br />let pl2 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAUklEQVQoU52SUQoAIAhD3f0PbRQoZgnT/hyttYeQdFRFswYIoubD73JlPibGYA/s1Jmpk+JpDIinWxbiXP3iQslCwbhTxzhHbsWZNFsnCkTevQW2bCb/VRTuVwAAAABJRU5ErkJggg==&quot;<br />let pr1 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAWElEQVQoU52S4Q4AIASE3fs/tKalSTHyL/O5CyAXzMQ+BxBsbj9exRE8oQqgDUS1BalNVFSuP2WQL94WIygCBEzttZWOvbz2VBnGtLXg1sgV/L8I679yewN9sScO5wcxLQAAAABJRU5ErkJggg==&quot;<br />let pr2 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAVElEQVQoU62SWwoAIAgE9f6HNgqU3BK2R3+J48KoCjwzMaypis61+OyaK3hADOADeuoddJISaQy0iKggbEz2viah7mVPTNq7cp/ApLmcdFPVdaDJBnWdJwjk629HAAAAAElFTkSuQmCC&quot;<br />let blue = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAeklEQVQoU62S0Q3AIAhEyyi6UcfoRB2jG+koNkeCoVcaTaw/huMeEkS24KTUmpdrFWHbQ2CAzb5AB0eQFTFYwVnIw/+B5by0cD52vTmGhnaF25wBAb/A6HsibR0ctch5fRHi1zCigvCut4oR+wnbhrBmsZr9DlqCQfbcnfZjDyiZqCEAAAAASUVORK5CYII=&quot;<br />let eyed = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAUElEQVQoU2NkIBMwkqmPYYA13rt37z/I6UpKSiguwSYOVwCThPkZphmXOHU0OjtD7Nu7F+FckI3YxFH8oqgI8eP9+6h+xCY+wNFBSiqiv1MBDgYsD185vj8AAAAASUVORK5CYII=&quot;<br />let _200 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAS0lEQVQoU2NkIBMwkqmPYYA0vpVR+Q9zsvCTO4yE+CC1KE4FaYBpxEfDNWKzgWiNIIUw5xKyGa+N+PyM4UdS4nSA4pEUJ8LUku1UAMC0VA8iscBNAAAAAElFTkSuQmCC&quot;<br />let _400 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAASElEQVQoU2NkIBMwkqmPYYA0vpVR+S/85A4jMg3zAkwcmQ9ig52KTSO6Qch8FI3oNhClEaaJWJvhNmLTSJQfyYnLAYpHujoVAChTXA9pVJi5AAAAAElFTkSuQmCC&quot;<br />let _800 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAQElEQVQoU2NkIBMwkqmPYYA0vpVR+Q9zsvCTO4yE+CC1YKeCFMI0EEOjaES3EZ8BtLERn5/hNpITlwMUj3R1KgCe5lwPHtUmcwAAAABJRU5ErkJggg==&quot;<br />let _1600 = &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAQ0lEQVQoU2NkIBMwkqmPYQA0vpVR+S/85A4jiIY5mxg+WANMIYiGaUYXR+ejaES3EdlAvBrxKSTJRnx+HoDoGDopBwDHLGwPAhDgRQAAAABJRU5ErkJggg==&quot;</div>
<div class="tip" id="fs21">val createImage : data:string -&gt; HTMLImageElement<br /><br />Full name: Pacman.createImage</div>
<div class="tip" id="fs22">val data : string</div>
<div class="tip" id="fs23">val img : HTMLImageElement</div>
<div class="tip" id="fs24">val document : Document<br /><br />Full name: Fable.Import.Browser.document</div>
<div class="tip" id="fs25">abstract member Document.createElement_img : unit -&gt; HTMLImageElement</div>
<div class="tip" id="fs26">property HTMLImageElement.src: string</div>
<div class="tip" id="fs27">val maze : string []<br /><br />Full name: Pacman.maze</div>
<div class="tip" id="fs28">(&quot;\<br />##/------------7/------------7##,\<br />##|............|!............|##,\<br />##|./__7./___7.|!./___7./__7.|##,\<br />##|o|  !.|   !.|!.|   !.|  !o|##,\<br />##|.L--J.L---J.LJ.L---J.L--J.|##,\<br />##|..........................|##,\<br />##|./__7./7./______7./7./__7.|##,\<br />##|.L--J.|!.L--7/--J.|!.L--J.|##,\<br />##|......|!....|!....|!......|##,\<br />##L____7.|L__7 |! /__J!./____J##,\<br />#######!.|/--J LJ L--7!.|#######,\<br />#######!.|!          |!.|#######,\<br />#######!.|! /__==__7 |!.|#######,\<br />-------J.LJ |      ! LJ.L-------,\<br />########.   | **** !   .########,\<br />_______7./7 |      ! /7./_______,\<br />#######!.|! L______J |!.|#######,\<br />#######!.|!          |!.|#######,\<br />#######!.|! /______7 |!.|#######,\<br />##/----J.LJ L--7/--J LJ.L----7##,\<br />##|............|!............|##,\<br />##|./__7./___7.|!./___7./__7.|##,\<br />##|.L-7!.L---J.LJ.L---J.|/-J.|##,\<br />##|o..|!.......&lt;&gt;.......|!..o|##,\<br />##L_7.|!./7./______7./7.|!./_J##,\<br />##/-J.LJ.|!.L--7/--J.|!.LJ.L-7##,\<br />##|......|!....|!....|!......|##,\<br />##|./____JL__7.|!./__JL____7.|##,\<br />##|.L--------J.LJ.L--------J.|##,\<br />##|..........................|##,\<br />##L--------------------------J##&quot;).Split(&#39;,&#39;)</div>
<div class="tip" id="fs29">val tileBits : int [] []<br /><br />Full name: Pacman.tileBits</div>
<div class="tip" id="fs30">// tl<br />&#160;&#160;&#160;&#160;[|0b00000000;0b00000000;0b00000000;0b00000000;0b11111111;0b00000000;0b00000000;0b00000000|] // top<br />&#160;&#160;&#160;&#160;[|0b00000000;0b00000000;0b00000000;0b00000000;0b11000000;0b00100000;0b00010000;0b00010000|] // tr<br />&#160;&#160;&#160;&#160;[|0b00001000;0b00001000;0b00001000;0b00001000;0b00001000;0b00001000;0b00001000;0b00001000|] // left<br />&#160;&#160;&#160;&#160;[|0b00010000;0b00010000;0b00010000;0b00010000;0b00010000;0b00010000;0b00010000;0b00010000|] // right<br />&#160;&#160;&#160;&#160;[|0b00001000;0b00001000;0b00000100;0b00000011;0b00000000;0b00000000;0b00000000;0b00000000|] // bl<br />&#160;&#160;&#160;&#160;[|0b00000000;0b00000000;0b00000000;0b11111111;0b00000000;0b00000000;0b00000000;0b00000000|] // bottom<br />&#160;&#160;&#160;&#160;[|0b00010000;0b00010000;0b00100000;0b11000000;0b00000000;0b00000000;0b00000000;0b00000000|] // br<br />&#160;&#160;&#160;&#160;[|0b00000000;0b00000000;0b00000000;0b00000000;0b11111111;0b00000000;0b00000000;0b00000000|] // door<br />&#160;&#160;&#160;&#160;[|0b00000000;0b00000000;0b00000000;0b00011000;0b00011000;0b00000000;0b00000000;0b00000000|] // pill<br />&#160;&#160;&#160;&#160;[|0b00000000;0b00011000;0b00111100;0b01111110;0b01111110;0b00111100;0b00011000;0b00000000|] // power</div>
<div class="tip" id="fs31">val blank : int []<br /><br />Full name: Pacman.blank</div>
<div class="tip" id="fs32">0b00000000;0b00000000;0b00000000;0b00000000;0b00000000</div>
<div class="tip" id="fs33">val isWall : c:char -&gt; bool<br /><br />Full name: Pacman.isWall<br /><em><br /><br />&#160;Characters _|!/7LJ represent different walls</em></div>
<div class="tip" id="fs34">val c : char</div>
<div class="tip" id="fs35">Multiple items<br />val char : value:&#39;T -&gt; char (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.char<br /><br />--------------------<br />type char = System.Char<br /><br />Full name: Microsoft.FSharp.Core.char</div>
<div class="tip" id="fs36">val tileAt : x:int * y:int -&gt; char<br /><br />Full name: Pacman.tileAt<br /><em><br /><br />&#160;Returns &#39; &#39; for positions outside of range</em></div>
<div class="tip" id="fs37">val x : int</div>
<div class="tip" id="fs38">val y : int</div>
<div class="tip" id="fs39">val isWallAt : x:int * y:int -&gt; bool<br /><br />Full name: Pacman.isWallAt<br /><em><br /><br />&#160;Is the maze tile at x,y a wall?</em></div>
<div class="tip" id="fs40">val verticallyAligned : x:int * y:&#39;a -&gt; bool<br /><br />Full name: Pacman.verticallyAligned</div>
<div class="tip" id="fs41">val y : &#39;a</div>
<div class="tip" id="fs42">val horizontallyAligned : x:&#39;a * y:int -&gt; bool<br /><br />Full name: Pacman.horizontallyAligned</div>
<div class="tip" id="fs43">val x : &#39;a</div>
<div class="tip" id="fs44">val isAligned : n:int -&gt; bool<br /><br />Full name: Pacman.isAligned</div>
<div class="tip" id="fs45">val n : int</div>
<div class="tip" id="fs46">val noWall : x:int * y:int -&gt; ex:int * ey:int -&gt; bool<br /><br />Full name: Pacman.noWall</div>
<div class="tip" id="fs47">val ex : int</div>
<div class="tip" id="fs48">val ey : int</div>
<div class="tip" id="fs49">val bx : int</div>
<div class="tip" id="fs50">val by : int</div>
<div class="tip" id="fs51">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs52">val canGoUp : x:int * y:int -&gt; bool<br /><br />Full name: Pacman.canGoUp</div>
<div class="tip" id="fs53">val canGoDown : x:int * y:int -&gt; bool<br /><br />Full name: Pacman.canGoDown</div>
<div class="tip" id="fs54">val canGoLeft : x:int * y:int -&gt; bool<br /><br />Full name: Pacman.canGoLeft</div>
<div class="tip" id="fs55">val canGoRight : x:int * y:int -&gt; bool<br /><br />Full name: Pacman.canGoRight</div>
<div class="tip" id="fs56">val tileColors : string<br /><br />Full name: Pacman.tileColors</div>
<div class="tip" id="fs57">val tileChars : string<br /><br />Full name: Pacman.tileChars</div>
<div class="tip" id="fs58">val toTile : c:char -&gt; int [] * char<br /><br />Full name: Pacman.toTile<br /><em><br /><br />&#160;Returns tile for a given Maze character</em></div>
<div class="tip" id="fs59">val i : int</div>
<div class="tip" id="fs60">System.String.IndexOf(value: string) : int<br />System.String.IndexOf(value: char) : int<br />System.String.IndexOf(value: string, comparisonType: System.StringComparison) : int<br />System.String.IndexOf(value: string, startIndex: int) : int<br />System.String.IndexOf(value: char, startIndex: int) : int<br />System.String.IndexOf(value: string, startIndex: int, comparisonType: System.StringComparison) : int<br />System.String.IndexOf(value: string, startIndex: int, count: int) : int<br />System.String.IndexOf(value: char, startIndex: int, count: int) : int<br />System.String.IndexOf(value: string, startIndex: int, count: int, comparisonType: System.StringComparison) : int</div>
<div class="tip" id="fs61">val draw : f:(int * int -&gt; unit) -&gt; lines:int [] -&gt; unit<br /><br />Full name: Pacman.draw<br /><em><br /><br />&#160;Draw the lines specified by a wall tile</em></div>
<div class="tip" id="fs62">val f : (int * int -&gt; unit)</div>
<div class="tip" id="fs63">val lines : int []</div>
<div class="tip" id="fs64">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs65">val width : int</div>
<div class="tip" id="fs66">module Array<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs67">val iteri : action:(int -&gt; &#39;T -&gt; unit) -&gt; array:&#39;T [] -&gt; unit<br /><br />Full name: Microsoft.FSharp.Collections.Array.iteri</div>
<div class="tip" id="fs68">val line : int</div>
<div class="tip" id="fs69">val bit : int</div>
<div class="tip" id="fs70">val pattern : int</div>
<div class="tip" id="fs71">val createBrush : context:CanvasRenderingContext2D -&gt; r:int * g:int * b:int * a:int -&gt; ImageData<br /><br />Full name: Pacman.createBrush<br /><em><br /><br />&#160;Creates a brush for rendering the given RGBA color</em></div>
<div class="tip" id="fs72">val context : CanvasRenderingContext2D</div>
<div class="tip" id="fs73">Multiple items<br />val CanvasRenderingContext2D : CanvasRenderingContext2DType<br /><br />Full name: Fable.Import.Browser.CanvasRenderingContext2D<br /><br />--------------------<br />type CanvasRenderingContext2D =<br />&#160;&#160;interface<br />&#160;&#160;&#160;&#160;abstract member arc : x:float * y:float * radius:float * startAngle:float * endAngle:float * ?anticlockwise:bool -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member arcTo : x1:float * y1:float * x2:float * y2:float * radius:float -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member beginPath : unit -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member bezierCurveTo : cp1x:float * cp1y:float * cp2x:float * cp2y:float * x:float * y:float -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member clearRect : x:float * y:float * w:float * h:float -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member clip : ?fillRule:string -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member closePath : unit -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member createImageData : imageDataOrSw:U2&lt;float,ImageData&gt; * ?sh:float -&gt; ImageData<br />&#160;&#160;&#160;&#160;abstract member createLinearGradient : x0:float * y0:float * x1:float * y1:float -&gt; CanvasGradient<br />&#160;&#160;&#160;&#160;abstract member createPattern : image:U3&lt;HTMLImageElement,HTMLCanvasElement,HTMLVideoElement&gt; * repetition:string -&gt; CanvasPattern<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: Fable.Import.Browser.CanvasRenderingContext2D</div>
<div class="tip" id="fs74">val r : int</div>
<div class="tip" id="fs75">val g : int</div>
<div class="tip" id="fs76">val b : int</div>
<div class="tip" id="fs77">val a : int</div>
<div class="tip" id="fs78">val id : ImageData</div>
<div class="tip" id="fs79">abstract member CanvasRenderingContext2D.createImageData : imageDataOrSw:U2&lt;float,ImageData&gt; * ?sh:float -&gt; ImageData</div>
<div class="tip" id="fs80">type U2&lt;&#39;a,&#39;b&gt; =<br />&#160;&#160;| Case1 of &#39;a<br />&#160;&#160;| Case2 of &#39;b<br /><br />Full name: Fable.Core.U2&lt;_,_&gt;</div>
<div class="tip" id="fs81">union case U2.Case1: &#39;a -&gt; U2&lt;&#39;a,&#39;b&gt;</div>
<div class="tip" id="fs82">val d : Fable.Import.JS.Uint8ClampedArray</div>
<div class="tip" id="fs83">property ImageData.data: Fable.Import.JS.Uint8ClampedArray</div>
<div class="tip" id="fs84">val createBackground : unit -&gt; HTMLCanvasElement<br /><br />Full name: Pacman.createBackground</div>
<div class="tip" id="fs85">val background : HTMLCanvasElement</div>
<div class="tip" id="fs86">abstract member Document.createElement_canvas : unit -&gt; HTMLCanvasElement</div>
<div class="tip" id="fs87">property HTMLCanvasElement.width: float</div>
<div class="tip" id="fs88">property HTMLCanvasElement.height: float</div>
<div class="tip" id="fs89">abstract member HTMLCanvasElement.getContext_2d : unit -&gt; CanvasRenderingContext2D</div>
<div class="tip" id="fs90">property CanvasRenderingContext2D.fillStyle: U3&lt;string,CanvasGradient,CanvasPattern&gt;</div>
<div class="tip" id="fs91">type U3&lt;&#39;a,&#39;b,&#39;c&gt; =<br />&#160;&#160;| Case1 of &#39;a<br />&#160;&#160;| Case2 of &#39;b<br />&#160;&#160;| Case3 of &#39;c<br /><br />Full name: Fable.Core.U3&lt;_,_,_&gt;</div>
<div class="tip" id="fs92">union case U3.Case1: &#39;a -&gt; U3&lt;&#39;a,&#39;b,&#39;c&gt;</div>
<div class="tip" id="fs93">abstract member CanvasRenderingContext2D.fillRect : x:float * y:float * w:float * h:float -&gt; unit</div>
<div class="tip" id="fs94">val blue : ImageData</div>
<div class="tip" id="fs95">val yellow : ImageData</div>
<div class="tip" id="fs96">val lines : string []</div>
<div class="tip" id="fs97">property System.Array.Length: int</div>
<div class="tip" id="fs98">val line : string</div>
<div class="tip" id="fs99">property System.String.Length: int</div>
<div class="tip" id="fs100">val tile : int []</div>
<div class="tip" id="fs101">val color : char</div>
<div class="tip" id="fs102">val brush : ImageData</div>
<div class="tip" id="fs103">val x&#39; : int</div>
<div class="tip" id="fs104">val y&#39; : int</div>
<div class="tip" id="fs105">abstract member CanvasRenderingContext2D.putImageData : imagedata:ImageData * dx:float * dy:float * ?dirtyX:float * ?dirtyY:float * ?dirtyWidth:float * ?dirtyHeight:float -&gt; unit</div>
<div class="tip" id="fs106">val clearCell : background:HTMLCanvasElement -&gt; x:int * y:int -&gt; unit<br /><br />Full name: Pacman.clearCell<br /><em><br /><br />&#160;Clear whatever is rendered in the specified Maze cell</em></div>
<div class="tip" id="fs107">Multiple items<br />val HTMLCanvasElement : HTMLCanvasElementType<br /><br />Full name: Fable.Import.Browser.HTMLCanvasElement<br /><br />--------------------<br />type HTMLCanvasElement =<br />&#160;&#160;interface<br />&#160;&#160;&#160;&#160;inherit HTMLElement<br />&#160;&#160;&#160;&#160;abstract member getContext : contextId:string * [&lt;ParamArray&gt;] args:obj [] -&gt; U2&lt;CanvasRenderingContext2D,WebGLRenderingContext&gt;<br />&#160;&#160;&#160;&#160;abstract member getContext_2d : unit -&gt; CanvasRenderingContext2D<br />&#160;&#160;&#160;&#160;abstract member ( getContext_experimental-webgl ) : unit -&gt; WebGLRenderingContext<br />&#160;&#160;&#160;&#160;abstract member height : float<br />&#160;&#160;&#160;&#160;abstract member width : float<br />&#160;&#160;&#160;&#160;abstract member msToBlob : unit -&gt; Blob<br />&#160;&#160;&#160;&#160;abstract member height : float with set<br />&#160;&#160;&#160;&#160;abstract member width : float with set<br />&#160;&#160;&#160;&#160;abstract member toBlob : unit -&gt; Blob<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: Fable.Import.Browser.HTMLCanvasElement</div>
<div class="tip" id="fs108">val wrap : x:int * y:int -&gt; dx:int * dy:int -&gt; int * int<br /><br />Full name: Pacman.wrap<br /><em><br /><br />&#160;Wrap around the sides of the Maze</em></div>
<div class="tip" id="fs109">val dx : int</div>
<div class="tip" id="fs110">val dy : int</div>
<div class="tip" id="fs111">Multiple items<br />type Ghost =<br />&#160;&#160;new : image:HTMLImageElement * x:int * y:int * v:(int * int) -&gt; Ghost<br />&#160;&#160;member Move : v:(int * int) -&gt; unit<br />&#160;&#160;member Reset : unit -&gt; unit<br />&#160;&#160;member Image : HTMLImageElement<br />&#160;&#160;member IsReturning : bool<br />&#160;&#160;member V : int * int<br />&#160;&#160;member X : int<br />&#160;&#160;member Y : int<br />&#160;&#160;member IsReturning : bool with set<br /><br />Full name: Pacman.Ghost<br /><em><br /><br />&#160;Mutable representation of a ghost</em><br /><br />--------------------<br />new : image:HTMLImageElement * x:int * y:int * v:(int * int) -&gt; Ghost</div>
<div class="tip" id="fs112">val image : HTMLImageElement</div>
<div class="tip" id="fs113">Multiple items<br />val HTMLImageElement : HTMLImageElementType<br /><br />Full name: Fable.Import.Browser.HTMLImageElement<br /><br />--------------------<br />type HTMLImageElement =<br />&#160;&#160;interface<br />&#160;&#160;&#160;&#160;inherit HTMLElement<br />&#160;&#160;&#160;&#160;abstract member align : string<br />&#160;&#160;&#160;&#160;abstract member alt : string<br />&#160;&#160;&#160;&#160;abstract member border : string<br />&#160;&#160;&#160;&#160;abstract member complete : bool<br />&#160;&#160;&#160;&#160;abstract member crossOrigin : string<br />&#160;&#160;&#160;&#160;abstract member currentSrc : string<br />&#160;&#160;&#160;&#160;abstract member height : float<br />&#160;&#160;&#160;&#160;abstract member hspace : float<br />&#160;&#160;&#160;&#160;abstract member isMap : bool<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: Fable.Import.Browser.HTMLImageElement</div>
<div class="tip" id="fs114">val v : int * int</div>
<div class="tip" id="fs115">val mutable x&#39; : int</div>
<div class="tip" id="fs116">val mutable y&#39; : int</div>
<div class="tip" id="fs117">val mutable v&#39; : int * int</div>
<div class="tip" id="fs118">val Image : ImageType<br /><br />Full name: Fable.Import.Browser.Image</div>
<div class="tip" id="fs119">val set : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.set</div>
<div class="tip" id="fs120">member Ghost.X : int<br /><br />Full name: Pacman.Ghost.X</div>
<div class="tip" id="fs121">val __ : Ghost</div>
<div class="tip" id="fs122">member Ghost.Y : int<br /><br />Full name: Pacman.Ghost.Y</div>
<div class="tip" id="fs123">member Ghost.V : int * int<br /><br />Full name: Pacman.Ghost.V</div>
<div class="tip" id="fs124">val ghost : Ghost</div>
<div class="tip" id="fs125">member Ghost.Reset : unit -&gt; unit<br /><br />Full name: Pacman.Ghost.Reset<br /><em><br /><br />&#160;Move back to initial location</em></div>
<div class="tip" id="fs126">member Ghost.Move : v:(int * int) -&gt; unit<br /><br />Full name: Pacman.Ghost.Move<br /><em><br /><br />&#160;Move in the current direction</em></div>
<div class="tip" id="fs127">val createGhosts : context:&#39;a -&gt; Ghost []<br /><br />Full name: Pacman.createGhosts</div>
<div class="tip" id="fs128">val context : &#39;a</div>
<div class="tip" id="fs129">val redd : string<br /><br />Full name: Pacman.redd</div>
<div class="tip" id="fs130">val pinkd : string<br /><br />Full name: Pacman.pinkd</div>
<div class="tip" id="fs131">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; array:&#39;T [] -&gt; &#39;U []<br /><br />Full name: Microsoft.FSharp.Collections.Array.map</div>
<div class="tip" id="fs132">val flood : canFill:(int * int -&gt; bool) -&gt; fill:(int * int * int -&gt; unit) -&gt; x:int * y:int -&gt; unit<br /><br />Full name: Pacman.flood<br /><em><br /><br />&#160;Recursive flood fill function</em></div>
<div class="tip" id="fs133">val canFill : (int * int -&gt; bool)</div>
<div class="tip" id="fs134">val fill : (int * int * int -&gt; unit)</div>
<div class="tip" id="fs135">val f : (int -&gt; (int * int) list -&gt; unit)</div>
<div class="tip" id="fs136">val ps : (int * int) list</div>
<div class="tip" id="fs137">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs138">val filter : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.filter</div>
<div class="tip" id="fs139">val iter : action:(&#39;T -&gt; unit) -&gt; list:&#39;T list -&gt; unit<br /><br />Full name: Microsoft.FSharp.Collections.List.iter</div>
<div class="tip" id="fs140">val collect : mapping:(&#39;T -&gt; &#39;U list) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.collect</div>
<div class="tip" id="fs141">val route_home : int [] []<br /><br />Full name: Pacman.route_home<br /><em><br /><br />&#160;Possible routes that take the ghost home</em></div>
<div class="tip" id="fs142">val numbers : int [] []</div>
<div class="tip" id="fs143">System.String.ToCharArray() : char []<br />System.String.ToCharArray(startIndex: int, length: int) : char []</div>
<div class="tip" id="fs144">val fillValue : x:int * y:int -&gt; ex:int * ey:int -&gt; int<br /><br />Full name: Pacman.fillValue<br /><em><br /><br />&#160;Find the shortest way home from specified location <br />&#160;(adjusted by offset in which ghosts start)</em></div>
<div class="tip" id="fs145">val floor : value:&#39;T -&gt; &#39;T (requires member Floor)<br /><br />Full name: Microsoft.FSharp.Core.Operators.floor</div>
<div class="tip" id="fs146">val fillUp : x:int * y:int -&gt; int<br /><br />Full name: Pacman.fillUp</div>
<div class="tip" id="fs147">val fillDown : x:int * y:int -&gt; int<br /><br />Full name: Pacman.fillDown</div>
<div class="tip" id="fs148">val fillLeft : x:int * y:int -&gt; int<br /><br />Full name: Pacman.fillLeft</div>
<div class="tip" id="fs149">val fillRight : x:int * y:int -&gt; int<br /><br />Full name: Pacman.fillRight</div>
<div class="tip" id="fs150">val chooseDirection : ghost:Ghost -&gt; int * int<br /><br />Full name: Pacman.chooseDirection</div>
<div class="tip" id="fs151">property Ghost.X: int</div>
<div class="tip" id="fs152">property Ghost.Y: int</div>
<div class="tip" id="fs153">property Ghost.V: int * int</div>
<div class="tip" id="fs154">val isBackwards : (int * int -&gt; bool)</div>
<div class="tip" id="fs155">val directions : ((int * int) * int) []</div>
<div class="tip" id="fs156">property Ghost.IsReturning: bool</div>
<div class="tip" id="fs157">val xs : ((int * int) * int) []</div>
<div class="tip" id="fs158">val sortBy : projection:(&#39;T -&gt; &#39;Key) -&gt; array:&#39;T [] -&gt; &#39;T [] (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Array.sortBy</div>
<div class="tip" id="fs159">val snd : tuple:(&#39;T1 * &#39;T2) -&gt; &#39;T2<br /><br />Full name: Microsoft.FSharp.Core.Operators.snd</div>
<div class="tip" id="fs160">val xs : (int * int) []</div>
<div class="tip" id="fs161">val fst : tuple:(&#39;T1 * &#39;T2) -&gt; &#39;T1<br /><br />Full name: Microsoft.FSharp.Core.Operators.fst</div>
<div class="tip" id="fs162">val filter : predicate:(&#39;T -&gt; bool) -&gt; array:&#39;T [] -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.filter</div>
<div class="tip" id="fs163">val i : float</div>
<div class="tip" id="fs164">val mutable keysPressed : Set&lt;int&gt;<br /><br />Full name: Pacman.Keyboard.keysPressed<br /><em><br /><br />&#160;Set of currently pressed keys</em></div>
<div class="tip" id="fs165">Multiple items<br />module Set<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Set&lt;&#39;T (requires comparison)&gt; =<br />&#160;&#160;interface IComparable<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;interface ICollection&lt;&#39;T&gt;<br />&#160;&#160;new : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt;<br />&#160;&#160;member Add : value:&#39;T -&gt; Set&lt;&#39;T&gt;<br />&#160;&#160;member Contains : value:&#39;T -&gt; bool<br />&#160;&#160;override Equals : obj -&gt; bool<br />&#160;&#160;member IsProperSubsetOf : otherSet:Set&lt;&#39;T&gt; -&gt; bool<br />&#160;&#160;member IsProperSupersetOf : otherSet:Set&lt;&#39;T&gt; -&gt; bool<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Collections.Set&lt;_&gt;<br /><br />--------------------<br />new : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt;</div>
<div class="tip" id="fs166">val empty&lt;&#39;T (requires comparison)&gt; : Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Set.empty</div>
<div class="tip" id="fs167">val reset : unit -&gt; unit<br /><br />Full name: Pacman.Keyboard.reset<br /><em><br /><br />&#160;Update the keys as requested</em></div>
<div class="tip" id="fs168">val isPressed : keyCode:int -&gt; bool<br /><br />Full name: Pacman.Keyboard.isPressed</div>
<div class="tip" id="fs169">val keyCode : int</div>
<div class="tip" id="fs170">val contains : element:&#39;T -&gt; set:Set&lt;&#39;T&gt; -&gt; bool (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Set.contains</div>
<div class="tip" id="fs171">val update : e:KeyboardEvent * pressed:bool -&gt; &#39;a (requires &#39;a : null)<br /><br />Full name: Pacman.Keyboard.update<br /><em><br /><br />&#160;Triggered when key is pressed/released</em></div>
<div class="tip" id="fs172">val e : KeyboardEvent</div>
<div class="tip" id="fs173">Multiple items<br />val KeyboardEvent : KeyboardEventType<br /><br />Full name: Fable.Import.Browser.KeyboardEvent<br /><br />--------------------<br />type KeyboardEvent =<br />&#160;&#160;interface<br />&#160;&#160;&#160;&#160;inherit UIEvent<br />&#160;&#160;&#160;&#160;abstract member getModifierState : keyArg:string -&gt; bool<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_JOYSTICK : float<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_LEFT : float<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_MOBILE : float<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_NUMPAD : float<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_RIGHT : float<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_STANDARD : float<br />&#160;&#160;&#160;&#160;abstract member altKey : bool<br />&#160;&#160;&#160;&#160;abstract member char : string<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: Fable.Import.Browser.KeyboardEvent</div>
<div class="tip" id="fs174">val pressed : bool</div>
<div class="tip" id="fs175">property KeyboardEvent.keyCode: float</div>
<div class="tip" id="fs176">val op : (int -&gt; Set&lt;int&gt; -&gt; Set&lt;int&gt;)</div>
<div class="tip" id="fs177">val add : value:&#39;T -&gt; set:Set&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Set.add</div>
<div class="tip" id="fs178">val remove : value:&#39;T -&gt; set:Set&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Set.remove</div>
<div class="tip" id="fs179">val init : unit -&gt; unit<br /><br />Full name: Pacman.Keyboard.init<br /><em><br /><br />&#160;Register DOM event handlers</em></div>
<div class="tip" id="fs180">val window : Window<br /><br />Full name: Fable.Import.Browser.window</div>
<div class="tip" id="fs181">abstract member Window.addEventListener_keydown : listener:System.Func&lt;KeyboardEvent,obj&gt; * ?useCapture:bool -&gt; unit</div>
<div class="tip" id="fs182">abstract member Window.addEventListener_keyup : listener:System.Func&lt;KeyboardEvent,obj&gt; * ?useCapture:bool -&gt; unit</div>
<div class="tip" id="fs183">val private pu1 : HTMLImageElement<br /><br />Full name: Pacman.Pacman.pu1</div>
<div class="tip" id="fs184">val pu2 : HTMLImageElement<br /><br />Full name: Pacman.Pacman.pu2</div>
<div class="tip" id="fs185">val pu1 : string<br /><br />Full name: Pacman.pu1</div>
<div class="tip" id="fs186">val private pd1 : HTMLImageElement<br /><br />Full name: Pacman.Pacman.pd1</div>
<div class="tip" id="fs187">val pd2 : HTMLImageElement<br /><br />Full name: Pacman.Pacman.pd2</div>
<div class="tip" id="fs188">val pd1 : string<br /><br />Full name: Pacman.pd1</div>
<div class="tip" id="fs189">val private pl1 : HTMLImageElement<br /><br />Full name: Pacman.Pacman.pl1</div>
<div class="tip" id="fs190">val pl2 : HTMLImageElement<br /><br />Full name: Pacman.Pacman.pl2</div>
<div class="tip" id="fs191">val pl1 : string<br /><br />Full name: Pacman.pl1</div>
<div class="tip" id="fs192">val private pr1 : HTMLImageElement<br /><br />Full name: Pacman.Pacman.pr1</div>
<div class="tip" id="fs193">val pr2 : HTMLImageElement<br /><br />Full name: Pacman.Pacman.pr2</div>
<div class="tip" id="fs194">val pr1 : string<br /><br />Full name: Pacman.pr1</div>
<div class="tip" id="fs195">val private lastp : HTMLImageElement ref<br /><br />Full name: Pacman.Pacman.lastp</div>
<div class="tip" id="fs196">Multiple items<br />val ref : value:&#39;T -&gt; &#39;T ref<br /><br />Full name: Microsoft.FSharp.Core.Operators.ref<br /><br />--------------------<br />type &#39;T ref = Ref&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.ref&lt;_&gt;</div>
<div class="tip" id="fs197">val imageAt : x:int ref * y:int ref * v:(int * int) ref -&gt; HTMLImageElement<br /><br />Full name: Pacman.Pacman.imageAt</div>
<div class="tip" id="fs198">val x : int ref</div>
<div class="tip" id="fs199">val y : int ref</div>
<div class="tip" id="fs200">val v : (int * int) ref</div>
<div class="tip" id="fs201">val p1 : HTMLImageElement</div>
<div class="tip" id="fs202">val p2 : HTMLImageElement</div>
<div class="tip" id="fs203">val p : HTMLImageElement</div>
<div class="tip" id="fs204">val sound : file:string -&gt; unit<br /><br />Full name: Pacman.sound<br /><em><br /><br />&#160;Uses Fable&#39;s Emit to call JavaScript directly</em></div>
<div class="tip" id="fs205">val file : string</div>
<div class="tip" id="fs206">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs207">type unit = Unit<br /><br />Full name: Microsoft.FSharp.Core.unit</div>
<div class="tip" id="fs208">val countDots : unit -&gt; int<br /><br />Full name: Pacman.countDots<br /><em><br /><br />&#160;Count number of dots in the maze</em></div>
<div class="tip" id="fs209">val sumBy : projection:(&#39;T -&gt; &#39;U) -&gt; array:&#39;T [] -&gt; &#39;U (requires member ( + ) and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.Array.sumBy</div>
<div class="tip" id="fs210">val playLevel : onLevelCompleted:(unit -&gt; unit) * onGameOver:(unit -&gt; unit) -&gt; unit<br /><br />Full name: pacman.playLevel</div>
<div class="tip" id="fs211">val onLevelCompleted : (unit -&gt; unit)</div>
<div class="tip" id="fs212">val onGameOver : (unit -&gt; unit)</div>
<div class="tip" id="fs213">val update : (unit -&gt; unit)</div>
<div class="tip" id="fs214">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
<div class="tip" id="fs215">val playLevel : onLevelCompleted:(unit -&gt; unit) * onGameOver:(unit -&gt; unit) -&gt; unit<br /><br />Full name: Pacman.playLevel</div>
<div class="tip" id="fs216">val canvas : HTMLCanvasElement</div>
<div class="tip" id="fs217">abstract member Document.getElementsByTagName_canvas : unit -&gt; NodeListOf&lt;HTMLCanvasElement&gt;</div>
<div class="tip" id="fs218">val bonusImages : HTMLImageElement []</div>
<div class="tip" id="fs219">val _200 : string<br /><br />Full name: Pacman._200</div>
<div class="tip" id="fs220">val _400 : string<br /><br />Full name: Pacman._400</div>
<div class="tip" id="fs221">val _800 : string<br /><br />Full name: Pacman._800</div>
<div class="tip" id="fs222">val _1600 : string<br /><br />Full name: Pacman._1600</div>
<div class="tip" id="fs223">val ghosts : Ghost []</div>
<div class="tip" id="fs224">val blue : HTMLImageElement</div>
<div class="tip" id="fs225">val eyed : HTMLImageElement</div>
<div class="tip" id="fs226">val blue : string<br /><br />Full name: Pacman.blue</div>
<div class="tip" id="fs227">val pills : char [] []</div>
<div class="tip" id="fs228">val dotsLeft : int ref</div>
<div class="tip" id="fs229">val score : int ref</div>
<div class="tip" id="fs230">val bonus : int ref</div>
<div class="tip" id="fs231">val bonuses : (int * (HTMLImageElement * int * int)) list ref</div>
<div class="tip" id="fs232">val energy : int ref</div>
<div class="tip" id="fs233">val flashCountdown : int ref</div>
<div class="tip" id="fs234">val powerCountdown : int ref</div>
<div class="tip" id="fs235">val moveGhosts : (unit -&gt; unit)</div>
<div class="tip" id="fs236">val iter : action:(&#39;T -&gt; unit) -&gt; array:&#39;T [] -&gt; unit<br /><br />Full name: Microsoft.FSharp.Collections.Array.iter</div>
<div class="tip" id="fs237">member Ghost.Move : v:(int * int) -&gt; unit<br /><em><br /><br />&#160;Move in the current direction</em></div>
<div class="tip" id="fs238">val movePacman : (unit -&gt; unit)</div>
<div class="tip" id="fs239">val inputs : (bool * (int * int)) []</div>
<div class="tip" id="fs240">module Keyboard<br /><br />from Pacman</div>
<div class="tip" id="fs241">val canGoForward : bool</div>
<div class="tip" id="fs242">val availableDirections : (int * int) []</div>
<div class="tip" id="fs243">val v&#39; : int * int</div>
<div class="tip" id="fs244">val eatPills : (unit -&gt; unit)</div>
<div class="tip" id="fs245">val tx : int</div>
<div class="tip" id="fs246">val ty : int</div>
<div class="tip" id="fs247">val touchingGhosts : (unit -&gt; Ghost [])<br /><em><br /><br />&#160;Are there any ghosts that collide with Pacman?</em></div>
<div class="tip" id="fs248">val px : int</div>
<div class="tip" id="fs249">val py : int</div>
<div class="tip" id="fs250">val collisionDetection : (unit -&gt; unit)<br /><em><br /><br />&#160;Handle collision detections between Pacman and ghosts</em></div>
<div class="tip" id="fs251">val touched : Ghost []</div>
<div class="tip" id="fs252">val added : int</div>
<div class="tip" id="fs253">val updateBonus : (unit -&gt; unit)<br /><em><br /><br />&#160;Updates bonus points </em></div>
<div class="tip" id="fs254">val removals : (int * (HTMLImageElement * int * int)) list</div>
<div class="tip" id="fs255">val remainders : (int * (HTMLImageElement * int * int)) list</div>
<div class="tip" id="fs256">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs257">val count : int</div>
<div class="tip" id="fs258">val x : HTMLImageElement * int * int</div>
<div class="tip" id="fs259">val partition : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; &#39;T list * &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.partition</div>
<div class="tip" id="fs260">val logic : (unit -&gt; unit)</div>
<div class="tip" id="fs261">val renderPacman : (unit -&gt; unit)</div>
<div class="tip" id="fs262">module Pacman<br /><br />from Pacman</div>
<div class="tip" id="fs263">abstract member CanvasRenderingContext2D.drawImage : image:U3&lt;HTMLImageElement,HTMLCanvasElement,HTMLVideoElement&gt; * offsetX:float * offsetY:float * ?width:float * ?height:float * ?canvasOffsetX:float * ?canvasOffsetY:float * ?canvasImageWidth:float * ?canvasImageHeight:float -&gt; unit</div>
<div class="tip" id="fs264">val renderEnergy : (unit -&gt; unit)</div>
<div class="tip" id="fs265">val renderGhosts : (unit -&gt; unit)</div>
<div class="tip" id="fs266">property Ghost.Image: HTMLImageElement</div>
<div class="tip" id="fs267">val renderScore : (unit -&gt; unit)</div>
<div class="tip" id="fs268">property CanvasRenderingContext2D.font: string</div>
<div class="tip" id="fs269">abstract member CanvasRenderingContext2D.fillText : text:string * x:float * y:float * ?maxWidth:float -&gt; unit</div>
<div class="tip" id="fs270">val renderBonus : (unit -&gt; unit)</div>
<div class="tip" id="fs271">val render : (unit -&gt; unit)</div>
<div class="tip" id="fs272">union case U3.Case2: &#39;b -&gt; U3&lt;&#39;a,&#39;b,&#39;c&gt;</div>
<div class="tip" id="fs273">abstract member WindowTimers.setTimeout : handler:obj * ?timeout:obj * [&lt;System.ParamArray&gt;] args:obj [] -&gt; float</div>
<div class="tip" id="fs274">val game : unit -&gt; unit<br /><br />Full name: Pacman.game</div>
<div class="tip" id="fs275">val drawText : (string * float * float -&gt; unit)</div>
<div class="tip" id="fs276">val text : string</div>
<div class="tip" id="fs277">val x : float</div>
<div class="tip" id="fs278">val y : float</div>
<div class="tip" id="fs279">val levelCompleted : (unit -&gt; unit)</div>
<div class="tip" id="fs280">val gameOver : (unit -&gt; unit)</div>
<div class="tip" id="fs281">val start : (unit -&gt; unit)</div>
<div class="tip" id="fs282">property HTMLElement.onclick: System.Func&lt;MouseEvent,obj&gt;</div>
<div class="tip" id="fs283">val e : MouseEvent</div>
<div class="tip" id="fs284">val box : value:&#39;T -&gt; obj<br /><br />Full name: Microsoft.FSharp.Core.Operators.box</div>

    </div>
    <div class="col-md-1 col-lg-2"></div>
  </div>
</div>

  </div>

  <a class="gh-forkme" href="https://github.com/fsprojects/Fable"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
</body>
</html>
