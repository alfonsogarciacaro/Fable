<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Alfonso Garcia-Caro">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <link href='https://fonts.googleapis.com/css?family=Josefin+Sans:400,300,600,700|Fira+Mono' rel='stylesheet' type='text/css'>
    <link href="//tpetricek.github.io/Fable/content/custom.css" rel='stylesheet' type='text/css'>
    <script src="//tpetricek.github.io/Fable/content/tips.js"></script>
    <link rel="stylesheet" type="text/css" href="//tpetricek.github.io/Fable/content/snippets.css" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <script language="javascript" type="text/javascript">
      function init() {
          try {
            websocket = new WebSocket("ws://"+window.location.host+"/websocket");
            websocket.onmessage = function(evt) { location.reload(); };
          } catch(e) { /* For local development only */ }
      }
      window.addEventListener("load", init, false);
    </script>
    
  <title>Ozmo game - F# |> BABEL</title>
  <script src="../scripts/core.min.js"></script>
  <script src="../scripts/require.js"></script>
  <meta name="description" content="Phil Trelford's classic ported to Fable">

</head>
<body>

  <div class="fb-navbar">
  <div class="container">
  <nav class="navbar navbar-default">
    <div class="navbar-wrapper">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="//tpetricek.github.io/Fable">Fable</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class=""><a href="//tpetricek.github.io/Fable">home</a></li>
          <li class="active"><a href="//tpetricek.github.io/Fable/samples.html">samples</a></li>
          <li class=""><a href="//tpetricek.github.io/Fable/docs.html">docs</a></li>
          <li><a href="https://github.com/fsprojects/Fable">source</a></li>
        </ul>
      </div>
    </div>
  </nav>
  </div>
  </div>

  <div class="fb-content-wrapper">
  
<div class="fb-heading">
<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <h1>Ozmo game</h1>
      <p>Phil Trelford's classic ported to Fable</p>
    </div>
  </div>
</div>
</div>

<div class="container fb-content">
  <div class="row">
    <div class="col-md-1 col-lg-2"></div>
    <div class="col-sm-12 col-md-10 col-lg-8">
      <p>Phil Trelford's <a href="https://twitter.com/ptrelford/status/475395178208174080">classic Ozmo game</a>, originally hosted
<a href="https://bitbucket.org/ptrelford/ozmo">on BitBucket</a> ported to Fable! Shows how to handle keyboard events and
use HTML5 canvas. You can also get it (as a JavaScript app) from <a href="https://www.microsoft.com/en-gb/store/apps/ozmo/9nblggh4rjng">the Windows
Store</a>. View the <a href="https://github.com/fsprojects/Fable/blob/master/samples/browser/ozmo/ozmo.fsx">raw source code on
GitHub</a>.
To play the game, use left and right keys!</p>
    </div>
    <div class="col-md-1 col-lg-2"></div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <div style="height:668px; width:900px; margin:20px auto 20px auto;">
        
  <canvas align="center" id="canvas" width="900" height="668"></canvas>
  
      </div>
      <script>
        requirejs.config({
          baseUrl: '.',
          paths: { 'fable-core': '../scripts/fable-core.min' }
        });
        requirejs(["ozmo"]);
      </script>
    </div>
  </div>

  <div class="row">
    <div class="col-md-1 col-lg-2"></div>
    <div class="col-sm-12 col-md-10 col-lg-8">
      <p>This demo shows a simple game written using Fable and HTML5 canvas. One interesting
aspect of the game is the <a href="#Asynchronous-game-loop">asynchronous game loop</a>, which
updates the game state 60 times per second in a loop. This is implemented using F#
asynchronous workflows, which make it possible to capture the logic as a recursive
function, rather than using mutable state.</p>
<p>The Ozmo game uses the <a href="../mario/index.html#Keyboard-helpers">Keyboard helpers from the Mario sample</a>,
so if you want to see those, check out the Mario sample first - it is also simpler,
so you can check it out for lighter introduction to Fable and F#.</p>
<h2><a name="Drawing-the-world" class="anchor" href="#Drawing-the-world">Drawing the world</a></h2>
<p>The first few functions in the game deal with rendering. The world consists of two
gradients (with yellow orange gradient in the sky and gray gradient for the atmosphere)
and a filled black rectangle. The <code>drawGrd</code> function draws a gradient and <code>drawBg</code>
renders the world. We also need <code>drawText</code> for printing text when the game finishes:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Draw gradient between two Y offsets and two colours</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs42', 70)" onmouseover="showTip(event, 'fs42', 70)" class="f">drawGrd</span> (<span onmouseout="hideTip(event, 'fs43', 71)" onmouseover="showTip(event, 'fs43', 71)" class="i">ctx</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs44', 72)" onmouseover="showTip(event, 'fs44', 72)" class="t">CanvasRenderingContext2D</span>)
    (<span onmouseout="hideTip(event, 'fs45', 73)" onmouseover="showTip(event, 'fs45', 73)" class="i">canvas</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs46', 74)" onmouseover="showTip(event, 'fs46', 74)" class="t">HTMLCanvasElement</span>) (<span onmouseout="hideTip(event, 'fs47', 75)" onmouseover="showTip(event, 'fs47', 75)" class="i">y0</span>,<span onmouseout="hideTip(event, 'fs48', 76)" onmouseover="showTip(event, 'fs48', 76)" class="i">y1</span>) (<span onmouseout="hideTip(event, 'fs49', 77)" onmouseover="showTip(event, 'fs49', 77)" class="i">c0</span>,<span onmouseout="hideTip(event, 'fs50', 78)" onmouseover="showTip(event, 'fs50', 78)" class="i">c1</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs51', 79)" onmouseover="showTip(event, 'fs51', 79)" class="i">grd</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs43', 80)" onmouseover="showTip(event, 'fs43', 80)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs52', 81)" onmouseover="showTip(event, 'fs52', 81)" class="f">createLinearGradient</span>(<span class="n">0.</span>,<span onmouseout="hideTip(event, 'fs47', 82)" onmouseover="showTip(event, 'fs47', 82)" class="i">y0</span>,<span class="n">0.</span>,<span onmouseout="hideTip(event, 'fs48', 83)" onmouseover="showTip(event, 'fs48', 83)" class="i">y1</span>)
  <span onmouseout="hideTip(event, 'fs51', 84)" onmouseover="showTip(event, 'fs51', 84)" class="i">grd</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs53', 85)" onmouseover="showTip(event, 'fs53', 85)" class="f">addColorStop</span>(<span class="n">0.</span>,<span onmouseout="hideTip(event, 'fs49', 86)" onmouseover="showTip(event, 'fs49', 86)" class="i">c0</span>)
  <span onmouseout="hideTip(event, 'fs51', 87)" onmouseover="showTip(event, 'fs51', 87)" class="i">grd</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs53', 88)" onmouseover="showTip(event, 'fs53', 88)" class="f">addColorStop</span>(<span class="n">1.</span>,<span onmouseout="hideTip(event, 'fs50', 89)" onmouseover="showTip(event, 'fs50', 89)" class="i">c1</span>)
  <span onmouseout="hideTip(event, 'fs43', 90)" onmouseover="showTip(event, 'fs43', 90)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 91)" onmouseover="showTip(event, 'fs54', 91)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs55', 92)" onmouseover="showTip(event, 'fs55', 92)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs56', 93)" onmouseover="showTip(event, 'fs56', 93)" class="p">Case2</span> <span onmouseout="hideTip(event, 'fs51', 94)" onmouseover="showTip(event, 'fs51', 94)" class="i">grd</span>
  <span onmouseout="hideTip(event, 'fs43', 95)" onmouseover="showTip(event, 'fs43', 95)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs57', 96)" onmouseover="showTip(event, 'fs57', 96)" class="f">fillRect</span>(<span class="n">0.</span>,<span onmouseout="hideTip(event, 'fs47', 97)" onmouseover="showTip(event, 'fs47', 97)" class="i">y0</span>, <span onmouseout="hideTip(event, 'fs45', 98)" onmouseover="showTip(event, 'fs45', 98)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 99)" onmouseover="showTip(event, 'fs40', 99)" class="i">width</span>, <span onmouseout="hideTip(event, 'fs48', 100)" onmouseover="showTip(event, 'fs48', 100)" class="i">y1</span><span class="o">-</span> <span onmouseout="hideTip(event, 'fs47', 101)" onmouseover="showTip(event, 'fs47', 101)" class="i">y0</span>)

<span class="c">/// Draw background of the Ozmo game</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs58', 102)" onmouseover="showTip(event, 'fs58', 102)" class="f">drawBg</span> <span onmouseout="hideTip(event, 'fs43', 103)" onmouseover="showTip(event, 'fs43', 103)" class="i">ctx</span> <span onmouseout="hideTip(event, 'fs45', 104)" onmouseover="showTip(event, 'fs45', 104)" class="i">canvas</span> <span class="o">=</span>
  <span onmouseout="hideTip(event, 'fs42', 105)" onmouseover="showTip(event, 'fs42', 105)" class="f">drawGrd</span> <span onmouseout="hideTip(event, 'fs43', 106)" onmouseover="showTip(event, 'fs43', 106)" class="i">ctx</span> <span onmouseout="hideTip(event, 'fs45', 107)" onmouseover="showTip(event, 'fs45', 107)" class="i">canvas</span>
    (<span class="n">0.</span>,<span onmouseout="hideTip(event, 'fs33', 108)" onmouseover="showTip(event, 'fs33', 108)" class="i">atmosHeight</span>) (<span class="s">&quot;yellow&quot;</span>,<span class="s">&quot;orange&quot;</span>)
  <span onmouseout="hideTip(event, 'fs42', 109)" onmouseover="showTip(event, 'fs42', 109)" class="f">drawGrd</span> <span onmouseout="hideTip(event, 'fs43', 110)" onmouseover="showTip(event, 'fs43', 110)" class="i">ctx</span> <span onmouseout="hideTip(event, 'fs45', 111)" onmouseover="showTip(event, 'fs45', 111)" class="i">canvas</span>
    (<span onmouseout="hideTip(event, 'fs33', 112)" onmouseover="showTip(event, 'fs33', 112)" class="i">atmosHeight</span>, <span onmouseout="hideTip(event, 'fs45', 113)" onmouseover="showTip(event, 'fs45', 113)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 114)" onmouseover="showTip(event, 'fs41', 114)" class="i">height</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs32', 115)" onmouseover="showTip(event, 'fs32', 115)" class="i">floorHeight</span>)
    (<span class="s">&quot;grey&quot;</span>,<span class="s">&quot;white&quot;</span>)
  <span onmouseout="hideTip(event, 'fs43', 116)" onmouseover="showTip(event, 'fs43', 116)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 117)" onmouseover="showTip(event, 'fs54', 117)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs55', 118)" onmouseover="showTip(event, 'fs55', 118)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 119)" onmouseover="showTip(event, 'fs59', 119)" class="p">Case1</span> <span class="s">&quot;black&quot;</span>
  <span onmouseout="hideTip(event, 'fs43', 120)" onmouseover="showTip(event, 'fs43', 120)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs57', 121)" onmouseover="showTip(event, 'fs57', 121)" class="f">fillRect</span>
    ( <span class="n">0.</span>,<span onmouseout="hideTip(event, 'fs45', 122)" onmouseover="showTip(event, 'fs45', 122)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 123)" onmouseover="showTip(event, 'fs41', 123)" class="i">height</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs32', 124)" onmouseover="showTip(event, 'fs32', 124)" class="i">floorHeight</span>,
      <span onmouseout="hideTip(event, 'fs45', 125)" onmouseover="showTip(event, 'fs45', 125)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 126)" onmouseover="showTip(event, 'fs40', 126)" class="i">width</span>,<span onmouseout="hideTip(event, 'fs32', 127)" onmouseover="showTip(event, 'fs32', 127)" class="i">floorHeight</span> )

<span class="c">/// Draw the specified text (when game finishes)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs60', 128)" onmouseover="showTip(event, 'fs60', 128)" class="f">drawText</span>(<span onmouseout="hideTip(event, 'fs61', 129)" onmouseover="showTip(event, 'fs61', 129)" class="i">text</span>,<span onmouseout="hideTip(event, 'fs62', 130)" onmouseover="showTip(event, 'fs62', 130)" class="i">x</span>,<span onmouseout="hideTip(event, 'fs63', 131)" onmouseover="showTip(event, 'fs63', 131)" class="i">y</span>) <span class="o">=</span>
  <span onmouseout="hideTip(event, 'fs38', 132)" onmouseover="showTip(event, 'fs38', 132)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 133)" onmouseover="showTip(event, 'fs54', 133)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs55', 134)" onmouseover="showTip(event, 'fs55', 134)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 135)" onmouseover="showTip(event, 'fs59', 135)" class="p">Case1</span> <span class="s">&quot;white&quot;</span>
  <span onmouseout="hideTip(event, 'fs38', 136)" onmouseover="showTip(event, 'fs38', 136)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs64', 137)" onmouseover="showTip(event, 'fs64', 137)" class="i">font</span> <span class="o">&lt;-</span> <span class="s">&quot;bold 40pt&quot;</span>;
  <span onmouseout="hideTip(event, 'fs38', 138)" onmouseover="showTip(event, 'fs38', 138)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs65', 139)" onmouseover="showTip(event, 'fs65', 139)" class="f">fillText</span>(<span onmouseout="hideTip(event, 'fs61', 140)" onmouseover="showTip(event, 'fs61', 140)" class="i">text</span>, <span onmouseout="hideTip(event, 'fs62', 141)" onmouseover="showTip(event, 'fs62', 141)" class="i">x</span>, <span onmouseout="hideTip(event, 'fs63', 142)" onmouseover="showTip(event, 'fs63', 142)" class="i">y</span>)
</code></pre></td>
</tr>
</table>
<h2><a name="Representing-and-drawing-blobs" class="anchor" href="#Representing-and-drawing-blobs">Representing and drawing blobs</a></h2>
<p>Each of the balls in the game is represented by a <code>Blob</code> value that stores
the X and Y coordinates, size of the blob (radius), its colour and current speed.
The type is used for both falling blobs and for the player's blob:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs66', 143)" onmouseover="showTip(event, 'fs66', 143)" class="t">Blob</span> <span class="o">=</span>
  { <span onmouseout="hideTip(event, 'fs67', 144)" onmouseover="showTip(event, 'fs67', 144)" class="i">X</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 145)" onmouseover="showTip(event, 'fs7', 145)" class="t">float</span>; <span onmouseout="hideTip(event, 'fs68', 146)" onmouseover="showTip(event, 'fs68', 146)" class="i">Y</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 147)" onmouseover="showTip(event, 'fs7', 147)" class="t">float</span>;
    <span onmouseout="hideTip(event, 'fs69', 148)" onmouseover="showTip(event, 'fs69', 148)" class="i">vx</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 149)" onmouseover="showTip(event, 'fs7', 149)" class="t">float</span>; <span onmouseout="hideTip(event, 'fs70', 150)" onmouseover="showTip(event, 'fs70', 150)" class="i">vy</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 151)" onmouseover="showTip(event, 'fs7', 151)" class="t">float</span>;
    <span onmouseout="hideTip(event, 'fs71', 152)" onmouseover="showTip(event, 'fs71', 152)" class="i">Radius</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs7', 153)" onmouseover="showTip(event, 'fs7', 153)" class="t">float</span>; <span onmouseout="hideTip(event, 'fs72', 154)" onmouseover="showTip(event, 'fs72', 154)" class="i">color</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs73', 155)" onmouseover="showTip(event, 'fs73', 155)" class="t">string</span> }
</code></pre></td>
</tr>
</table>
<p>Drawing blob on the canvas is quite easy - the following function does that using
the <code>arc</code> function of the 2D rendering context of the canvas:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs74', 156)" onmouseover="showTip(event, 'fs74', 156)" class="f">drawBlob</span> (<span onmouseout="hideTip(event, 'fs43', 157)" onmouseover="showTip(event, 'fs43', 157)" class="i">ctx</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs44', 158)" onmouseover="showTip(event, 'fs44', 158)" class="t">CanvasRenderingContext2D</span>)
    (<span onmouseout="hideTip(event, 'fs45', 159)" onmouseover="showTip(event, 'fs45', 159)" class="i">canvas</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs46', 160)" onmouseover="showTip(event, 'fs46', 160)" class="t">HTMLCanvasElement</span>) (<span onmouseout="hideTip(event, 'fs75', 161)" onmouseover="showTip(event, 'fs75', 161)" class="i">blob</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs66', 162)" onmouseover="showTip(event, 'fs66', 162)" class="t">Blob</span>) <span class="o">=</span>
  <span onmouseout="hideTip(event, 'fs43', 163)" onmouseover="showTip(event, 'fs43', 163)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs76', 164)" onmouseover="showTip(event, 'fs76', 164)" class="f">beginPath</span>()
  <span onmouseout="hideTip(event, 'fs43', 165)" onmouseover="showTip(event, 'fs43', 165)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 166)" onmouseover="showTip(event, 'fs77', 166)" class="f">arc</span>
    ( <span onmouseout="hideTip(event, 'fs75', 167)" onmouseover="showTip(event, 'fs75', 167)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 168)" onmouseover="showTip(event, 'fs67', 168)" class="i">X</span>, <span onmouseout="hideTip(event, 'fs45', 169)" onmouseover="showTip(event, 'fs45', 169)" class="i">canvas</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 170)" onmouseover="showTip(event, 'fs41', 170)" class="i">height</span> <span class="o">-</span> (<span onmouseout="hideTip(event, 'fs75', 171)" onmouseover="showTip(event, 'fs75', 171)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 172)" onmouseover="showTip(event, 'fs68', 172)" class="i">Y</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs32', 173)" onmouseover="showTip(event, 'fs32', 173)" class="i">floorHeight</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs75', 174)" onmouseover="showTip(event, 'fs75', 174)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 175)" onmouseover="showTip(event, 'fs71', 175)" class="i">Radius</span>),
      <span onmouseout="hideTip(event, 'fs75', 176)" onmouseover="showTip(event, 'fs75', 176)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 177)" onmouseover="showTip(event, 'fs71', 177)" class="i">Radius</span>, <span class="n">0.</span>, <span class="n">2.</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs78', 178)" onmouseover="showTip(event, 'fs78', 178)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs79', 179)" onmouseover="showTip(event, 'fs79', 179)" class="t">Math</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs80', 180)" onmouseover="showTip(event, 'fs80', 180)" class="i">PI</span>, <span class="k">false</span> )
  <span onmouseout="hideTip(event, 'fs43', 181)" onmouseover="showTip(event, 'fs43', 181)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 182)" onmouseover="showTip(event, 'fs54', 182)" class="i">fillStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs55', 183)" onmouseover="showTip(event, 'fs55', 183)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 184)" onmouseover="showTip(event, 'fs59', 184)" class="p">Case1</span> <span onmouseout="hideTip(event, 'fs75', 185)" onmouseover="showTip(event, 'fs75', 185)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs72', 186)" onmouseover="showTip(event, 'fs72', 186)" class="i">color</span>
  <span onmouseout="hideTip(event, 'fs43', 187)" onmouseover="showTip(event, 'fs43', 187)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs81', 188)" onmouseover="showTip(event, 'fs81', 188)" class="f">fill</span>()
  <span onmouseout="hideTip(event, 'fs43', 189)" onmouseover="showTip(event, 'fs43', 189)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs82', 190)" onmouseover="showTip(event, 'fs82', 190)" class="i">lineWidth</span> <span class="o">&lt;-</span> <span class="n">3.</span>
  <span onmouseout="hideTip(event, 'fs43', 191)" onmouseover="showTip(event, 'fs43', 191)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs83', 192)" onmouseover="showTip(event, 'fs83', 192)" class="i">strokeStyle</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs55', 193)" onmouseover="showTip(event, 'fs55', 193)" class="t">U3</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 194)" onmouseover="showTip(event, 'fs59', 194)" class="p">Case1</span> <span onmouseout="hideTip(event, 'fs75', 195)" onmouseover="showTip(event, 'fs75', 195)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs72', 196)" onmouseover="showTip(event, 'fs72', 196)" class="i">color</span>
  <span onmouseout="hideTip(event, 'fs43', 197)" onmouseover="showTip(event, 'fs43', 197)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs84', 198)" onmouseover="showTip(event, 'fs84', 198)" class="f">stroke</span>()
</code></pre></td>
</tr>
</table>
<h2><a name="Falling-blobs-and-collisions" class="anchor" href="#Falling-blobs-and-collisions">Falling blobs and collisions</a></h2>
<p>The next step is to define the physics for the game. This consists of several
functions that update the <code>Blob</code> objects and are composed to apply all rules of
physics in the main game loop.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Apply key effects on Player&#39;s blob - changes X speed</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 199)" onmouseover="showTip(event, 'fs85', 199)" class="f">direct</span> (<span onmouseout="hideTip(event, 'fs86', 200)" onmouseover="showTip(event, 'fs86', 200)" class="i">dx</span>,<span onmouseout="hideTip(event, 'fs87', 201)" onmouseover="showTip(event, 'fs87', 201)" class="i">dy</span>) (<span onmouseout="hideTip(event, 'fs75', 202)" onmouseover="showTip(event, 'fs75', 202)" class="i">blob</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs66', 203)" onmouseover="showTip(event, 'fs66', 203)" class="t">Blob</span>) <span class="o">=</span>
  { <span onmouseout="hideTip(event, 'fs75', 204)" onmouseover="showTip(event, 'fs75', 204)" class="i">blob</span> <span class="k">with</span> <span class="i">vx</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs75', 205)" onmouseover="showTip(event, 'fs75', 205)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs69', 206)" onmouseover="showTip(event, 'fs69', 206)" class="i">vx</span> <span class="o">+</span> (<span onmouseout="hideTip(event, 'fs7', 207)" onmouseover="showTip(event, 'fs7', 207)" class="f">float</span> <span onmouseout="hideTip(event, 'fs86', 208)" onmouseover="showTip(event, 'fs86', 208)" class="i">dx</span>)<span class="o">/</span><span class="n">4.0</span> }

<span class="c">/// Apply gravity on falling blobs - gets faster every step</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs88', 209)" onmouseover="showTip(event, 'fs88', 209)" class="f">gravity</span> (<span onmouseout="hideTip(event, 'fs75', 210)" onmouseover="showTip(event, 'fs75', 210)" class="i">blob</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs66', 211)" onmouseover="showTip(event, 'fs66', 211)" class="t">Blob</span>) <span class="o">=</span>
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs75', 212)" onmouseover="showTip(event, 'fs75', 212)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 213)" onmouseover="showTip(event, 'fs68', 213)" class="i">Y</span> <span class="o">&gt;</span> <span class="n">0.</span> <span class="k">then</span> { <span onmouseout="hideTip(event, 'fs75', 214)" onmouseover="showTip(event, 'fs75', 214)" class="i">blob</span> <span class="k">with</span> <span class="i">vy</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs75', 215)" onmouseover="showTip(event, 'fs75', 215)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs70', 216)" onmouseover="showTip(event, 'fs70', 216)" class="i">vy</span> <span class="o">-</span> <span class="n">0.1</span> }
  <span class="k">else</span> <span onmouseout="hideTip(event, 'fs75', 217)" onmouseover="showTip(event, 'fs75', 217)" class="i">blob</span>

<span class="c">/// Bounde Player&#39;s blob off the wall if it hits it</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs89', 218)" onmouseover="showTip(event, 'fs89', 218)" class="f">bounce</span> (<span onmouseout="hideTip(event, 'fs75', 219)" onmouseover="showTip(event, 'fs75', 219)" class="i">blob</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs66', 220)" onmouseover="showTip(event, 'fs66', 220)" class="t">Blob</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs90', 221)" onmouseover="showTip(event, 'fs90', 221)" class="i">n</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs30', 222)" onmouseover="showTip(event, 'fs30', 222)" class="i">width</span>
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs75', 223)" onmouseover="showTip(event, 'fs75', 223)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 224)" onmouseover="showTip(event, 'fs67', 224)" class="i">X</span> <span class="o">&lt;</span> <span class="n">0.</span> <span class="k">then</span>
    { <span onmouseout="hideTip(event, 'fs75', 225)" onmouseover="showTip(event, 'fs75', 225)" class="i">blob</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs67', 226)" onmouseover="showTip(event, 'fs67', 226)" class="i">X</span> <span class="o">=</span> <span class="o">-</span><span onmouseout="hideTip(event, 'fs75', 227)" onmouseover="showTip(event, 'fs75', 227)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 228)" onmouseover="showTip(event, 'fs67', 228)" class="i">X</span>; <span class="i">vx</span> <span class="o">=</span> <span class="o">-</span><span onmouseout="hideTip(event, 'fs75', 229)" onmouseover="showTip(event, 'fs75', 229)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs69', 230)" onmouseover="showTip(event, 'fs69', 230)" class="i">vx</span> }
  <span class="k">elif</span> (<span onmouseout="hideTip(event, 'fs75', 231)" onmouseover="showTip(event, 'fs75', 231)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 232)" onmouseover="showTip(event, 'fs67', 232)" class="i">X</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs90', 233)" onmouseover="showTip(event, 'fs90', 233)" class="i">n</span>) <span class="k">then</span>
    { <span onmouseout="hideTip(event, 'fs75', 234)" onmouseover="showTip(event, 'fs75', 234)" class="i">blob</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs67', 235)" onmouseover="showTip(event, 'fs67', 235)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs90', 236)" onmouseover="showTip(event, 'fs90', 236)" class="i">n</span> <span class="o">-</span> (<span onmouseout="hideTip(event, 'fs75', 237)" onmouseover="showTip(event, 'fs75', 237)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 238)" onmouseover="showTip(event, 'fs67', 238)" class="i">X</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs90', 239)" onmouseover="showTip(event, 'fs90', 239)" class="i">n</span>); <span class="i">vx</span> <span class="o">=</span> <span class="o">-</span><span onmouseout="hideTip(event, 'fs75', 240)" onmouseover="showTip(event, 'fs75', 240)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs69', 241)" onmouseover="showTip(event, 'fs69', 241)" class="i">vx</span> }
  <span class="k">else</span> <span onmouseout="hideTip(event, 'fs75', 242)" onmouseover="showTip(event, 'fs75', 242)" class="i">blob</span>

<span class="c">/// Move blob by one step - adds X and Y</span>
<span class="c">/// velocities to the X and Y coordinates</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs91', 243)" onmouseover="showTip(event, 'fs91', 243)" class="f">move</span> (<span onmouseout="hideTip(event, 'fs75', 244)" onmouseover="showTip(event, 'fs75', 244)" class="i">blob</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs66', 245)" onmouseover="showTip(event, 'fs66', 245)" class="t">Blob</span>) <span class="o">=</span>
  { <span onmouseout="hideTip(event, 'fs75', 246)" onmouseover="showTip(event, 'fs75', 246)" class="i">blob</span> <span class="k">with</span>
      <span onmouseout="hideTip(event, 'fs67', 247)" onmouseover="showTip(event, 'fs67', 247)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs75', 248)" onmouseover="showTip(event, 'fs75', 248)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 249)" onmouseover="showTip(event, 'fs67', 249)" class="i">X</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs75', 250)" onmouseover="showTip(event, 'fs75', 250)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs69', 251)" onmouseover="showTip(event, 'fs69', 251)" class="i">vx</span>
      <span onmouseout="hideTip(event, 'fs68', 252)" onmouseover="showTip(event, 'fs68', 252)" class="i">Y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs92', 253)" onmouseover="showTip(event, 'fs92', 253)" class="f">max</span> <span class="n">0.0</span> (<span onmouseout="hideTip(event, 'fs75', 254)" onmouseover="showTip(event, 'fs75', 254)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 255)" onmouseover="showTip(event, 'fs68', 255)" class="i">Y</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs75', 256)" onmouseover="showTip(event, 'fs75', 256)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs70', 257)" onmouseover="showTip(event, 'fs70', 257)" class="i">vy</span>) }
</code></pre></td>
</tr>
</table>
<p>The above functions capture the individual aspects of the movement. The
following put everything together and handle steps of Player's blob and
also collision detection.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Apply step on Player&#39;s blob. Composes above functions.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs93', 258)" onmouseover="showTip(event, 'fs93', 258)" class="f">step</span> <span onmouseout="hideTip(event, 'fs94', 259)" onmouseover="showTip(event, 'fs94', 259)" class="i">dir</span> <span onmouseout="hideTip(event, 'fs75', 260)" onmouseover="showTip(event, 'fs75', 260)" class="i">blob</span> <span class="o">=</span>
  <span onmouseout="hideTip(event, 'fs75', 261)" onmouseover="showTip(event, 'fs75', 261)" class="i">blob</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs85', 262)" onmouseover="showTip(event, 'fs85', 262)" class="f">direct</span> <span onmouseout="hideTip(event, 'fs94', 263)" onmouseover="showTip(event, 'fs94', 263)" class="i">dir</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs91', 264)" onmouseover="showTip(event, 'fs91', 264)" class="f">move</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 265)" onmouseover="showTip(event, 'fs89', 265)" class="f">bounce</span>

<span class="c">/// Check whether two blobs collide</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs95', 266)" onmouseover="showTip(event, 'fs95', 266)" class="f">collide</span> (<span onmouseout="hideTip(event, 'fs96', 267)" onmouseover="showTip(event, 'fs96', 267)" class="i">a</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs66', 268)" onmouseover="showTip(event, 'fs66', 268)" class="t">Blob</span>) (<span onmouseout="hideTip(event, 'fs97', 269)" onmouseover="showTip(event, 'fs97', 269)" class="i">b</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs66', 270)" onmouseover="showTip(event, 'fs66', 270)" class="t">Blob</span>) <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs98', 271)" onmouseover="showTip(event, 'fs98', 271)" class="i">dx</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs96', 272)" onmouseover="showTip(event, 'fs96', 272)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 273)" onmouseover="showTip(event, 'fs67', 273)" class="i">X</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs97', 274)" onmouseover="showTip(event, 'fs97', 274)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 275)" onmouseover="showTip(event, 'fs67', 275)" class="i">X</span>)<span class="o">*</span>(<span onmouseout="hideTip(event, 'fs96', 276)" onmouseover="showTip(event, 'fs96', 276)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 277)" onmouseover="showTip(event, 'fs67', 277)" class="i">X</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs97', 278)" onmouseover="showTip(event, 'fs97', 278)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 279)" onmouseover="showTip(event, 'fs67', 279)" class="i">X</span>)
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs99', 280)" onmouseover="showTip(event, 'fs99', 280)" class="i">dy</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs96', 281)" onmouseover="showTip(event, 'fs96', 281)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 282)" onmouseover="showTip(event, 'fs68', 282)" class="i">Y</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs97', 283)" onmouseover="showTip(event, 'fs97', 283)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 284)" onmouseover="showTip(event, 'fs68', 284)" class="i">Y</span>)<span class="o">*</span>(<span onmouseout="hideTip(event, 'fs96', 285)" onmouseover="showTip(event, 'fs96', 285)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 286)" onmouseover="showTip(event, 'fs68', 286)" class="i">Y</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs97', 287)" onmouseover="showTip(event, 'fs97', 287)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 288)" onmouseover="showTip(event, 'fs68', 288)" class="i">Y</span>)
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs100', 289)" onmouseover="showTip(event, 'fs100', 289)" class="i">dist</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs101', 290)" onmouseover="showTip(event, 'fs101', 290)" class="f">sqrt</span>(<span onmouseout="hideTip(event, 'fs98', 291)" onmouseover="showTip(event, 'fs98', 291)" class="i">dx</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs99', 292)" onmouseover="showTip(event, 'fs99', 292)" class="i">dy</span>)
  <span onmouseout="hideTip(event, 'fs100', 293)" onmouseover="showTip(event, 'fs100', 293)" class="i">dist</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs102', 294)" onmouseover="showTip(event, 'fs102', 294)" class="f">abs</span>(<span onmouseout="hideTip(event, 'fs96', 295)" onmouseover="showTip(event, 'fs96', 295)" class="i">a</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 296)" onmouseover="showTip(event, 'fs71', 296)" class="i">Radius</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs97', 297)" onmouseover="showTip(event, 'fs97', 297)" class="i">b</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 298)" onmouseover="showTip(event, 'fs71', 298)" class="i">Radius</span>)

<span class="c">/// Remove all falling blobs that hit Player&#39;s blob</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs103', 299)" onmouseover="showTip(event, 'fs103', 299)" class="f">absorb</span> (<span onmouseout="hideTip(event, 'fs75', 300)" onmouseover="showTip(event, 'fs75', 300)" class="i">blob</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs66', 301)" onmouseover="showTip(event, 'fs66', 301)" class="t">Blob</span>) (<span onmouseout="hideTip(event, 'fs104', 302)" onmouseover="showTip(event, 'fs104', 302)" class="i">drops</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs66', 303)" onmouseover="showTip(event, 'fs66', 303)" class="t">Blob</span> <span onmouseout="hideTip(event, 'fs105', 304)" onmouseover="showTip(event, 'fs105', 304)" class="t">list</span>) <span class="o">=</span>
  <span onmouseout="hideTip(event, 'fs104', 305)" onmouseover="showTip(event, 'fs104', 305)" class="i">drops</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs106', 306)" onmouseover="showTip(event, 'fs106', 306)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs107', 307)" onmouseover="showTip(event, 'fs107', 307)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs108', 308)" onmouseover="showTip(event, 'fs108', 308)" class="i">drop</span> <span class="k">-&gt;</span>
    <span onmouseout="hideTip(event, 'fs95', 309)" onmouseover="showTip(event, 'fs95', 309)" class="f">collide</span> <span onmouseout="hideTip(event, 'fs75', 310)" onmouseover="showTip(event, 'fs75', 310)" class="i">blob</span> <span onmouseout="hideTip(event, 'fs108', 311)" onmouseover="showTip(event, 'fs108', 311)" class="i">drop</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs109', 312)" onmouseover="showTip(event, 'fs109', 312)" class="f">not</span> )
</code></pre></td>
</tr>
</table>
<h2><a name="Game-logic-helpers" class="anchor" href="#Game-logic-helpers">Game logic helpers</a></h2>
<p>Next, we define a couple of helpers for generating and updating the falling blobs.
We have black growing blobs and white shrinking blobs. The <code>newGrow</code> and <code>newShrink</code>
functions are used to generate new blobs:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs110', 313)" onmouseover="showTip(event, 'fs110', 313)" class="i">grow</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs111', 314)" onmouseover="showTip(event, 'fs111', 314)" class="i">shrink</span> <span class="o">=</span> <span class="s">&quot;white&quot;</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs112', 315)" onmouseover="showTip(event, 'fs112', 315)" class="f">newDrop</span> <span onmouseout="hideTip(event, 'fs113', 316)" onmouseover="showTip(event, 'fs113', 316)" class="i">color</span> <span class="o">=</span>
  { <span onmouseout="hideTip(event, 'fs67', 317)" onmouseover="showTip(event, 'fs67', 317)" class="i">X</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 318)" onmouseover="showTip(event, 'fs6', 318)" class="f">rand</span>()<span class="o">*</span><span onmouseout="hideTip(event, 'fs30', 319)" onmouseover="showTip(event, 'fs30', 319)" class="i">width</span><span class="o">*</span><span class="n">0.8</span> <span class="o">+</span> (<span onmouseout="hideTip(event, 'fs30', 320)" onmouseover="showTip(event, 'fs30', 320)" class="i">width</span><span class="o">*</span><span class="n">0.1</span>)
    <span onmouseout="hideTip(event, 'fs68', 321)" onmouseover="showTip(event, 'fs68', 321)" class="i">Y</span><span class="o">=</span><span class="n">600.</span>; <span class="i">Radius</span><span class="o">=</span><span class="n">10.</span>; <span class="i">vx</span><span class="o">=</span><span class="n">0.</span>; <span class="i">vy</span> <span class="o">=</span> <span class="n">0.0</span>
    <span onmouseout="hideTip(event, 'fs113', 322)" onmouseover="showTip(event, 'fs113', 322)" class="i">color</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs113', 323)" onmouseover="showTip(event, 'fs113', 323)" class="i">color</span> }

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs114', 324)" onmouseover="showTip(event, 'fs114', 324)" class="f">newGrow</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs112', 325)" onmouseover="showTip(event, 'fs112', 325)" class="f">newDrop</span> <span onmouseout="hideTip(event, 'fs110', 326)" onmouseover="showTip(event, 'fs110', 326)" class="i">grow</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs115', 327)" onmouseover="showTip(event, 'fs115', 327)" class="f">newShrink</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs112', 328)" onmouseover="showTip(event, 'fs112', 328)" class="f">newDrop</span> <span onmouseout="hideTip(event, 'fs111', 329)" onmouseover="showTip(event, 'fs111', 329)" class="i">shrink</span>
</code></pre></td>
</tr>
</table>
<p>Inside the game loop, we will generate blobs randomly, but we keep a counter of
ticks to make sure that we do not generate new blobs too often. The <code>updateDrops</code>
function takes current drops and a countdown and returns a pair with new drops and
a new countdown. It implements simple logic:</p>
<ul>
<li>If we generated drop in last 8 steps, do nothing and decrement counter</li>
<li>
Roll an 8 sided dice and if we get 1, generate new blob
(2/3 are shrinkind and 1/3 are growing)
</li>
<li>Otherwise, do nothing and return previous state</li>
</ul>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Update drops and countdown in each step</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs116', 330)" onmouseover="showTip(event, 'fs116', 330)" class="f">updateDrops</span> <span onmouseout="hideTip(event, 'fs104', 331)" onmouseover="showTip(event, 'fs104', 331)" class="i">drops</span> <span onmouseout="hideTip(event, 'fs117', 332)" onmouseover="showTip(event, 'fs117', 332)" class="i">countdown</span> <span class="o">=</span>
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs117', 333)" onmouseover="showTip(event, 'fs117', 333)" class="i">countdown</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="k">then</span>
    <span onmouseout="hideTip(event, 'fs104', 334)" onmouseover="showTip(event, 'fs104', 334)" class="i">drops</span>, <span onmouseout="hideTip(event, 'fs117', 335)" onmouseover="showTip(event, 'fs117', 335)" class="i">countdown</span> <span class="o">-</span> <span class="n">1</span>
  <span class="k">elif</span> <span onmouseout="hideTip(event, 'fs118', 336)" onmouseover="showTip(event, 'fs118', 336)" class="f">floor</span>(<span onmouseout="hideTip(event, 'fs6', 337)" onmouseover="showTip(event, 'fs6', 337)" class="f">rand</span>()<span class="o">*</span><span class="n">8.</span>) <span class="o">=</span> <span class="n">0.</span> <span class="k">then</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs108', 338)" onmouseover="showTip(event, 'fs108', 338)" class="i">drop</span> <span class="o">=</span>
      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs118', 339)" onmouseover="showTip(event, 'fs118', 339)" class="f">floor</span>(<span onmouseout="hideTip(event, 'fs6', 340)" onmouseover="showTip(event, 'fs6', 340)" class="f">rand</span>()<span class="o">*</span><span class="n">3.</span>) <span class="o">=</span> <span class="n">0.</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs114', 341)" onmouseover="showTip(event, 'fs114', 341)" class="f">newGrow</span>()
      <span class="k">else</span> <span onmouseout="hideTip(event, 'fs115', 342)" onmouseover="showTip(event, 'fs115', 342)" class="f">newShrink</span>()
    <span onmouseout="hideTip(event, 'fs108', 343)" onmouseover="showTip(event, 'fs108', 343)" class="i">drop</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs104', 344)" onmouseover="showTip(event, 'fs104', 344)" class="i">drops</span>, <span class="n">8</span>
  <span class="k">else</span> <span onmouseout="hideTip(event, 'fs104', 345)" onmouseover="showTip(event, 'fs104', 345)" class="i">drops</span>, <span onmouseout="hideTip(event, 'fs117', 346)" onmouseover="showTip(event, 'fs117', 346)" class="i">countdown</span>

<span class="c">/// Count growing and shrinking drops in the list</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs119', 347)" onmouseover="showTip(event, 'fs119', 347)" class="f">countDrops</span> <span onmouseout="hideTip(event, 'fs104', 348)" onmouseover="showTip(event, 'fs104', 348)" class="i">drops</span> <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 349)" onmouseover="showTip(event, 'fs120', 349)" class="f">count</span> <span onmouseout="hideTip(event, 'fs113', 350)" onmouseover="showTip(event, 'fs113', 350)" class="i">color</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs104', 351)" onmouseover="showTip(event, 'fs104', 351)" class="i">drops</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs106', 352)" onmouseover="showTip(event, 'fs106', 352)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs107', 353)" onmouseover="showTip(event, 'fs107', 353)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs108', 354)" onmouseover="showTip(event, 'fs108', 354)" class="i">drop</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs108', 355)" onmouseover="showTip(event, 'fs108', 355)" class="i">drop</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs72', 356)" onmouseover="showTip(event, 'fs72', 356)" class="i">color</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs113', 357)" onmouseover="showTip(event, 'fs113', 357)" class="i">color</span>)
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs106', 358)" onmouseover="showTip(event, 'fs106', 358)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs121', 359)" onmouseover="showTip(event, 'fs121', 359)" class="f">length</span>
  <span onmouseout="hideTip(event, 'fs120', 360)" onmouseover="showTip(event, 'fs120', 360)" class="f">count</span> <span onmouseout="hideTip(event, 'fs110', 361)" onmouseover="showTip(event, 'fs110', 361)" class="i">grow</span>, <span onmouseout="hideTip(event, 'fs120', 362)" onmouseover="showTip(event, 'fs120', 362)" class="f">count</span> <span onmouseout="hideTip(event, 'fs111', 363)" onmouseover="showTip(event, 'fs111', 363)" class="i">shrink</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Asynchronous-game-loop" class="anchor" href="#Asynchronous-game-loop">Asynchronous game loop</a></h2>
<p>The asynchronous game loop is perhaps the most interesting part of the source code.
Fable supports F# asynchronous workflows, which give us a way to write non-blocking loop
that includes sleeping in the middle, so you can write long-running processes as a recursive
loop rather than using timers and callbacks.</p>
<p>The following diagram illustrates the game loop:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="text">(start)        +----(tick)---+
   \           |             |
     +------+  |  +--------+ |   +-----------+
  +-&gt;| game |--+-&gt;| update |-+--&gt;| completed |&lt;-+
  |  +------+     +--------+     +-----------+  |
  |                                             |
  +-----------(after 10 seconds)----------------+
</code></pre></td></tr></table>
<p>There are three states in which the game can be:</p>
<ul>
<li>After starting, the <code>game</code> state initializes the Player's blob and starts the game</li>
<li>
The <code>update</code> loop is active when the game is running. It calls itself recursively
until the game ends.
</li>
<li>
After finishing, the <code>completed</code> state displays a message and sleeps for 10 seconds
before starting a new game.
</li>
</ul>
<p>Using asynchronous workflows, the state machine can be represented using 3 mutually
recursive functions, each representing one of the states. The <code>game</code> and <code>completed</code>
states are simple:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Starts a new game</span>
<span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs122', 364)" onmouseover="showTip(event, 'fs122', 364)" class="f">game</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs123', 365)" onmouseover="showTip(event, 'fs123', 365)" class="i">async</span> {
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs75', 366)" onmouseover="showTip(event, 'fs75', 366)" class="i">blob</span> <span class="o">=</span>
    { <span onmouseout="hideTip(event, 'fs67', 367)" onmouseover="showTip(event, 'fs67', 367)" class="i">X</span> <span class="o">=</span> <span class="n">300.</span>; <span onmouseout="hideTip(event, 'fs68', 368)" onmouseover="showTip(event, 'fs68', 368)" class="i">Y</span><span class="o">=</span><span class="n">0.</span>; <span class="i">Radius</span><span class="o">=</span><span class="n">50.</span>;
      <span class="i">vx</span><span class="o">=</span><span class="n">0.</span>; <span class="i">vy</span><span class="o">=</span><span class="n">0.</span>; <span class="i">color</span><span class="o">=</span><span class="s">&quot;black&quot;</span> }
  <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs124', 369)" onmouseover="showTip(event, 'fs124', 369)" class="f">update</span> <span onmouseout="hideTip(event, 'fs75', 370)" onmouseover="showTip(event, 'fs75', 370)" class="i">blob</span> [<span onmouseout="hideTip(event, 'fs114', 371)" onmouseover="showTip(event, 'fs114', 371)" class="f">newGrow</span> ()] <span class="n">0</span> }

<span class="c">/// Displays message and sleeps for 10 sec</span>
<span class="k">and</span> <span onmouseout="hideTip(event, 'fs125', 372)" onmouseover="showTip(event, 'fs125', 372)" class="f">completed</span> () <span class="o">=</span> <span onmouseout="hideTip(event, 'fs123', 373)" onmouseover="showTip(event, 'fs123', 373)" class="i">async</span> {
  <span onmouseout="hideTip(event, 'fs60', 374)" onmouseover="showTip(event, 'fs60', 374)" class="f">drawText</span> (<span class="s">&quot;COMPLETED&quot;</span>,<span class="n">320.</span>,<span class="n">300.</span>)
  <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs126', 375)" onmouseover="showTip(event, 'fs126', 375)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 376)" onmouseover="showTip(event, 'fs127', 376)" class="f">Sleep</span> <span class="n">10000</span>
  <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs122', 377)" onmouseover="showTip(event, 'fs122', 377)" class="f">game</span> () }
</code></pre></td>
</tr>
</table>
<p>Note that we are using <code>let rec .. and</code>, which lets us write multiple recursive functions
that can call each other. The <code>completed</code> function calls <code>game</code> after 10 seconds using
<code>return!</code> (representing an asynchronous tail-call) and the <code>game</code> function calls <code>update</code>
with the initial state. The <code>update</code> loop looks as follows:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Keeps current state for Player&#39;s blob, falling</span>
<span class="c">/// drops and the countdown since last drop was generated</span>
<span class="k">and</span> <span onmouseout="hideTip(event, 'fs124', 378)" onmouseover="showTip(event, 'fs124', 378)" class="f">update</span> <span onmouseout="hideTip(event, 'fs75', 379)" onmouseover="showTip(event, 'fs75', 379)" class="i">blob</span> <span onmouseout="hideTip(event, 'fs104', 380)" onmouseover="showTip(event, 'fs104', 380)" class="i">drops</span> <span onmouseout="hideTip(event, 'fs117', 381)" onmouseover="showTip(event, 'fs117', 381)" class="i">countdown</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs123', 382)" onmouseover="showTip(event, 'fs123', 382)" class="i">async</span> {
  <span class="c">// Update the drops &amp; countdown</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs104', 383)" onmouseover="showTip(event, 'fs104', 383)" class="i">drops</span>, <span onmouseout="hideTip(event, 'fs117', 384)" onmouseover="showTip(event, 'fs117', 384)" class="i">countdown</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs116', 385)" onmouseover="showTip(event, 'fs116', 385)" class="f">updateDrops</span> <span onmouseout="hideTip(event, 'fs104', 386)" onmouseover="showTip(event, 'fs104', 386)" class="i">drops</span> <span onmouseout="hideTip(event, 'fs117', 387)" onmouseover="showTip(event, 'fs117', 387)" class="i">countdown</span>

  <span class="c">// Count drops, apply physics and count them again</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs128', 388)" onmouseover="showTip(event, 'fs128', 388)" class="i">beforeGrow</span>, <span onmouseout="hideTip(event, 'fs129', 389)" onmouseover="showTip(event, 'fs129', 389)" class="i">beforeShrink</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs119', 390)" onmouseover="showTip(event, 'fs119', 390)" class="f">countDrops</span> <span onmouseout="hideTip(event, 'fs104', 391)" onmouseover="showTip(event, 'fs104', 391)" class="i">drops</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs104', 392)" onmouseover="showTip(event, 'fs104', 392)" class="i">drops</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs104', 393)" onmouseover="showTip(event, 'fs104', 393)" class="i">drops</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs106', 394)" onmouseover="showTip(event, 'fs106', 394)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs130', 395)" onmouseover="showTip(event, 'fs130', 395)" class="f">map</span> (<span onmouseout="hideTip(event, 'fs88', 396)" onmouseover="showTip(event, 'fs88', 396)" class="f">gravity</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs91', 397)" onmouseover="showTip(event, 'fs91', 397)" class="f">move</span>)
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs103', 398)" onmouseover="showTip(event, 'fs103', 398)" class="f">absorb</span> <span onmouseout="hideTip(event, 'fs75', 399)" onmouseover="showTip(event, 'fs75', 399)" class="i">blob</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs131', 400)" onmouseover="showTip(event, 'fs131', 400)" class="i">afterGrow</span>, <span onmouseout="hideTip(event, 'fs132', 401)" onmouseover="showTip(event, 'fs132', 401)" class="i">afterShrink</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs119', 402)" onmouseover="showTip(event, 'fs119', 402)" class="f">countDrops</span> <span onmouseout="hideTip(event, 'fs104', 403)" onmouseover="showTip(event, 'fs104', 403)" class="i">drops</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs104', 404)" onmouseover="showTip(event, 'fs104', 404)" class="i">drops</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs104', 405)" onmouseover="showTip(event, 'fs104', 405)" class="i">drops</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs106', 406)" onmouseover="showTip(event, 'fs106', 406)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs107', 407)" onmouseover="showTip(event, 'fs107', 407)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs75', 408)" onmouseover="showTip(event, 'fs75', 408)" class="i">blob</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs75', 409)" onmouseover="showTip(event, 'fs75', 409)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 410)" onmouseover="showTip(event, 'fs68', 410)" class="i">Y</span> <span class="o">&gt;</span> <span class="n">0.</span>)

  <span class="c">// Calculate new player&#39;s size based on absorbed drops</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs133', 411)" onmouseover="showTip(event, 'fs133', 411)" class="i">radius</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs75', 412)" onmouseover="showTip(event, 'fs75', 412)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 413)" onmouseover="showTip(event, 'fs71', 413)" class="i">Radius</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs7', 414)" onmouseover="showTip(event, 'fs7', 414)" class="f">float</span> (<span onmouseout="hideTip(event, 'fs128', 415)" onmouseover="showTip(event, 'fs128', 415)" class="i">beforeGrow</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs131', 416)" onmouseover="showTip(event, 'fs131', 416)" class="i">afterGrow</span>) <span class="o">*</span><span class="n">4.</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs133', 417)" onmouseover="showTip(event, 'fs133', 417)" class="i">radius</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs133', 418)" onmouseover="showTip(event, 'fs133', 418)" class="i">radius</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs7', 419)" onmouseover="showTip(event, 'fs7', 419)" class="f">float</span> (<span onmouseout="hideTip(event, 'fs129', 420)" onmouseover="showTip(event, 'fs129', 420)" class="i">beforeShrink</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs132', 421)" onmouseover="showTip(event, 'fs132', 421)" class="i">afterShrink</span>) <span class="o">*</span> <span class="n">4.</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs133', 422)" onmouseover="showTip(event, 'fs133', 422)" class="i">radius</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs92', 423)" onmouseover="showTip(event, 'fs92', 423)" class="f">max</span> <span class="n">5.0</span> <span onmouseout="hideTip(event, 'fs133', 424)" onmouseover="showTip(event, 'fs133', 424)" class="i">radius</span>

  <span class="c">// Update radius and apply keyboard events</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs75', 425)" onmouseover="showTip(event, 'fs75', 425)" class="i">blob</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs75', 426)" onmouseover="showTip(event, 'fs75', 426)" class="i">blob</span> <span class="k">with</span> <span class="i">Radius</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs133', 427)" onmouseover="showTip(event, 'fs133', 427)" class="i">radius</span> }
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs75', 428)" onmouseover="showTip(event, 'fs75', 428)" class="i">blob</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs75', 429)" onmouseover="showTip(event, 'fs75', 429)" class="i">blob</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs93', 430)" onmouseover="showTip(event, 'fs93', 430)" class="f">step</span> (<span onmouseout="hideTip(event, 'fs34', 431)" onmouseover="showTip(event, 'fs34', 431)" class="t">Keyboard</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 432)" onmouseover="showTip(event, 'fs15', 432)" class="f">arrows</span>())

  <span class="c">// Render the new game state</span>
  <span onmouseout="hideTip(event, 'fs58', 433)" onmouseover="showTip(event, 'fs58', 433)" class="f">drawBg</span> <span onmouseout="hideTip(event, 'fs38', 434)" onmouseover="showTip(event, 'fs38', 434)" class="i">ctx</span> <span onmouseout="hideTip(event, 'fs35', 435)" onmouseover="showTip(event, 'fs35', 435)" class="i">canvas</span>
  <span class="k">for</span> <span onmouseout="hideTip(event, 'fs108', 436)" onmouseover="showTip(event, 'fs108', 436)" class="i">drop</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs104', 437)" onmouseover="showTip(event, 'fs104', 437)" class="i">drops</span> <span class="k">do</span> <span onmouseout="hideTip(event, 'fs74', 438)" onmouseover="showTip(event, 'fs74', 438)" class="f">drawBlob</span> <span onmouseout="hideTip(event, 'fs38', 439)" onmouseover="showTip(event, 'fs38', 439)" class="i">ctx</span> <span onmouseout="hideTip(event, 'fs35', 440)" onmouseover="showTip(event, 'fs35', 440)" class="i">canvas</span> <span onmouseout="hideTip(event, 'fs108', 441)" onmouseover="showTip(event, 'fs108', 441)" class="i">drop</span>
  <span onmouseout="hideTip(event, 'fs74', 442)" onmouseover="showTip(event, 'fs74', 442)" class="f">drawBlob</span> <span onmouseout="hideTip(event, 'fs38', 443)" onmouseover="showTip(event, 'fs38', 443)" class="i">ctx</span> <span onmouseout="hideTip(event, 'fs35', 444)" onmouseover="showTip(event, 'fs35', 444)" class="i">canvas</span> <span onmouseout="hideTip(event, 'fs75', 445)" onmouseover="showTip(event, 'fs75', 445)" class="i">blob</span>

  <span class="c">// If the game completed, switch state</span>
  <span class="c">// otherwise sleep and update recursively!</span>
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs75', 446)" onmouseover="showTip(event, 'fs75', 446)" class="i">blob</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 447)" onmouseover="showTip(event, 'fs71', 447)" class="i">Radius</span> <span class="o">&gt;</span> <span class="n">150.</span> <span class="k">then</span>
    <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs125', 448)" onmouseover="showTip(event, 'fs125', 448)" class="f">completed</span>()
  <span class="k">else</span>
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs126', 449)" onmouseover="showTip(event, 'fs126', 449)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 450)" onmouseover="showTip(event, 'fs127', 450)" class="f">Sleep</span>(<span onmouseout="hideTip(event, 'fs21', 451)" onmouseover="showTip(event, 'fs21', 451)" class="f">int</span> (<span class="n">1000.</span> <span class="o">/</span> <span class="n">60.</span>))
    <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs124', 452)" onmouseover="showTip(event, 'fs124', 452)" class="f">update</span> <span onmouseout="hideTip(event, 'fs75', 453)" onmouseover="showTip(event, 'fs75', 453)" class="i">blob</span> <span onmouseout="hideTip(event, 'fs104', 454)" onmouseover="showTip(event, 'fs104', 454)" class="i">drops</span> <span onmouseout="hideTip(event, 'fs117', 455)" onmouseover="showTip(event, 'fs117', 455)" class="i">countdown</span> }
</code></pre></td>
</tr>
</table>
<p>The last thing that we need to do is to start the game in the initial <code>game</code>
state using <code>Async.StartImmediate</code>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs122', 456)" onmouseover="showTip(event, 'fs122', 456)" class="f">game</span> () <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs126', 457)" onmouseover="showTip(event, 'fs126', 457)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs134', 458)" onmouseover="showTip(event, 'fs134', 458)" class="f">StartImmediate</span>
</code></pre></td>
</tr>
</table>


<div class="tip" id="fs1">namespace Fable</div>
<div class="tip" id="fs2">namespace Fable.Core</div>
<div class="tip" id="fs3">namespace Fable.Import</div>
<div class="tip" id="fs4">module Browser<br /><br />from Fable.Import</div>
<div class="tip" id="fs5">Multiple items<br />type EmitAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : macro:string -&gt; EmitAttribute<br /><br />Full name: Fable.Core.EmitAttribute<br /><br />--------------------<br />new : macro:string -&gt; EmitAttribute</div>
<div class="tip" id="fs6">val rand : unit -&gt; float<br /><br />Full name: Ozmo.rand</div>
<div class="tip" id="fs7">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = System.Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs8">val failwith : message:string -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.Operators.failwith</div>
<div class="tip" id="fs9">val mutable keysPressed : Set&lt;int&gt;<br /><br />Full name: Ozmo.Keyboard.keysPressed</div>
<div class="tip" id="fs10">Multiple items<br />module Set<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Set&lt;&#39;T (requires comparison)&gt; =<br />&#160;&#160;interface IComparable<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;interface ICollection&lt;&#39;T&gt;<br />&#160;&#160;new : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt;<br />&#160;&#160;member Add : value:&#39;T -&gt; Set&lt;&#39;T&gt;<br />&#160;&#160;member Contains : value:&#39;T -&gt; bool<br />&#160;&#160;override Equals : obj -&gt; bool<br />&#160;&#160;member IsProperSubsetOf : otherSet:Set&lt;&#39;T&gt; -&gt; bool<br />&#160;&#160;member IsProperSupersetOf : otherSet:Set&lt;&#39;T&gt; -&gt; bool<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Collections.Set&lt;_&gt;<br /><br />--------------------<br />new : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt;</div>
<div class="tip" id="fs11">val empty&lt;&#39;T (requires comparison)&gt; : Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Set.empty</div>
<div class="tip" id="fs12">val code : x:int -&gt; int<br /><br />Full name: Ozmo.Keyboard.code</div>
<div class="tip" id="fs13">val x : int</div>
<div class="tip" id="fs14">member Set.Contains : value:&#39;T -&gt; bool</div>
<div class="tip" id="fs15">val arrows : unit -&gt; int * int<br /><br />Full name: Ozmo.Keyboard.arrows</div>
<div class="tip" id="fs16">val update : e:KeyboardEvent * pressed:bool -&gt; &#39;a (requires &#39;a : null)<br /><br />Full name: Ozmo.Keyboard.update</div>
<div class="tip" id="fs17">val e : KeyboardEvent</div>
<div class="tip" id="fs18">Multiple items<br />val KeyboardEvent : KeyboardEventType<br /><br />Full name: Fable.Import.Browser.KeyboardEvent<br /><br />--------------------<br />type KeyboardEvent =<br />&#160;&#160;interface<br />&#160;&#160;&#160;&#160;inherit UIEvent<br />&#160;&#160;&#160;&#160;abstract member getModifierState : keyArg:string -&gt; bool<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_JOYSTICK : float<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_LEFT : float<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_MOBILE : float<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_NUMPAD : float<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_RIGHT : float<br />&#160;&#160;&#160;&#160;abstract member DOM_KEY_LOCATION_STANDARD : float<br />&#160;&#160;&#160;&#160;abstract member altKey : bool<br />&#160;&#160;&#160;&#160;abstract member char : string<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: Fable.Import.Browser.KeyboardEvent</div>
<div class="tip" id="fs19">val pressed : bool</div>
<div class="tip" id="fs20">val keyCode : int</div>
<div class="tip" id="fs21">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs22">property KeyboardEvent.keyCode: float</div>
<div class="tip" id="fs23">val op : (int -&gt; Set&lt;int&gt; -&gt; Set&lt;int&gt;)</div>
<div class="tip" id="fs24">val add : value:&#39;T -&gt; set:Set&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Set.add</div>
<div class="tip" id="fs25">val remove : value:&#39;T -&gt; set:Set&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Set.remove</div>
<div class="tip" id="fs26">val init : unit -&gt; unit<br /><br />Full name: Ozmo.Keyboard.init</div>
<div class="tip" id="fs27">val window : Window<br /><br />Full name: Fable.Import.Browser.window</div>
<div class="tip" id="fs28">abstract member Window.addEventListener_keydown : listener:System.Func&lt;KeyboardEvent,obj&gt; * ?useCapture:bool -&gt; unit</div>
<div class="tip" id="fs29">abstract member Window.addEventListener_keyup : listener:System.Func&lt;KeyboardEvent,obj&gt; * ?useCapture:bool -&gt; unit</div>
<div class="tip" id="fs30">val width : float<br /><br />Full name: Ozmo.width<br /><em><br /><br />&#160;The width of the canvas</em></div>
<div class="tip" id="fs31">val height : float<br /><br />Full name: Ozmo.height<br /><em><br /><br />&#160;The height of the canvas</em></div>
<div class="tip" id="fs32">val floorHeight : float<br /><br />Full name: Ozmo.floorHeight<br /><em><br /><br />&#160;Height of the floor - the bottom black part</em></div>
<div class="tip" id="fs33">val atmosHeight : float<br /><br />Full name: Ozmo.atmosHeight<br /><em><br /><br />&#160;Height of the atmosphere - the yellow gradient</em></div>
<div class="tip" id="fs34">module Keyboard<br /><br />from Ozmo</div>
<div class="tip" id="fs35">val canvas : HTMLCanvasElement<br /><br />Full name: Ozmo.canvas</div>
<div class="tip" id="fs36">val document : Document<br /><br />Full name: Fable.Import.Browser.document</div>
<div class="tip" id="fs37">abstract member Document.getElementsByTagName_canvas : unit -&gt; NodeListOf&lt;HTMLCanvasElement&gt;</div>
<div class="tip" id="fs38">val ctx : CanvasRenderingContext2D<br /><br />Full name: Ozmo.ctx</div>
<div class="tip" id="fs39">abstract member HTMLCanvasElement.getContext_2d : unit -&gt; CanvasRenderingContext2D</div>
<div class="tip" id="fs40">property HTMLCanvasElement.width: float</div>
<div class="tip" id="fs41">property HTMLCanvasElement.height: float</div>
<div class="tip" id="fs42">val drawGrd : ctx:CanvasRenderingContext2D -&gt; canvas:HTMLCanvasElement -&gt; y0:float * y1:float -&gt; c0:string * c1:string -&gt; unit<br /><br />Full name: Ozmo.drawGrd<br /><em><br /><br />&#160;Draw gradient between two Y offsets and two colours</em></div>
<div class="tip" id="fs43">val ctx : CanvasRenderingContext2D</div>
<div class="tip" id="fs44">Multiple items<br />val CanvasRenderingContext2D : CanvasRenderingContext2DType<br /><br />Full name: Fable.Import.Browser.CanvasRenderingContext2D<br /><br />--------------------<br />type CanvasRenderingContext2D =<br />&#160;&#160;interface<br />&#160;&#160;&#160;&#160;abstract member arc : x:float * y:float * radius:float * startAngle:float * endAngle:float * ?anticlockwise:bool -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member arcTo : x1:float * y1:float * x2:float * y2:float * radius:float -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member beginPath : unit -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member bezierCurveTo : cp1x:float * cp1y:float * cp2x:float * cp2y:float * x:float * y:float -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member clearRect : x:float * y:float * w:float * h:float -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member clip : ?fillRule:string -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member closePath : unit -&gt; unit<br />&#160;&#160;&#160;&#160;abstract member createImageData : imageDataOrSw:U2&lt;float,ImageData&gt; * ?sh:float -&gt; ImageData<br />&#160;&#160;&#160;&#160;abstract member createLinearGradient : x0:float * y0:float * x1:float * y1:float -&gt; CanvasGradient<br />&#160;&#160;&#160;&#160;abstract member createPattern : image:U3&lt;HTMLImageElement,HTMLCanvasElement,HTMLVideoElement&gt; * repetition:string -&gt; CanvasPattern<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: Fable.Import.Browser.CanvasRenderingContext2D</div>
<div class="tip" id="fs45">val canvas : HTMLCanvasElement</div>
<div class="tip" id="fs46">Multiple items<br />val HTMLCanvasElement : HTMLCanvasElementType<br /><br />Full name: Fable.Import.Browser.HTMLCanvasElement<br /><br />--------------------<br />type HTMLCanvasElement =<br />&#160;&#160;interface<br />&#160;&#160;&#160;&#160;inherit HTMLElement<br />&#160;&#160;&#160;&#160;abstract member getContext : contextId:string * [&lt;ParamArray&gt;] args:obj [] -&gt; U2&lt;CanvasRenderingContext2D,WebGLRenderingContext&gt;<br />&#160;&#160;&#160;&#160;abstract member getContext_2d : unit -&gt; CanvasRenderingContext2D<br />&#160;&#160;&#160;&#160;abstract member ( getContext_experimental-webgl ) : unit -&gt; WebGLRenderingContext<br />&#160;&#160;&#160;&#160;abstract member height : float<br />&#160;&#160;&#160;&#160;abstract member width : float<br />&#160;&#160;&#160;&#160;abstract member msToBlob : unit -&gt; Blob<br />&#160;&#160;&#160;&#160;abstract member height : float with set<br />&#160;&#160;&#160;&#160;abstract member width : float with set<br />&#160;&#160;&#160;&#160;abstract member toBlob : unit -&gt; Blob<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: Fable.Import.Browser.HTMLCanvasElement</div>
<div class="tip" id="fs47">val y0 : float</div>
<div class="tip" id="fs48">val y1 : float</div>
<div class="tip" id="fs49">val c0 : string</div>
<div class="tip" id="fs50">val c1 : string</div>
<div class="tip" id="fs51">val grd : CanvasGradient</div>
<div class="tip" id="fs52">abstract member CanvasRenderingContext2D.createLinearGradient : x0:float * y0:float * x1:float * y1:float -&gt; CanvasGradient</div>
<div class="tip" id="fs53">abstract member CanvasGradient.addColorStop : offset:float * color:string -&gt; unit</div>
<div class="tip" id="fs54">property CanvasRenderingContext2D.fillStyle: U3&lt;string,CanvasGradient,CanvasPattern&gt;</div>
<div class="tip" id="fs55">type U3&lt;&#39;a,&#39;b,&#39;c&gt; =<br />&#160;&#160;| Case1 of &#39;a<br />&#160;&#160;| Case2 of &#39;b<br />&#160;&#160;| Case3 of &#39;c<br /><br />Full name: Fable.Core.U3&lt;_,_,_&gt;</div>
<div class="tip" id="fs56">union case U3.Case2: &#39;b -&gt; U3&lt;&#39;a,&#39;b,&#39;c&gt;</div>
<div class="tip" id="fs57">abstract member CanvasRenderingContext2D.fillRect : x:float * y:float * w:float * h:float -&gt; unit</div>
<div class="tip" id="fs58">val drawBg : ctx:CanvasRenderingContext2D -&gt; canvas:HTMLCanvasElement -&gt; unit<br /><br />Full name: Ozmo.drawBg<br /><em><br /><br />&#160;Draw background of the Ozmo game</em></div>
<div class="tip" id="fs59">union case U3.Case1: &#39;a -&gt; U3&lt;&#39;a,&#39;b,&#39;c&gt;</div>
<div class="tip" id="fs60">val drawText : text:string * x:float * y:float -&gt; unit<br /><br />Full name: Ozmo.drawText<br /><em><br /><br />&#160;Draw the specified text (when game finishes)</em></div>
<div class="tip" id="fs61">val text : string</div>
<div class="tip" id="fs62">val x : float</div>
<div class="tip" id="fs63">val y : float</div>
<div class="tip" id="fs64">property CanvasRenderingContext2D.font: string</div>
<div class="tip" id="fs65">abstract member CanvasRenderingContext2D.fillText : text:string * x:float * y:float * ?maxWidth:float -&gt; unit</div>
<div class="tip" id="fs66">Multiple items<br />val Blob : BlobType<br /><br />Full name: Fable.Import.Browser.Blob<br /><br />--------------------<br />type Blob =<br />&#160;&#160;{X: float;<br />&#160;&#160;&#160;Y: float;<br />&#160;&#160;&#160;vx: float;<br />&#160;&#160;&#160;vy: float;<br />&#160;&#160;&#160;Radius: float;<br />&#160;&#160;&#160;color: string;}<br /><br />Full name: Ozmo.Blob</div>
<div class="tip" id="fs67">Blob.X: float</div>
<div class="tip" id="fs68">Blob.Y: float</div>
<div class="tip" id="fs69">Blob.vx: float</div>
<div class="tip" id="fs70">Blob.vy: float</div>
<div class="tip" id="fs71">Blob.Radius: float</div>
<div class="tip" id="fs72">Blob.color: string</div>
<div class="tip" id="fs73">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs74">val drawBlob : ctx:CanvasRenderingContext2D -&gt; canvas:HTMLCanvasElement -&gt; blob:Blob -&gt; unit<br /><br />Full name: Ozmo.drawBlob</div>
<div class="tip" id="fs75">val blob : Blob</div>
<div class="tip" id="fs76">abstract member CanvasRenderingContext2D.beginPath : unit -&gt; unit</div>
<div class="tip" id="fs77">abstract member CanvasRenderingContext2D.arc : x:float * y:float * radius:float * startAngle:float * endAngle:float * ?anticlockwise:bool -&gt; unit</div>
<div class="tip" id="fs78">namespace System</div>
<div class="tip" id="fs79">type Math =<br />&#160;&#160;static val PI : float<br />&#160;&#160;static val E : float<br />&#160;&#160;static member Abs : value:sbyte -&gt; sbyte + 6 overloads<br />&#160;&#160;static member Acos : d:float -&gt; float<br />&#160;&#160;static member Asin : d:float -&gt; float<br />&#160;&#160;static member Atan : d:float -&gt; float<br />&#160;&#160;static member Atan2 : y:float * x:float -&gt; float<br />&#160;&#160;static member BigMul : a:int * b:int -&gt; int64<br />&#160;&#160;static member Ceiling : d:decimal -&gt; decimal + 1 overload<br />&#160;&#160;static member Cos : d:float -&gt; float<br />&#160;&#160;...<br /><br />Full name: System.Math</div>
<div class="tip" id="fs80">field System.Math.PI = 3.14159265359</div>
<div class="tip" id="fs81">abstract member CanvasRenderingContext2D.fill : ?fillRule:string -&gt; unit</div>
<div class="tip" id="fs82">property CanvasRenderingContext2D.lineWidth: float</div>
<div class="tip" id="fs83">property CanvasRenderingContext2D.strokeStyle: U3&lt;string,CanvasGradient,CanvasPattern&gt;</div>
<div class="tip" id="fs84">abstract member CanvasRenderingContext2D.stroke : unit -&gt; unit</div>
<div class="tip" id="fs85">val direct : dx:int * dy:&#39;a -&gt; blob:Blob -&gt; Blob<br /><br />Full name: Ozmo.direct<br /><em><br /><br />&#160;Apply key effects on Player&#39;s blob - changes X speed</em></div>
<div class="tip" id="fs86">val dx : int</div>
<div class="tip" id="fs87">val dy : &#39;a</div>
<div class="tip" id="fs88">val gravity : blob:Blob -&gt; Blob<br /><br />Full name: Ozmo.gravity<br /><em><br /><br />&#160;Apply gravity on falling blobs - gets faster every step</em></div>
<div class="tip" id="fs89">val bounce : blob:Blob -&gt; Blob<br /><br />Full name: Ozmo.bounce<br /><em><br /><br />&#160;Bounde Player&#39;s blob off the wall if it hits it</em></div>
<div class="tip" id="fs90">val n : float</div>
<div class="tip" id="fs91">val move : blob:Blob -&gt; Blob<br /><br />Full name: Ozmo.move<br /><em><br /><br />&#160;Move blob by one step - adds X and Y<br />&#160;velocities to the X and Y coordinates</em></div>
<div class="tip" id="fs92">val max : e1:&#39;T -&gt; e2:&#39;T -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Core.Operators.max</div>
<div class="tip" id="fs93">val step : int * &#39;a -&gt; blob:Blob -&gt; Blob<br /><br />Full name: Ozmo.step<br /><em><br /><br />&#160;Apply step on Player&#39;s blob. Composes above functions.</em></div>
<div class="tip" id="fs94">val dir : int * &#39;a</div>
<div class="tip" id="fs95">val collide : a:Blob -&gt; b:Blob -&gt; bool<br /><br />Full name: Ozmo.collide<br /><em><br /><br />&#160;Check whether two blobs collide</em></div>
<div class="tip" id="fs96">val a : Blob</div>
<div class="tip" id="fs97">val b : Blob</div>
<div class="tip" id="fs98">val dx : float</div>
<div class="tip" id="fs99">val dy : float</div>
<div class="tip" id="fs100">val dist : float</div>
<div class="tip" id="fs101">val sqrt : value:&#39;T -&gt; &#39;U (requires member Sqrt)<br /><br />Full name: Microsoft.FSharp.Core.Operators.sqrt</div>
<div class="tip" id="fs102">val abs : value:&#39;T -&gt; &#39;T (requires member Abs)<br /><br />Full name: Microsoft.FSharp.Core.Operators.abs</div>
<div class="tip" id="fs103">val absorb : blob:Blob -&gt; drops:Blob list -&gt; Blob list<br /><br />Full name: Ozmo.absorb<br /><em><br /><br />&#160;Remove all falling blobs that hit Player&#39;s blob</em></div>
<div class="tip" id="fs104">val drops : Blob list</div>
<div class="tip" id="fs105">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs106">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs107">val filter : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.filter</div>
<div class="tip" id="fs108">val drop : Blob</div>
<div class="tip" id="fs109">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs110">val grow : string<br /><br />Full name: Ozmo.grow</div>
<div class="tip" id="fs111">val shrink : string<br /><br />Full name: Ozmo.shrink</div>
<div class="tip" id="fs112">val newDrop : color:string -&gt; Blob<br /><br />Full name: Ozmo.newDrop</div>
<div class="tip" id="fs113">val color : string</div>
<div class="tip" id="fs114">val newGrow : unit -&gt; Blob<br /><br />Full name: Ozmo.newGrow</div>
<div class="tip" id="fs115">val newShrink : unit -&gt; Blob<br /><br />Full name: Ozmo.newShrink</div>
<div class="tip" id="fs116">val updateDrops : drops:Blob list -&gt; countdown:int -&gt; Blob list * int<br /><br />Full name: Ozmo.updateDrops<br /><em><br /><br />&#160;Update drops and countdown in each step</em></div>
<div class="tip" id="fs117">val countdown : int</div>
<div class="tip" id="fs118">val floor : value:&#39;T -&gt; &#39;T (requires member Floor)<br /><br />Full name: Microsoft.FSharp.Core.Operators.floor</div>
<div class="tip" id="fs119">val countDrops : drops:Blob list -&gt; int * int<br /><br />Full name: Ozmo.countDrops<br /><em><br /><br />&#160;Count growing and shrinking drops in the list</em></div>
<div class="tip" id="fs120">val count : (string -&gt; int)</div>
<div class="tip" id="fs121">val length : list:&#39;T list -&gt; int<br /><br />Full name: Microsoft.FSharp.Collections.List.length</div>
<div class="tip" id="fs122">val game : unit -&gt; Async&lt;&#39;a&gt;<br /><br />Full name: Ozmo.game<br /><em><br /><br />&#160;Starts a new game</em></div>
<div class="tip" id="fs123">val async : AsyncBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.async</div>
<div class="tip" id="fs124">val update : blob:Blob -&gt; drops:Blob list -&gt; countdown:int -&gt; Async&lt;&#39;a&gt;<br /><br />Full name: Ozmo.update<br /><em><br /><br />&#160;Keeps current state for Player&#39;s blob, falling<br />&#160;drops and the countdown since last drop was generated</em></div>
<div class="tip" id="fs125">val completed : unit -&gt; Async&lt;&#39;a&gt;<br /><br />Full name: Ozmo.completed<br /><em><br /><br />&#160;Displays message and sleeps for 10 sec</em></div>
<div class="tip" id="fs126">Multiple items<br />type Async<br />static member AsBeginEnd : computation:(&#39;Arg -&gt; Async&lt;&#39;T&gt;) -&gt; (&#39;Arg * AsyncCallback * obj -&gt; IAsyncResult) * (IAsyncResult -&gt; &#39;T) * (IAsyncResult -&gt; unit)<br />static member AwaitEvent : event:IEvent&lt;&#39;Del,&#39;T&gt; * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt; (requires delegate and &#39;Del :&gt; Delegate)<br />static member AwaitIAsyncResult : iar:IAsyncResult * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member AwaitTask : task:Task -&gt; Async&lt;unit&gt;<br />static member AwaitTask : task:Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br />static member AwaitWaitHandle : waitHandle:WaitHandle * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member CancelDefaultToken : unit -&gt; unit<br />static member Catch : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;Choice&lt;&#39;T,exn&gt;&gt;<br />static member FromBeginEnd : beginAction:(AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg:&#39;Arg1 * beginAction:(&#39;Arg1 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * beginAction:(&#39;Arg1 * &#39;Arg2 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * arg3:&#39;Arg3 * beginAction:(&#39;Arg1 * &#39;Arg2 * &#39;Arg3 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromContinuations : callback:((&#39;T -&gt; unit) * (exn -&gt; unit) * (OperationCanceledException -&gt; unit) -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member Ignore : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;unit&gt;<br />static member OnCancel : interruption:(unit -&gt; unit) -&gt; Async&lt;IDisposable&gt;<br />static member Parallel : computations:seq&lt;Async&lt;&#39;T&gt;&gt; -&gt; Async&lt;&#39;T []&gt;<br />static member RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:CancellationToken -&gt; &#39;T<br />static member Sleep : millisecondsDueTime:int -&gt; Async&lt;unit&gt;<br />static member Start : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions * ?cancellationToken:CancellationToken -&gt; Task&lt;&#39;T&gt;<br />static member StartChild : computation:Async&lt;&#39;T&gt; * ?millisecondsTimeout:int -&gt; Async&lt;Async&lt;&#39;T&gt;&gt;<br />static member StartChildAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions -&gt; Async&lt;Task&lt;&#39;T&gt;&gt;<br />static member StartImmediate : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartWithContinuations : computation:Async&lt;&#39;T&gt; * continuation:(&#39;T -&gt; unit) * exceptionContinuation:(exn -&gt; unit) * cancellationContinuation:(OperationCanceledException -&gt; unit) * ?cancellationToken:CancellationToken -&gt; unit<br />static member SwitchToContext : syncContext:SynchronizationContext -&gt; Async&lt;unit&gt;<br />static member SwitchToNewThread : unit -&gt; Async&lt;unit&gt;<br />static member SwitchToThreadPool : unit -&gt; Async&lt;unit&gt;<br />static member TryCancelled : computation:Async&lt;&#39;T&gt; * compensation:(OperationCanceledException -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member CancellationToken : Async&lt;CancellationToken&gt;<br />static member DefaultCancellationToken : CancellationToken<br /><br />Full name: Microsoft.FSharp.Control.Async<br /><br />--------------------<br />type Async&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Control.Async&lt;_&gt;</div>
<div class="tip" id="fs127">static member Async.Sleep : millisecondsDueTime:int -&gt; Async&lt;unit&gt;</div>
<div class="tip" id="fs128">val beforeGrow : int</div>
<div class="tip" id="fs129">val beforeShrink : int</div>
<div class="tip" id="fs130">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs131">val afterGrow : int</div>
<div class="tip" id="fs132">val afterShrink : int</div>
<div class="tip" id="fs133">val radius : float</div>
<div class="tip" id="fs134">static member Async.StartImmediate : computation:Async&lt;unit&gt; * ?cancellationToken:System.Threading.CancellationToken -&gt; unit</div>

    </div>
    <div class="col-md-1 col-lg-2"></div>
  </div>
</div>

  </div>

  <a class="gh-forkme" href="https://github.com/fsprojects/Fable"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
</body>
</html>
